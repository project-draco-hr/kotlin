{
  extend(CompletionType.BASIC,ACTIVATION_PATTERN,new CompletionProvider<CompletionParameters>(){
    @Override protected void addCompletions(    @NotNull CompletionParameters parameters,    ProcessingContext context,    @NotNull CompletionResultSet result){
      PsiElement position=parameters.getPosition();
      if (!(position.getContainingFile() instanceof JetFile)) {
        return;
      }
      PsiReference ref=parameters.getPosition().getContainingFile().findReferenceAt(parameters.getOffset());
      if (ref instanceof JetSimpleNameReference) {
        JetSimpleNameReference simpleNameReference=(JetSimpleNameReference)ref;
        String name=simpleNameReference.getExpression().getText();
        if (name == null) {
          return;
        }
        try {
          int prefixLength=parameters.getOffset() - simpleNameReference.getExpression().getTextOffset();
          result=result.withPrefixMatcher(new PlainPrefixMatcher(name.substring(0,prefixLength)));
          ResolveSessionForBodies resolveSession=AnalyzerFacadeWithCache.getLazyResolveSessionForFile(simpleNameReference.getExpression().getContainingJetFile());
          BindingContext bindingContext=resolveSession.resolveToElement(simpleNameReference.getExpression());
          for (          LookupElement variant : DescriptorLookupConverter.collectLookupElements(resolveSession,bindingContext,TipsManager.getPackageReferenceVariants(simpleNameReference.getExpression(),bindingContext))) {
            if (!variant.getLookupString().contains(DUMMY_IDENTIFIER)) {
              result.addElement(variant);
            }
          }
          result.stopHere();
        }
 catch (        ProcessCanceledException e) {
          throw CompletionProgressIndicatorUtil.rethrowWithCancelIndicator(e);
        }
      }
    }
  }
);
}
