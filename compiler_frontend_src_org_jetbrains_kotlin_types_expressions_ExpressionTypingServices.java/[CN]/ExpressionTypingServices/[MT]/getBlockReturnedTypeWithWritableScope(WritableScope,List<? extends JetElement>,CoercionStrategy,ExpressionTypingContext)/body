{
  if (block.isEmpty()) {
    return new LoopTypeInfo(builtIns.getUnitType(),context.dataFlowInfo);
  }
  ExpressionTypingInternals blockLevelVisitor=ExpressionTypingVisitorDispatcher.createForBlock(expressionTypingComponents,scope);
  ExpressionTypingContext newContext=context.replaceScope(scope).replaceExpectedType(NO_EXPECTED_TYPE);
  JetTypeInfo result=JetTypeInfo.create(null,context.dataFlowInfo);
  DataFlowInfo beforeJumpInfo=newContext.dataFlowInfo;
  boolean jumpOutPossible=false;
  for (Iterator<? extends JetElement> iterator=block.iterator(); iterator.hasNext(); ) {
    JetElement statement=iterator.next();
    if (!(statement instanceof JetExpression)) {
      continue;
    }
    JetExpression statementExpression=(JetExpression)statement;
    if (!iterator.hasNext()) {
      result=getTypeOfLastExpressionInBlock(statementExpression,newContext.replaceExpectedType(context.expectedType),coercionStrategyForLastExpression,blockLevelVisitor);
    }
 else {
      result=blockLevelVisitor.getTypeInfo(statementExpression,newContext.replaceContextDependency(ContextDependency.INDEPENDENT),true);
    }
    DataFlowInfo newDataFlowInfo=result.getDataFlowInfo();
    if (!jumpOutPossible) {
      if (result instanceof LoopTypeInfo) {
        LoopTypeInfo loopTypeInfo=(LoopTypeInfo)result;
        beforeJumpInfo=loopTypeInfo.getJumpFlowInfo();
        jumpOutPossible=loopTypeInfo.isJumpOutPossible();
      }
 else {
        beforeJumpInfo=newDataFlowInfo;
      }
    }
    if (newDataFlowInfo != context.dataFlowInfo) {
      newContext=newContext.replaceDataFlowInfo(newDataFlowInfo);
    }
    blockLevelVisitor=ExpressionTypingVisitorDispatcher.createForBlock(expressionTypingComponents,scope);
  }
  return new LoopTypeInfo(result.getType(),result.getDataFlowInfo(),jumpOutPossible,beforeJumpInfo);
}
