{
  builder.read(expression);
  final JetFinallySection finallyBlock=expression.getFinallyBlock();
  if (finallyBlock != null) {
    builder.enterTryFinally(new GenerationTrigger(){
      private boolean working=false;
      @Override public void generate(){
        if (working)         return;
        working=true;
        value(finallyBlock.getFinalExpression(),inCondition);
        working=false;
      }
    }
);
  }
  List<JetCatchClause> catchClauses=expression.getCatchClauses();
  final boolean hasCatches=!catchClauses.isEmpty();
  Label onException=null;
  if (hasCatches) {
    onException=builder.createUnboundLabel("onException");
    builder.nondeterministicJump(onException);
  }
  Label onExceptionToFinallyBlock=null;
  if (finallyBlock != null) {
    onExceptionToFinallyBlock=builder.createUnboundLabel("onExceptionToFinallyBlock");
    builder.nondeterministicJump(onExceptionToFinallyBlock);
  }
  value(expression.getTryBlock(),inCondition);
  Collection<Label> allowDeadLabels=Lists.newArrayList();
  if (hasCatches) {
    builder.createAllowDeadLabel(allowDeadLabels);
    Label afterCatches=builder.createUnboundLabel("afterCatches");
    builder.jump(afterCatches);
    builder.bindLabel(onException);
    LinkedList<Label> catchLabels=Lists.newLinkedList();
    int catchClausesSize=catchClauses.size();
    for (int i=0; i < catchClausesSize - 1; i++) {
      catchLabels.add(builder.createUnboundLabel("catch " + i));
    }
    builder.nondeterministicJump(catchLabels);
    boolean isFirst=true;
    for (    JetCatchClause catchClause : catchClauses) {
      if (!isFirst) {
        builder.bindLabel(catchLabels.remove());
      }
 else {
        isFirst=false;
      }
      JetParameter catchParameter=catchClause.getCatchParameter();
      if (catchParameter != null) {
        builder.declare(catchParameter);
        builder.write(catchParameter,catchParameter);
      }
      JetExpression catchBody=catchClause.getCatchBody();
      if (catchBody != null) {
        value(catchBody,false);
      }
      builder.createAllowDeadLabel(allowDeadLabels);
      builder.jump(afterCatches);
    }
    builder.bindLabel(afterCatches);
  }
 else {
    builder.createAllowDeadLabel(allowDeadLabels);
  }
  if (finallyBlock != null) {
    builder.exitTryFinally();
    Label skipFinallyToErrorBlock=builder.createUnboundLabel("skipFinallyToErrorBlock");
    builder.jump(skipFinallyToErrorBlock);
    builder.bindLabel(onExceptionToFinallyBlock);
    value(finallyBlock.getFinalExpression(),inCondition);
    builder.jumpToError();
    builder.bindLabel(skipFinallyToErrorBlock);
    value(finallyBlock.getFinalExpression(),inCondition);
  }
  builder.stopAllowDead(allowDeadLabels);
}
