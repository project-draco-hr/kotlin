{
  JetExpression subjectExpression=expression.getSubjectExpression();
  if (subjectExpression != null) {
    value(subjectExpression,inCondition);
  }
  boolean hasElseOrIrrefutableBranch=false;
  Label doneLabel=builder.createUnboundLabel();
  Label nextLabel=null;
  for (Iterator<JetWhenEntry> iterator=expression.getEntries().iterator(); iterator.hasNext(); ) {
    JetWhenEntry whenEntry=iterator.next();
    builder.read(whenEntry);
    if (whenEntry.isElse()) {
      hasElseOrIrrefutableBranch=true;
      if (iterator.hasNext()) {
        trace.report(ELSE_MISPLACED_IN_WHEN.on(whenEntry));
      }
    }
    boolean isIrrefutable=JetPsiUtil.isIrrefutable(whenEntry);
    if (isIrrefutable) {
      hasElseOrIrrefutableBranch=true;
    }
    Label bodyLabel=builder.createUnboundLabel();
    JetWhenCondition[] conditions=whenEntry.getConditions();
    for (int i=0; i < conditions.length; i++) {
      JetWhenCondition condition=conditions[i];
      condition.accept(conditionVisitor);
      if (i + 1 < conditions.length) {
        builder.nondeterministicJump(bodyLabel);
      }
    }
    if (!isIrrefutable) {
      nextLabel=builder.createUnboundLabel();
      builder.nondeterministicJump(nextLabel);
    }
    builder.bindLabel(bodyLabel);
    value(whenEntry.getExpression(),inCondition);
    builder.allowDead();
    builder.jump(doneLabel);
    if (!isIrrefutable) {
      builder.bindLabel(nextLabel);
    }
  }
  builder.bindLabel(doneLabel);
  boolean isWhenExhaust=WhenChecker.isWhenExhaust(expression,trace);
  if (!hasElseOrIrrefutableBranch && !isWhenExhaust) {
    trace.report(NO_ELSE_IN_WHEN.on(expression));
  }
  builder.stopAllowDead();
}
