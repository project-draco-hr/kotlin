{
  for (  Map.Entry<TypeParameterDescriptor,TypeConstraintsImpl> entry : typeParameterConstraints.entrySet()) {
    TypeParameterDescriptor typeParameterDescriptor=entry.getKey();
    TypeConstraintsImpl typeConstraints=entry.getValue();
    for (    JetType declaredUpperBound : typeParameterDescriptor.getUpperBounds()) {
      Collection<Constraint> constraints=Lists.newArrayList(typeConstraints.getConstraints());
      for (      Constraint constraint : constraints) {
        if (constraint.boundKind == LOWER_BOUND || constraint.boundKind == EXACT_BOUND) {
          ConstraintPosition position=ConstraintPosition.getCompoundConstraintPosition(ConstraintPosition.getTypeBoundPosition(typeParameterDescriptor.getIndex()),constraint.constraintPosition);
          addSubtypeConstraint(constraint.type,declaredUpperBound,position);
        }
      }
      ClassifierDescriptor declarationDescriptor=declaredUpperBound.getConstructor().getDeclarationDescriptor();
      if (declarationDescriptor instanceof TypeParameterDescriptor && typeParameterConstraints.containsKey(declarationDescriptor)) {
        TypeConstraintsImpl typeConstraintsForUpperBound=typeParameterConstraints.get(declarationDescriptor);
        for (        Constraint constraint : typeConstraintsForUpperBound.getConstraints()) {
          if (constraint.boundKind == UPPER_BOUND || constraint.boundKind == EXACT_BOUND) {
            ConstraintPosition position=ConstraintPosition.getCompoundConstraintPosition(ConstraintPosition.getTypeBoundPosition(typeParameterDescriptor.getIndex()),constraint.constraintPosition);
            typeConstraints.addConstraint(UPPER_BOUND,constraint.type,position);
          }
        }
      }
    }
  }
}
