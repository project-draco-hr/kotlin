{
  final JetType type=originalProjection.getType();
  Variance projectionKind=originalProjection.getProjectionKind();
  if (type.getConstructor().getDeclarationDescriptor() instanceof TypeParameterDescriptor) {
    return originalProjection;
  }
  List<TypeProjection> substitutedArguments=substituteTypeArguments(type.getConstructor().getParameters(),type.getArguments(),recursionDepth);
  TypeSubstitution substitutionFilteringTypeParameters=new TypeSubstitution(){
    private final Collection<TypeConstructor> containedOrCapturedTypeParameters=TypeUtilPackage.getContainedAndCapturedTypeParameterConstructors(type);
    @Nullable @Override public TypeProjection get(    @NotNull JetType key){
      return containedOrCapturedTypeParameters.contains(key.getConstructor()) ? substitution.get(key) : null;
    }
    @Override public boolean isEmpty(){
      return substitution.isEmpty();
    }
  }
;
  JetType substitutedType=JetTypeImpl.create(type.getAnnotations(),type.getConstructor(),type.isMarkedNullable(),substitutedArguments,substitutionFilteringTypeParameters,new SubstitutingScope(type.getMemberScope(),create(substitutionFilteringTypeParameters)),type.getCapabilities());
  return new TypeProjectionImpl(projectionKind,substitutedType);
}
