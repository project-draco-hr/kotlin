{
  Deque<Instruction> stack=Queues.newArrayDeque();
  stack.push(rootInstruction);
  while (!stack.isEmpty()) {
    Instruction instruction=stack.pop();
    visited.add(instruction);
    Collection<Instruction> followingInstructions=order == FORWARD ? instruction.getNextInstructions() : instruction.getPreviousInstructions();
    for (    Instruction followingInstruction : followingInstructions) {
      if (followingInstruction != null && !visited.contains(followingInstruction)) {
        if (handler != null && !handler.handle(instruction))         return false;
        stack.push(followingInstruction);
      }
    }
  }
  return true;
}
