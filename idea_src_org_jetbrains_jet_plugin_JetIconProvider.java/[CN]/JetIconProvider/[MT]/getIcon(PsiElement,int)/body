{
  if (psiElement instanceof JetFile) {
    JetFile file=(JetFile)psiElement;
    List<JetDeclaration> declarations=file.getDeclarations();
    JetClassOrObject mostImportantClass=null;
    String nameWithoutExtension=StringUtil.getPackageName(file.getName());
    for (    JetDeclaration declaration : declarations) {
      if (mostImportantClass == null && declaration instanceof JetClassOrObject) {
        mostImportantClass=(JetClassOrObject)declaration;
      }
 else       if (declaration instanceof JetClassOrObject) {
        JetClassOrObject object=(JetClassOrObject)declaration;
        if (nameWithoutExtension.equals(object.getName())) {
          mostImportantClass=object;
        }
      }
    }
    if (mostImportantClass != null) {
      return getIcon(mostImportantClass,flags);
    }
    return JetIcons.FILE;
  }
  if (psiElement instanceof JetNamespaceHeader) {
    return (flags & Iconable.ICON_FLAG_OPEN) != 0 ? PlatformIcons.PACKAGE_OPEN_ICON : PlatformIcons.PACKAGE_ICON;
  }
  if (psiElement instanceof JetNamedFunction) {
    return PsiTreeUtil.getParentOfType(psiElement,JetNamedDeclaration.class) instanceof JetClass ? JetIcons.LAMBDA : JetIcons.FUNCTION;
  }
  if (psiElement instanceof JetClass) {
    JetClass jetClass=(JetClass)psiElement;
    if (jetClass.isTrait()) {
      return JetIcons.TRAIT;
    }
    Icon icon=jetClass.hasModifier(JetTokens.ENUM_KEYWORD) ? PlatformIcons.ENUM_ICON : PlatformIcons.CLASS_ICON;
    if (jetClass instanceof JetEnumEntry) {
      JetEnumEntry enumEntry=(JetEnumEntry)jetClass;
      if (enumEntry.getPrimaryConstructorParameterList() == null) {
        icon=PlatformIcons.ENUM_ICON;
      }
    }
    return icon;
  }
  if (psiElement instanceof JetObjectDeclaration || psiElement instanceof JetClassObject) {
    return JetIcons.OBJECT;
  }
  if (psiElement instanceof JetParameter) {
    JetParameter parameter=(JetParameter)psiElement;
    if (parameter.getValOrVarNode() != null) {
      JetParameterList parameterList=PsiTreeUtil.getParentOfType(psiElement,JetParameterList.class);
      if (parameterList != null && parameterList.getParent() instanceof JetClass) {
        return parameter.isVarArg() ? JetIcons.VAR : JetIcons.VAL;
      }
    }
    return JetIcons.PARAMETER;
  }
  if (psiElement instanceof JetProperty) {
    JetProperty property=(JetProperty)psiElement;
    return property.isVar() ? JetIcons.VAR : JetIcons.VAL;
  }
  return null;
}
