{
  if (d instanceof VariableDescriptor) {
    VariableDescriptor vd=(VariableDescriptor)d;
    EnclosedValueDescriptor answer=closure.get(vd);
    if (answer != null)     return answer.getInnerValue();
    final int idx=context.lookupLocal(vd);
    if (idx < 0)     return null;
    final Type type=state.getTypeMapper().mapType(vd.getOutType());
    StackValue outerValue=StackValue.local(idx,type);
    final String fieldName="$" + (closure.size() + 1);
    StackValue innerValue=StackValue.field(type,name,fieldName,false);
    cv.visitField(Opcodes.ACC_PUBLIC,fieldName,type.getDescriptor(),null,null);
    answer=new EnclosedValueDescriptor(d,innerValue,outerValue);
    closure.put(d,answer);
    return innerValue;
  }
  return null;
}
