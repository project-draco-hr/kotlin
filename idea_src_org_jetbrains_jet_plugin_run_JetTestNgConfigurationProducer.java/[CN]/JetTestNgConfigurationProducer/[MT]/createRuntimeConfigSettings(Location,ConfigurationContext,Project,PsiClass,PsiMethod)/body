{
  if (delegate == null) {
    return null;
  }
  RunnerAndConfigurationSettings settings=cloneTemplateConfiguration(project,context);
  TestNGConfiguration configuration=(TestNGConfiguration)settings.getConfiguration();
  setupConfigurationModule(context,configuration);
  Module originalModule=configuration.getConfigurationModule().getModule();
  configuration.setClassConfiguration(delegate);
  if (method != null) {
    configuration.setMethodConfiguration(PsiLocation.fromPsiElement(project,method));
  }
  configuration.restoreOriginalModule(originalModule);
  settings.setName(configuration.getName());
  JavaRunConfigurationExtensionManager.getInstance().extendCreatedConfiguration(configuration,location);
  return settings;
}
