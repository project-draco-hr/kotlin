{
  if (state.getClassBuilderMode() != ClassBuilderMode.FULL)   return;
  KotlinClass.Kind kind;
  if (isAnonymousObject(descriptor)) {
    kind=KotlinClass.Kind.ANONYMOUS_OBJECT;
  }
 else   if (isTopLevelOrInnerClass(descriptor)) {
    kind=null;
  }
 else {
    kind=KotlinClass.Kind.LOCAL_CLASS;
  }
  if (kind == null) {
    kind=KotlinClass.Kind.CLASS;
  }
  DescriptorSerializer serializer=DescriptorSerializer.create(descriptor,new JvmSerializerExtension(v.getSerializationBindings(),typeMapper));
  ProtoBuf.Class classProto=serializer.classProto(descriptor).build();
  StringTable strings=serializer.getStringTable();
  NameResolver nameResolver=new NameResolver(strings.serializeSimpleNames(),strings.serializeQualifiedNames());
  ClassData data=new ClassData(nameResolver,classProto);
  AnnotationVisitor av=v.getVisitor().visitAnnotation(asmDescByFqNameWithoutInnerClasses(JvmAnnotationNames.KOTLIN_CLASS),true);
  JvmCodegenUtil.writeAbiVersion(av);
  if (kind != null) {
    av.visitEnum(JvmAnnotationNames.KIND_FIELD_NAME,Type.getObjectType(KotlinClass.KIND_INTERNAL_NAME).getDescriptor(),kind.toString());
  }
  AnnotationVisitor array=av.visitArray(JvmAnnotationNames.DATA_FIELD_NAME);
  for (  String string : BitEncoding.encodeBytes(SerializationUtil.serializeClassData(data))) {
    array.visit(null,string);
  }
  array.visitEnd();
  av.visitEnd();
}
