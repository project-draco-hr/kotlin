{
  StringBuilder sb=new StringBuilder();
  boolean inQuotes=false;
  for (int i=0; i < invalidXml.length(); i++) {
    char c=invalidXml.charAt(i);
switch (c) {
case '\'':
case '\"':
      inQuotes=!inQuotes;
    sb.append('\"');
  break;
case '<':
if (inQuotes) {
  sb.append("&lt;");
}
 else {
  sb.append(c);
}
break;
case '>':
if (inQuotes) {
sb.append("&gt;");
}
 else {
sb.append(c);
}
break;
default :
sb.append(c);
break;
}
}
return sb.toString();
}
