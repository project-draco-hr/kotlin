{
  if (expressionType == null || context.expectedType == null || context.expectedType == TypeUtils.NO_EXPECTED_TYPE || JetTypeChecker.INSTANCE.isSubtypeOf(expressionType,context.expectedType)) {
    return expressionType;
  }
  DataFlowValue dataFlowValue=DataFlowValueFactory.INSTANCE.createDataFlowValue(expression,expressionType,context.trace.getBindingContext());
  for (  JetType possibleType : context.dataFlowInfo.getPossibleTypes(dataFlowValue)) {
    if (JetTypeChecker.INSTANCE.isSubtypeOf(possibleType,context.expectedType)) {
      if (dataFlowValue.isStableIdentifier()) {
        context.trace.record(AUTOCAST,expression,possibleType);
      }
 else {
        context.trace.report(AUTOCAST_IMPOSSIBLE.on(expression,possibleType,expression.getText()));
      }
      return possibleType;
    }
  }
  context.trace.report(TYPE_MISMATCH.on(expression,context.expectedType,expressionType));
  return expressionType;
}
