{
  if (element instanceof JetFile) {
    Project project=element.getProject();
    JetFile file=(JetFile)element;
    try {
      final Collection<DeclarationDescriptor> redeclarations=new HashSet<DeclarationDescriptor>();
      final BindingContext bindingContext=AnalyzingUtils.analyzeFile(file,new ErrorHandler(){
        @Override public void unresolvedReference(        JetReferenceExpression referenceExpression){
          PsiReference reference=referenceExpression.getReference();
          if (reference instanceof MultiRangeReference) {
            MultiRangeReference mrr=(MultiRangeReference)reference;
            for (            TextRange range : mrr.getRanges()) {
              holder.createErrorAnnotation(range.shiftRight(referenceExpression.getTextOffset()),"Unresolved").setHighlightType(ProblemHighlightType.LIKE_UNKNOWN_SYMBOL);
            }
          }
 else {
            holder.createErrorAnnotation(referenceExpression,"Unresolved").setHighlightType(ProblemHighlightType.LIKE_UNKNOWN_SYMBOL);
          }
        }
        @Override public void typeMismatch(        JetExpression expression,        JetType expectedType,        JetType actualType){
          holder.createErrorAnnotation(expression,"Type mismatch: inferred type is " + actualType + " but "+ expectedType+ " was expected");
        }
        @Override public void redeclaration(        DeclarationDescriptor existingDescriptor,        DeclarationDescriptor redeclaredDescriptor){
          redeclarations.add(existingDescriptor);
          redeclarations.add(redeclaredDescriptor);
        }
        @Override public void genericError(        @NotNull ASTNode node,        String errorMessage){
          holder.createErrorAnnotation(node,errorMessage);
        }
        @Override public void genericWarning(        ASTNode node,        String message){
          holder.createWarningAnnotation(node,message);
        }
      }
);
      for (      DeclarationDescriptor redeclaration : redeclarations) {
        PsiElement declarationPsiElement=bindingContext.getDeclarationPsiElement(redeclaration);
        if (declarationPsiElement != null) {
          holder.createErrorAnnotation(declarationPsiElement,"Redeclaration");
        }
      }
      highlightBackingFields(holder,file,bindingContext);
    }
 catch (    ProcessCanceledException e) {
      throw e;
    }
catch (    Throwable e) {
      holder.createErrorAnnotation(element,e.getClass().getCanonicalName() + ": " + e.getMessage());
      e.printStackTrace();
    }
  }
}
