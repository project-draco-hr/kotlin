{
  PackageViewDescriptor rootPackageDescriptor=resolveSession.getModuleDescriptor().getPackage(FqName.ROOT);
  if (rootPackageDescriptor == null) {
    throw new IllegalStateException("Root package not found");
  }
  PackageViewDescriptor packageDescriptor=getFilePackageDescriptor(file);
  JetScope importsScope=LazyImportScope.createImportScopeForFile(resolveSession,packageDescriptor,file,resolveSession.getTrace(),"Lazy Imports Scope for file " + file.getName());
  return new ChainedScope(resolveSession.getPackageFragment(JetPsiUtil.getFQName(file)),"File scope: " + file.getName(),packageDescriptor.getMemberScope(),rootPackageDescriptor.getMemberScope(),importsScope,defaultImportsScope.invoke());
}
