{
  NamespaceDescriptor rootPackageDescriptor=resolveSession.getPackageDescriptorByFqName(FqName.ROOT);
  if (rootPackageDescriptor == null) {
    throw new IllegalStateException("Root package not found");
  }
  NamespaceDescriptor packageDescriptor=getFilePackageDescriptor(file);
  JetScope importsScope=LazyImportScope.createImportScopeForFile(resolveSession,packageDescriptor,file,resolveSession.getTrace(),"Lazy Imports Scope for file " + file.getName());
  return new ChainedScope(packageDescriptor,"File scope: " + file.getName(),packageDescriptor.getMemberScope(),rootPackageDescriptor.getMemberScope(),importsScope,defaultImportsScope.compute());
}
