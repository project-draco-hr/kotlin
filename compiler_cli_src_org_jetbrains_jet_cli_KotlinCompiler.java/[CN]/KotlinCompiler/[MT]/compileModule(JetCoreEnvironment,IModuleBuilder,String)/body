{
  CompileSession moduleCompileSession=new CompileSession(environment);
  for (  String sourceFile : moduleBuilder.getSourceFiles()) {
    moduleCompileSession.addSources(new File(directory,sourceFile).getPath());
  }
  for (  String classpathRoot : moduleBuilder.getClasspathRoots()) {
    environment.addToClasspath(new File(classpathRoot));
  }
  if (!moduleCompileSession.analyze()) {
    return;
  }
  ClassFileFactory factory=moduleCompileSession.generate();
  writeToJar(factory,new File(directory,moduleBuilder.getModuleName() + ".jar").getPath(),null,true);
}
