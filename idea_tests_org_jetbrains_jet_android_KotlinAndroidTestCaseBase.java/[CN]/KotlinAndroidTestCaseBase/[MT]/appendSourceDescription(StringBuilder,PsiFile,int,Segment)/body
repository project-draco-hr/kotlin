{
  if (file != null && segment != null) {
    if (ResourceHelper.getFolderType(file) != null) {
      assertNotNull(file.getParent());
      sb.append(file.getParent().getName());
      sb.append("/");
    }
    sb.append(file.getName());
    sb.append(':');
    String text=file.getText();
    int lineNumber=1;
    for (int i=0; i < offset; i++) {
      if (text.charAt(i) == '\n') {
        lineNumber++;
      }
    }
    sb.append(lineNumber);
    sb.append(":");
    sb.append('\n');
    int startOffset=segment.getStartOffset();
    int endOffset=segment.getEndOffset();
    assertTrue(offset == -1 || offset >= startOffset);
    assertTrue(offset == -1 || offset <= endOffset);
    int lineStart=startOffset;
    while (lineStart > 0 && text.charAt(lineStart - 1) != '\n') {
      lineStart--;
    }
    while (lineStart < startOffset && Character.isWhitespace(text.charAt(lineStart))) {
      lineStart++;
    }
    int lineEnd=startOffset;
    while (lineEnd < text.length() && text.charAt(lineEnd) != '\n') {
      lineEnd++;
    }
    String indent="  ";
    sb.append(indent);
    sb.append(text.substring(lineStart,lineEnd));
    sb.append('\n');
    sb.append(indent);
    for (int i=lineStart; i < lineEnd; i++) {
      if (i == offset) {
        sb.append('|');
      }
 else       if (i >= startOffset && i <= endOffset) {
        sb.append('~');
      }
 else {
        sb.append(' ');
      }
    }
  }
 else {
    sb.append(offset);
    sb.append(":?");
  }
  sb.append('\n');
}
