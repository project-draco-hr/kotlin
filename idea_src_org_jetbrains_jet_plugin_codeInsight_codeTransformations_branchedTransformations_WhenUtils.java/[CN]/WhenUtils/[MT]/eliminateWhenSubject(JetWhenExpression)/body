{
  JetExpression subject=whenExpression.getSubjectExpression();
  assertNotNull(subject);
  JetPsiFactory.WhenBuilder builder=new JetPsiFactory.WhenBuilder();
  for (  JetWhenEntry entry : whenExpression.getEntries()) {
    JetExpression branchExpression=entry.getExpression();
    if (entry.isElse()) {
      builder.elseEntry(branchExpression);
      continue;
    }
    for (    JetWhenCondition condition : entry.getConditions()) {
      builder.condition(whenConditionToExpressionText(condition,subject));
    }
    builder.branchExpression(branchExpression);
  }
  whenExpression.replace(builder.toExpression(whenExpression.getProject()));
}
