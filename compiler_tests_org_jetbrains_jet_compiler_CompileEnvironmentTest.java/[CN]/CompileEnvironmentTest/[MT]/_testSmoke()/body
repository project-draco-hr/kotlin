{
  final File activeRtJar=CompileEnvironment.findRtJar();
  environment.setJavaRuntime(activeRtJar);
  environment.initializeKotlinRuntime();
  final String testDataDir=JetParsingTest.getTestDataDir() + "/compiler/smoke/";
  final List<Module> modules=environment.loadModuleScript(testDataDir + "Smoke.kts");
  assertEquals(1,modules.size());
  final Module moduleBuilder=modules.get(0);
  final ClassFileFactory factory=environment.compileModule(moduleBuilder,testDataDir);
  assertNotNull(factory);
  assertNotNull(factory.asBytes("Smoke/namespace.class"));
  ByteArrayOutputStream baos=new ByteArrayOutputStream();
  CompileEnvironment.writeToJar(factory,baos,null,false);
  JarInputStream is=new JarInputStream(new ByteArrayInputStream(baos.toByteArray()));
  final List<String> entries=listEntries(is);
  assertTrue(entries.contains("Smoke/namespace.class"));
}
