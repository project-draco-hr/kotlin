{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      Library library=findOrCreateRuntimeLibrary(module);
      if (library != null) {
        ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
        if (model.findLibraryOrderEntry(library) == null) {
          model.addLibraryEntry(library);
          model.commit();
        }
 else {
          model.dispose();
        }
        updateNotifications();
      }
      if (!jdkAnnotationsArePresent(module)) {
        addJdkAnnotations(module);
      }
    }
  }
);
}
