{
  JetExpression receiverExpression=expression.getReceiverExpression();
  if (receiverExpression != null) {
    JetScope resolutionScope=context.get(BindingContext.RESOLUTION_SCOPE,expression);
    JetType expressionType=context.get(BindingContext.EXPRESSION_TYPE,receiverExpression);
    if (expressionType != null && resolutionScope != null && !ErrorUtils.isErrorType(expressionType)) {
      if (!(expressionType instanceof NamespaceType)) {
        ExpressionReceiver receiverValue=new ExpressionReceiver(receiverExpression,expressionType);
        Set<DeclarationDescriptor> descriptors=new HashSet<DeclarationDescriptor>();
        DataFlowInfo info=context.get(BindingContext.NON_DEFAULT_EXPRESSION_DATA_FLOW,expression);
        if (info == null) {
          info=DataFlowInfo.EMPTY;
        }
        AutoCastServiceImpl autoCastService=new AutoCastServiceImpl(info,context);
        List<ReceiverValue> variantsForExplicitReceiver=autoCastService.getVariantsForReceiver(receiverValue);
        for (        ReceiverValue descriptor : variantsForExplicitReceiver) {
          descriptors.addAll(includeExternalCallableExtensions(excludePrivateDescriptors(descriptor.getType().getMemberScope().getAllDescriptors()),resolutionScope,descriptor));
        }
        return descriptors;
      }
      return includeExternalCallableExtensions(excludePrivateDescriptors(expressionType.getMemberScope().getAllDescriptors()),resolutionScope,new ExpressionReceiver(receiverExpression,expressionType));
    }
    return Collections.emptyList();
  }
 else {
    return getVariantsNoReceiver(expression,context);
  }
}
