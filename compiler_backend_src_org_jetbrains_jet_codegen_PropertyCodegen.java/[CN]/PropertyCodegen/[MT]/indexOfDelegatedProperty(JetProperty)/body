{
  PsiElement parent=property.getParent();
  JetDeclarationContainer container;
  if (parent instanceof JetClassBody) {
    container=((JetClassOrObject)parent.getParent());
  }
 else   if (parent instanceof JetFile) {
    container=(JetFile)parent;
  }
 else {
    throw new UnsupportedOperationException("Unknown delegated property container: " + parent);
  }
  int index=0;
  for (  JetDeclaration declaration : container.getDeclarations()) {
    if (declaration instanceof JetProperty && ((JetProperty)declaration).getDelegate() != null) {
      if (declaration == property) {
        return index;
      }
      index++;
    }
  }
  throw new IllegalStateException("Delegated property not found in its parent: " + JetPsiUtil.getElementTextWithContext(property));
}
