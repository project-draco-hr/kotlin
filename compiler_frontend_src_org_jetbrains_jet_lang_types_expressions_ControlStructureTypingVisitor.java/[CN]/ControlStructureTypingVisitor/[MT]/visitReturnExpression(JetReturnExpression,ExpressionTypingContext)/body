{
  context.labelResolver.recordLabel(expression,context);
  if (context.expectedReturnType == TypeUtils.FORBIDDEN) {
    context.trace.report(RETURN_NOT_ALLOWED.on(expression));
    return null;
  }
  JetExpression returnedExpression=expression.getReturnedExpression();
  JetType returnedType=JetStandardClasses.getUnitType();
  if (returnedExpression != null) {
    facade.getType(returnedExpression,context.replaceExpectedType(context.expectedReturnType).replaceScope(context.scope));
  }
 else {
    if (context.expectedReturnType != TypeUtils.NO_EXPECTED_TYPE && !JetStandardClasses.isUnit(context.expectedReturnType)) {
      context.trace.report(RETURN_TYPE_MISMATCH.on(expression,context.expectedReturnType));
    }
  }
  return DataFlowUtils.checkType(JetStandardClasses.getNothingType(),expression,context);
}
