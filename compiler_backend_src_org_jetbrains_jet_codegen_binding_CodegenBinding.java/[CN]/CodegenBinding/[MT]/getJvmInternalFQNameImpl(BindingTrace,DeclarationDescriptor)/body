{
  if (descriptor instanceof FunctionDescriptor) {
    throw new IllegalStateException("requested fq name for function: " + descriptor);
  }
  if (descriptor instanceof ModuleDescriptor) {
    throw new IllegalStateException("missed something");
  }
  DeclarationDescriptor container=descriptor.getContainingDeclaration();
  if (container == null) {
    throw new IllegalStateException("descriptor has no container: " + descriptor);
  }
  if (container.getContainingDeclaration() instanceof ModuleDescriptor || container instanceof ScriptDescriptor) {
    return descriptor.getName().getIdentifier();
  }
  String containerInternalName=getJvmInternalName(bindingTrace,container).getInternalName();
  if (descriptor instanceof ClassDescriptor && container instanceof ClassDescriptor) {
    ClassDescriptor klass=(ClassDescriptor)descriptor;
    if (klass.getKind() == ClassKind.OBJECT || klass.getKind() == ClassKind.CLASS_OBJECT) {
      if (isEnumClass(container)) {
        return containerInternalName;
      }
 else       if (klass.getKind() == ClassKind.OBJECT) {
        return containerInternalName + "$" + klass.getName();
      }
 else {
        return containerInternalName + JvmAbi.CLASS_OBJECT_SUFFIX;
      }
    }
  }
  return containerInternalName + (container instanceof NamespaceDescriptor ? "/" : "$") + descriptor.getName().getIdentifier();
}
