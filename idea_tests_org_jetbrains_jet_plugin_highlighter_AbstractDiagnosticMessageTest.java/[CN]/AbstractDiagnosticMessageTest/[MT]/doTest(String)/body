{
  File file=new File(filePath);
  String fileName=file.getName();
  String fileData=JetTestUtils.doLoadFile(file);
  Map<String,String> directives=JetTestUtils.parseDirectives(fileData);
  int diagnosticNumber=getDiagnosticNumber(directives);
  final Set<DiagnosticFactory> diagnosticFactories=getDiagnosticFactories(directives);
  MessageType messageType=getMessageTypeDirective(directives);
  JetFile psiFile=createPsiFile(null,fileName,loadFile(fileName));
  AnalyzeExhaust analyzeExhaust=JvmResolveUtil.analyzeOneFileWithJavaIntegration(psiFile);
  BindingContext bindingContext=analyzeExhaust.getBindingContext();
  List<Diagnostic> diagnostics=ContainerUtil.filter(bindingContext.getDiagnostics().all(),new Condition<Diagnostic>(){
    @Override public boolean value(    Diagnostic diagnostic){
      return diagnosticFactories.contains(diagnostic.getFactory());
    }
  }
);
  assertEquals("Expected diagnostics number mismatch:",diagnosticNumber,diagnostics.size());
  int index=1;
  String name=FileUtil.getNameWithoutExtension(fileName);
  for (  Diagnostic diagnostic : diagnostics) {
    String readableDiagnosticText;
    String extension;
    if (messageType != MessageType.TEXT && IdeErrorMessages.MAP.get(diagnostic.getFactory()) != null) {
      readableDiagnosticText=formatHtml(IdeErrorMessages.RENDERER.render(diagnostic));
      extension=MessageType.HTML.extension;
    }
 else {
      readableDiagnosticText=DefaultErrorMessages.RENDERER.render(diagnostic);
      extension=MessageType.TEXT.extension;
    }
    String errorMessageFileName=name + index;
    String path=getTestDataPath() + "/" + errorMessageFileName+ "."+ extension;
    String actualText="<!-- " + errorMessageFileName + " -->\n"+ readableDiagnosticText;
    assertSameLinesWithFile(path,actualText);
    index++;
  }
}
