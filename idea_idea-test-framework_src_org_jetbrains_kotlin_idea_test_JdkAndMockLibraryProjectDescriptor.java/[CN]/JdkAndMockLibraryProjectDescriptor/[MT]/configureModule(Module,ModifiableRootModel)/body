{
  File libraryJar=MockLibraryUtil.compileLibraryToJar(sourcesPath,LIBRARY_NAME,withSources,isJsLibrary);
  String jarUrl="jar://" + FileUtilRt.toSystemIndependentName(libraryJar.getAbsolutePath()) + "!/";
  Library.ModifiableModel libraryModel=model.getModuleLibraryTable().getModifiableModel().createLibrary(LIBRARY_NAME).getModifiableModel();
  libraryModel.addRoot(jarUrl,OrderRootType.CLASSES);
  if (withSources) {
    libraryModel.addRoot(jarUrl + "src/",OrderRootType.SOURCES);
  }
  libraryModel.commit();
}
