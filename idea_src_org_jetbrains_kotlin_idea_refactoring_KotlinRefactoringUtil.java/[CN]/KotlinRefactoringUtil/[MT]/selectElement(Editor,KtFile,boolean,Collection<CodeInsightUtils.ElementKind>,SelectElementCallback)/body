{
  if (editor.getSelectionModel().hasSelection()) {
    int selectionStart=editor.getSelectionModel().getSelectionStart();
    int selectionEnd=editor.getSelectionModel().getSelectionEnd();
    String text=file.getText();
    while (selectionStart < selectionEnd && Character.isSpaceChar(text.charAt(selectionStart)))     ++selectionStart;
    while (selectionStart < selectionEnd && Character.isSpaceChar(text.charAt(selectionEnd - 1)))     --selectionEnd;
    for (    CodeInsightUtils.ElementKind elementKind : elementKinds) {
      PsiElement element=findElement(file,selectionStart,selectionEnd,failOnEmptySuggestion,elementKind);
      if (element != null) {
        callback.run(element);
        return;
      }
    }
    callback.run(null);
  }
 else {
    int offset=editor.getCaretModel().getOffset();
    smartSelectElement(editor,file,offset,failOnEmptySuggestion,elementKinds,callback);
  }
}
