{
  if (editor.getSelectionModel().hasSelection()) {
    int selectionStart=editor.getSelectionModel().getSelectionStart();
    int selectionEnd=editor.getSelectionModel().getSelectionEnd();
    String text=file.getText();
    while (selectionStart < selectionEnd && Character.isSpaceChar(text.charAt(selectionStart)))     ++selectionStart;
    while (selectionStart < selectionEnd && Character.isSpaceChar(text.charAt(selectionEnd - 1)))     --selectionEnd;
    callback.run(findElement(file,selectionStart,selectionEnd,failOnEmptySuggestion,elementKind));
  }
 else {
    int offset=editor.getCaretModel().getOffset();
    smartSelectElement(editor,file,offset,failOnEmptySuggestion,elementKind,callback);
  }
}
