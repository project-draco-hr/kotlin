{
  boolean thisDone=false;
  ClassContext cur=context;
  while (true) {
    ClassContext parentContext=cur.getParentContext();
    if (parentContext == null)     break;
    final DeclarationDescriptor curContextType=cur.getContextType();
    if (curContextType instanceof ClassDescriptor) {
      if (isSubclass((ClassDescriptor)curContextType,calleeContainingClass))       break;
      final StackValue outer;
      if (!thisDone && myMap instanceof ConstructorFrameMap) {
        outer=StackValue.local(((ConstructorFrameMap)myMap).getOuterThisIndex(),JetTypeMapper.TYPE_OBJECT);
      }
 else {
        thisToStack();
        outer=StackValue.field(parentContext.jvmType(typeMapper),cur.jvmType(typeMapper).getInternalName(),"this$0",false);
      }
      thisDone=true;
      outer.put(outer.type,v);
    }
    cur=parentContext;
  }
  if (!thisDone) {
    thisToStack();
  }
}
