{
  if (expression.getLeft() instanceof JetArrayAccessExpression) {
    final JetArrayAccessExpression arrayAccess=(JetArrayAccessExpression)expression.getLeft();
    final Type arrayType=expressionType(arrayAccess.getArrayExpression());
    if (arrayType.getSort() == Type.ARRAY) {
      gen(arrayAccess.getArrayExpression(),arrayType);
      generateArrayIndex(arrayAccess);
      final Type elementType=arrayType.getElementType();
      gen(expression.getRight(),elementType);
      v.astore(elementType);
    }
 else {
      throw new UnsupportedOperationException("Don't know how to generate assignment to non-Java array " + expression.getLeft().getText());
    }
  }
 else   if (expression.getLeft() instanceof JetReferenceExpression) {
    final JetReferenceExpression lhs=(JetReferenceExpression)expression.getLeft();
    final int index=indexOfLocal(lhs);
    final Type type=typeMapper.mapType(bindingContext.getExpressionType(lhs));
    gen(expression.getRight(),type);
    v.store(index,type);
  }
 else {
    throw new UnsupportedOperationException("Don't know how to generate assignment to " + expression.getLeft().getText());
  }
}
