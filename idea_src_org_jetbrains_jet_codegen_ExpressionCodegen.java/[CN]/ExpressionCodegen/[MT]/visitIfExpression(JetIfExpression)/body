{
  JetType expressionType=bindingContext.getExpressionType(expression);
  Type asmType=typeMapper.mapType(expressionType);
  StackValue condition=generateIntermediateValue(expression.getCondition());
  JetExpression thenExpression=expression.getThen();
  JetExpression elseExpression=expression.getElse();
  if (thenExpression == null && elseExpression == null) {
    throw new CompilationException();
  }
  if (thenExpression == null) {
    generateSingleBranchIf(condition,elseExpression,false);
    return;
  }
  if (elseExpression == null) {
    generateSingleBranchIf(condition,thenExpression,true);
    return;
  }
  Label elseLabel=new Label();
  condition.condJump(elseLabel,true,v);
  gen(thenExpression,asmType);
  Label endLabel=new Label();
  v.goTo(endLabel);
  v.mark(elseLabel);
  gen(elseExpression,asmType);
  v.mark(endLabel);
  if (asmType != Type.VOID_TYPE) {
    myStack.push(StackValue.onStack(asmType));
  }
}
