{
  DeclarationDescriptor constructorDescriptor=bindingContext.get(BindingContext.REFERENCE_TARGET,constructorReference);
  final PsiElement declaration=bindingContext.get(BindingContext.DESCRIPTOR_TO_DECLARATION,constructorDescriptor);
  Type type;
  if (declaration instanceof PsiMethod) {
    type=generateJavaConstructorCall(expression,(PsiMethod)declaration);
  }
 else   if (constructorDescriptor instanceof ConstructorDescriptor) {
    type=typeMapper.mapType(bindingContext.get(BindingContext.EXPRESSION_TYPE,expression),OwnerKind.IMPLEMENTATION);
    if (type.getSort() == Type.ARRAY) {
      generateNewArray(expression,type);
    }
 else {
      ClassDescriptor classDecl=(ClassDescriptor)constructorDescriptor.getContainingDeclaration();
      v.anew(type);
      v.dup();
      pushOuterClassArguments(classDecl);
      CallableMethod method=typeMapper.mapToCallableMethod((ConstructorDescriptor)constructorDescriptor,OwnerKind.IMPLEMENTATION);
      invokeMethodWithArguments(method,expression);
    }
  }
 else {
    throw new UnsupportedOperationException("don't know how to generate this new expression");
  }
  return StackValue.onStack(type);
}
