{
  if (importString.startsWith(JavaDescriptorResolver.JAVA_ROOT + ".")) {
    importString=importString.substring((JavaDescriptorResolver.JAVA_ROOT + ".").length());
  }
  if (isImportedByDefault(importString,JetPsiUtil.getFQName(file))) {
    return;
  }
  List<JetImportDirective> importDirectives=file.getImportDirectives();
  JetImportDirective newDirective=JetPsiFactory.createImportDirective(file.getProject(),importString);
  if (!importDirectives.isEmpty()) {
    for (    JetImportDirective directive : importDirectives) {
      String importPath=JetPsiUtil.getImportPath(directive);
      if (importPath != null && QualifiedNamesUtil.isImported(importPath,importString)) {
        return;
      }
    }
    JetImportDirective lastDirective=importDirectives.get(importDirectives.size() - 1);
    lastDirective.getParent().addAfter(newDirective,lastDirective);
  }
 else {
    List<JetDeclaration> declarations=file.getDeclarations();
    if (!declarations.isEmpty()) {
      JetDeclaration firstDeclaration=declarations.iterator().next();
      firstDeclaration.getParent().addBefore(newDirective,firstDeclaration);
    }
 else {
      file.getNamespaceHeader().getParent().addAfter(newDirective,file.getNamespaceHeader());
    }
  }
}
