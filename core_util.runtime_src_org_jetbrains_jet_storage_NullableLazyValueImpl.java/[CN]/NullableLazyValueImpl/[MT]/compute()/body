{
  if (!(value instanceof State)) {
    return WrappedValues.unescapeThrowable(value);
  }
  if (value == State.COMPUTING) {
    Object result=recursionDetected(true);
    if (result != State.NOT_COMPUTED) {
      value=State.RECURSION_WAS_DETECTED;
      return WrappedValues.unescapeThrowable(result);
    }
  }
 else   if (value == State.RECURSION_WAS_DETECTED) {
    Object result=recursionDetected(false);
    if (result != State.NOT_COMPUTED) {
      return WrappedValues.unescapeThrowable(result);
    }
  }
  value=State.COMPUTING;
  try {
    T typedValue=doCompute();
    value=typedValue;
    postCompute(typedValue);
    return typedValue;
  }
 catch (  Throwable e) {
    value=WrappedValues.escapeThrowable(e);
    throw ExceptionUtils.rethrow(e);
  }
}
