{
  if (LightClassUtil.belongsToKotlinBuiltIns(file)) {
    LightClassUtil.logErrorWithOSInfo(null,qualifiedName,file.getVirtualFile());
  }
  final PsiJavaFileStubImpl answer=new PsiJavaFileStubImpl(JetPsiUtil.getFQName(file).getFqName(),true);
  final Project project=getProject();
  final Stack<StubElement> stubStack=new Stack<StubElement>();
  final ClassBuilderFactory builderFactory=new ClassBuilderFactory(){
    @NotNull @Override public ClassBuilderMode getClassBuilderMode(){
      return ClassBuilderMode.SIGNATURES;
    }
    @Override public ClassBuilder newClassBuilder(){
      return new StubClassBuilder(stubStack);
    }
    @Override public String asText(    ClassBuilder builder){
      throw new UnsupportedOperationException("asText is not implemented");
    }
    @Override public byte[] asBytes(    ClassBuilder builder){
      throw new UnsupportedOperationException("asBytes is not implemented");
    }
  }
;
  LightClassConstructionContext context=LightClassGenerationSupport.getInstance(project).analyzeRelevantCode(file);
  Throwable error=context.getError();
  if (error != null) {
    throw new IllegalStateException("failed to analyze: " + error,error);
  }
  try {
    GenerationState state=new GenerationState(project,builderFactory,context.getBindingContext(),Collections.singletonList(file));
    GenerationStrategy strategy=new LightClassGenerationStrategy(this,stubStack,answer);
    strategy.compileCorrectFiles(state,CompilationErrorHandler.THROW_EXCEPTION);
    state.getFactory().files();
  }
 catch (  ProcessCanceledException e) {
    throw e;
  }
catch (  RuntimeException e) {
    LightClassUtil.logErrorWithOSInfo(e,qualifiedName,file.getVirtualFile());
    throw e;
  }
  return answer;
}
