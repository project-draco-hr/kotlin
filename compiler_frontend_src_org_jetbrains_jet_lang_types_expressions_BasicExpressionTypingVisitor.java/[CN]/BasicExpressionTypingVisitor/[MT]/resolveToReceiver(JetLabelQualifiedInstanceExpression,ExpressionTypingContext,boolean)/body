{
  ReceiverParameterDescriptor thisReceiver=null;
  String labelName=expression.getLabelName();
  if (labelName != null) {
    thisReceiver=context.labelResolver.resolveThisLabel(expression.getInstanceReference(),expression.getTargetLabel(),context,thisReceiver,new LabelName(labelName));
  }
 else {
    List<ReceiverParameterDescriptor> receivers=JetScopeUtils.getImplicitReceiversHierarchy(context.scope);
    if (onlyClassReceivers) {
      for (      ReceiverParameterDescriptor receiver : receivers) {
        if (receiver.getContainingDeclaration() instanceof ClassDescriptor) {
          thisReceiver=receiver;
          break;
        }
      }
    }
 else     if (!receivers.isEmpty()) {
      thisReceiver=receivers.get(0);
    }
 else {
      thisReceiver=ReceiverParameterDescriptor.NO_RECEIVER_PARAMETER;
    }
    if (thisReceiver != null && thisReceiver.exists()) {
      context.trace.record(REFERENCE_TARGET,expression.getInstanceReference(),thisReceiver.getContainingDeclaration());
    }
  }
  return thisReceiver;
}
