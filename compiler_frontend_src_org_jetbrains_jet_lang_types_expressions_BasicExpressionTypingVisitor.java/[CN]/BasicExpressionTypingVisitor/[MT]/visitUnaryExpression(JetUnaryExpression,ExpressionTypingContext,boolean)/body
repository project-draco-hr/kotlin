{
  JetExpression baseExpression=expression.getBaseExpression();
  if (baseExpression == null)   return null;
  JetSimpleNameExpression operationSign=expression.getOperationReference();
  if (JetTokens.LABELS.contains(operationSign.getReferencedNameElementType())) {
    String referencedName=operationSign.getReferencedName();
    referencedName=referencedName == null ? " <?>" : referencedName;
    context.labelResolver.enterLabeledElement(referencedName.substring(1),baseExpression);
    ExpressionTypingContext newContext=context.replaceExpectedReturnType(context.expectedType);
    JetType type=facade.getType(baseExpression,newContext,isStatement);
    context.labelResolver.exitLabeledElement(baseExpression);
    return DataFlowUtils.checkType(type,expression,context);
  }
  IElementType operationType=operationSign.getReferencedNameElementType();
  String name=OperatorConventions.UNARY_OPERATION_NAMES.get(operationType);
  if (name == null) {
    context.trace.report(UNSUPPORTED.on(operationSign,"visitUnaryExpression"));
    return null;
  }
  ExpressionReceiver receiver=getExpressionReceiver(facade,baseExpression,context.replaceExpectedType(NO_EXPECTED_TYPE).replaceScope(context.scope));
  if (receiver == null)   return null;
  OverloadResolutionResults<FunctionDescriptor> functionDescriptor=context.resolveCallWithGivenNameToDescriptor(CallMaker.makeCall(receiver,expression),expression.getOperationReference(),name);
  if (!functionDescriptor.isSuccess())   return null;
  JetType returnType=functionDescriptor.getResultingDescriptor().getReturnType();
  JetType result;
  if (operationType == JetTokens.PLUSPLUS || operationType == JetTokens.MINUSMINUS) {
    if (context.semanticServices.getTypeChecker().isSubtypeOf(returnType,JetStandardClasses.getUnitType())) {
      result=JetStandardClasses.getUnitType();
    }
 else {
      JetType receiverType=receiver.getType();
      if (!context.semanticServices.getTypeChecker().isSubtypeOf(returnType,receiverType)) {
        context.trace.report(RESULT_TYPE_MISMATCH.on(operationSign,name,receiverType,returnType));
      }
 else {
        context.trace.record(BindingContext.VARIABLE_REASSIGNMENT,expression);
        ExpressionTypingUtils.checkWrappingInRef(baseExpression,context);
        checkLValue(context.trace,baseExpression);
      }
      result=receiverType;
    }
  }
 else {
    result=returnType;
  }
  return DataFlowUtils.checkType(result,expression,context);
}
