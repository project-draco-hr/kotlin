{
  CompilerConfiguration configuration=new CompilerConfiguration();
  addJavaSourceRoots(configuration,javaSource);
  if (jdkKind == TestJdkKind.MOCK_JDK) {
    addJvmClasspathRoot(configuration,findMockJdkRtJar());
  }
 else   if (jdkKind == TestJdkKind.ANDROID_API) {
    addJvmClasspathRoot(configuration,findAndroidApiJar());
  }
 else {
    addJvmClasspathRoots(configuration,PathUtil.getJdkClassesRoots());
  }
  if (configurationKind.getWithRuntime()) {
    addJvmClasspathRoot(configuration,ForTestCompileRuntime.runtimeJarForTests());
  }
  if (configurationKind.getWithReflection()) {
    addJvmClasspathRoot(configuration,ForTestCompileRuntime.reflectJarForTests());
  }
  addJvmClasspathRoots(configuration,classpath);
  if (configurationKind.getWithJdkAnnotations()) {
    if (jdkKind == TestJdkKind.ANDROID_API) {
      configuration.add(ANNOTATIONS_PATH_KEY,getAndroidSdkAnnotationsJar());
    }
 else {
      configuration.add(ANNOTATIONS_PATH_KEY,getJdkAnnotationsJar());
    }
  }
  configuration.put(MODULE_NAME,"compilerConfigurationForTests");
  return configuration;
}
