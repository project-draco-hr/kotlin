{
  CompilerConfiguration configuration=new CompilerConfiguration();
  configuration.addAll(CLASSPATH_KEY,priorityClasspath);
  if (jdkKind == TestJdkKind.MOCK_JDK) {
    configuration.add(CLASSPATH_KEY,findMockJdkRtJar());
  }
 else   if (jdkKind == TestJdkKind.ANDROID_API) {
    configuration.add(CLASSPATH_KEY,findAndroidApiJar());
  }
 else {
    configuration.addAll(CLASSPATH_KEY,PathUtil.getJdkClassesRoots());
  }
  if (configurationKind == ALL) {
    configuration.add(CLASSPATH_KEY,ForTestCompileRuntime.runtimeJarForTests());
    configuration.add(CLASSPATH_KEY,ForTestCompileRuntime.reflectJarForTests());
  }
  configuration.addAll(CLASSPATH_KEY,extraClasspath);
  if (configurationKind == ALL || configurationKind == JDK_AND_ANNOTATIONS) {
    if (jdkKind == TestJdkKind.ANDROID_API) {
      configuration.add(ANNOTATIONS_PATH_KEY,getAndroidSdkAnnotationsJar());
    }
 else {
      configuration.add(ANNOTATIONS_PATH_KEY,getJdkAnnotationsJar());
    }
  }
  return configuration;
}
