{
  CompilerJarLocator locator=configuration.get(JVMConfigurationKeys.COMPILER_JAR_LOCATOR);
  File pluginRoot=locator == null ? PathUtil.getPathUtilJar() : locator.getCompilerJar();
  Application app=ApplicationManager.getApplication();
  File parentFile=pluginRoot.getParentFile();
  if (pluginRoot.isDirectory() && app != null && app.isUnitTestMode() && FileUtil.toCanonicalPath(parentFile.getPath()).endsWith("out/production")) {
    File srcDir=parentFile.getParentFile().getParentFile();
    pluginRoot=new File(srcDir,"idea/src");
  }
  CoreApplicationEnvironment.registerExtensionPointAndExtensions(pluginRoot,configFilePath,Extensions.getRootArea());
}
