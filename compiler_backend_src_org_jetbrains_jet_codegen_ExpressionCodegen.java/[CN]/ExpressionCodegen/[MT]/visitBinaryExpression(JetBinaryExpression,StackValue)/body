{
  final IElementType opToken=expression.getOperationReference().getReferencedNameElementType();
  if (opToken == JetTokens.EQ) {
    return generateAssignmentExpression(expression);
  }
 else   if (JetTokens.AUGMENTED_ASSIGNMENTS.contains(opToken)) {
    return generateAugmentedAssignment(expression);
  }
 else   if (opToken == JetTokens.ANDAND) {
    return generateBooleanAnd(expression);
  }
 else   if (opToken == JetTokens.OROR) {
    return generateBooleanOr(expression);
  }
 else   if (opToken == JetTokens.EQEQ || opToken == JetTokens.EXCLEQ || opToken == JetTokens.EQEQEQ || opToken == JetTokens.EXCLEQEQEQ) {
    return generateEquals(expression.getLeft(),expression.getRight(),opToken);
  }
 else   if (opToken == JetTokens.LT || opToken == JetTokens.LTEQ || opToken == JetTokens.GT || opToken == JetTokens.GTEQ) {
    return generateCompareOp(expression.getLeft(),expression.getRight(),opToken,expressionType(expression.getLeft()));
  }
 else   if (opToken == JetTokens.ELVIS) {
    return generateElvis(expression);
  }
 else   if (opToken == JetTokens.IN_KEYWORD || opToken == JetTokens.NOT_IN) {
    return generateIn(expression);
  }
 else {
    DeclarationDescriptor op=bindingContext.get(BindingContext.REFERENCE_TARGET,expression.getOperationReference());
    final Callable callable=resolveToCallable(op);
    if (callable instanceof IntrinsicMethod) {
      IntrinsicMethod intrinsic=(IntrinsicMethod)callable;
      return intrinsic.generate(this,v,expressionType(expression),expression,Arrays.asList(expression.getLeft(),expression.getRight()),receiver);
    }
 else {
      CallableMethod callableMethod=(CallableMethod)callable;
      genToJVMStack(expression.getLeft());
      genToJVMStack(expression.getRight());
      callableMethod.invoke(v);
      return returnValueAsStackValue((FunctionDescriptor)op,callableMethod.getSignature().getReturnType());
    }
  }
}
