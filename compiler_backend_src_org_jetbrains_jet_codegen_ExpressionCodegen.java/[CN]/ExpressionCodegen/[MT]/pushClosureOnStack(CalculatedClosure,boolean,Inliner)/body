{
  if (closure != null) {
    int paramIndex=0;
    if (!ignoreThisAndReceiver) {
      ClassDescriptor captureThis=closure.getCaptureThis();
      if (captureThis != null) {
        StackValue thisOrOuter=generateThisOrOuter(captureThis,false);
        if (inliner.shouldPutValue(OBJECT_TYPE,thisOrOuter,context,null)) {
          thisOrOuter.put(OBJECT_TYPE,v);
        }
        inliner.putCapturedInLocal(OBJECT_TYPE,thisOrOuter,null,paramIndex++);
      }
      JetType captureReceiver=closure.getCaptureReceiverType();
      if (captureReceiver != null) {
        Type asmType=typeMapper.mapType(captureReceiver);
        StackValue.Local capturedReceiver=StackValue.local(context.isStatic() ? 0 : 1,asmType);
        if (inliner.shouldPutValue(asmType,capturedReceiver,context,null)) {
          capturedReceiver.put(asmType,v);
        }
        inliner.putCapturedInLocal(asmType,capturedReceiver,null,paramIndex++);
      }
    }
    for (    Map.Entry<DeclarationDescriptor,EnclosedValueDescriptor> entry : closure.getCaptureVariables().entrySet()) {
      Type sharedVarType=typeMapper.getSharedVarType(entry.getKey());
      if (sharedVarType == null) {
        sharedVarType=typeMapper.mapType((VariableDescriptor)entry.getKey());
      }
      StackValue capturedVar=entry.getValue().getOuterValue(this);
      if (inliner.shouldPutValue(sharedVarType,capturedVar,context,null)) {
        capturedVar.put(sharedVarType,v);
      }
      inliner.putCapturedInLocal(sharedVarType,capturedVar,null,paramIndex++);
    }
  }
}
