{
  if (closure != null) {
    if (!ignoreThisAndReceiver) {
      ClassDescriptor captureThis=closure.getCaptureThis();
      if (captureThis != null) {
        StackValue thisOrOuter=generateThisOrOuter(captureThis,false);
        thisOrOuter.put(OBJECT_TYPE,v);
        inliner.putInLocal(OBJECT_TYPE,thisOrOuter);
      }
      JetType captureReceiver=closure.getCaptureReceiverType();
      if (captureReceiver != null) {
        Type asmType=typeMapper.mapType(captureReceiver);
        StackValue.Local capturedReceiver=StackValue.local(context.isStatic() ? 0 : 1,asmType);
        capturedReceiver.put(asmType,v);
        inliner.putInLocal(asmType,capturedReceiver);
      }
    }
    for (    Map.Entry<DeclarationDescriptor,EnclosedValueDescriptor> entry : closure.getCaptureVariables().entrySet()) {
      Type sharedVarType=typeMapper.getSharedVarType(entry.getKey());
      if (sharedVarType == null) {
        sharedVarType=typeMapper.mapType((VariableDescriptor)entry.getKey());
      }
      StackValue capturedVar=entry.getValue().getOuterValue(this);
      if (inliner.shouldPutValue(sharedVarType,capturedVar,context)) {
        capturedVar.put(sharedVarType,v);
      }
      inliner.putInLocal(sharedVarType,capturedVar);
    }
  }
}
