{
  Type asmType=expressionType(expression);
  StackValue condition=gen(expression.getCondition());
  JetExpression thenExpression=expression.getThen();
  JetExpression elseExpression=expression.getElse();
  if (thenExpression == null && elseExpression == null) {
    throw new CompilationException("Both brunches of if/else are null",null,expression);
  }
  if (isEmptyExpression(thenExpression)) {
    if (isEmptyExpression(elseExpression)) {
      if (!asmType.equals(JetTypeMapper.TUPLE0_TYPE)) {
        throw new CompilationException("Completely empty 'if' is expected to have Unit type",null,expression);
      }
      StackValue.putTuple0Instance(v);
      return StackValue.onStack(asmType);
    }
    return generateSingleBranchIf(condition,elseExpression,false);
  }
 else {
    if (isEmptyExpression(elseExpression)) {
      return generateSingleBranchIf(condition,thenExpression,true);
    }
  }
  Label elseLabel=new Label();
  condition.condJump(elseLabel,true,v);
  Label end=continueLabel == null ? new Label() : continueLabel;
  if (continueLabel != null)   asmType=Type.VOID_TYPE;
  gen(thenExpression,asmType);
  v.goTo(end);
  v.mark(elseLabel);
  gen(elseExpression,asmType);
  if (end != continueLabel)   v.mark(end);
 else   v.goTo(end);
  return StackValue.onStack(asmType);
}
