{
  Type asmType=expressionType(expression);
  StackValue condition=gen(expression.getCondition());
  JetExpression thenExpression=expression.getThen();
  JetExpression elseExpression=expression.getElse();
  if (thenExpression == null && elseExpression == null) {
    throw new CompilationException("Both brunches of if/else are null",null,expression);
  }
  if (isEmptyExpression(thenExpression)) {
    if (isEmptyExpression(elseExpression)) {
      condition.put(asmType,v);
      return StackValue.onStack(asmType);
    }
    return generateSingleBranchIf(condition,elseExpression,false);
  }
 else {
    if (isEmptyExpression(elseExpression)) {
      return generateSingleBranchIf(condition,thenExpression,true);
    }
  }
  Label elseLabel=new Label();
  condition.condJump(elseLabel,true,v);
  Label end=continueLabel == null ? new Label() : continueLabel;
  gen(thenExpression,asmType);
  v.goTo(end);
  v.mark(elseLabel);
  gen(elseExpression,asmType);
  if (end != continueLabel)   v.mark(end);
 else   v.goTo(end);
  return StackValue.onStack(asmType);
}
