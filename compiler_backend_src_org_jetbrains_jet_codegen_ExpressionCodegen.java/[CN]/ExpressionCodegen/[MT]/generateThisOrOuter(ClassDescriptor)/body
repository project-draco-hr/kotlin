{
  boolean thisDone=false;
  StackValue result=null;
  ClassContext cur=context;
  while (true) {
    ClassContext parentContext=cur.getParentContext();
    if (parentContext == null)     break;
    final DeclarationDescriptor curContextType=cur.getContextDescriptor();
    if (curContextType instanceof ClassDescriptor) {
      if (isSubclass((ClassDescriptor)curContextType,calleeContainingClass))       break;
      final StackValue outer;
      if (!thisDone && myFrameMap instanceof ConstructorFrameMap) {
        outer=StackValue.local(((ConstructorFrameMap)myFrameMap).getOuterThisIndex(),JetTypeMapper.TYPE_OBJECT);
      }
 else {
        thisToStack();
        outer=StackValue.field(parentContext.jvmType(typeMapper),cur.jvmType(typeMapper).getInternalName(),"this$0",false);
      }
      thisDone=true;
      result=outer;
    }
    cur=parentContext;
  }
  if (!thisDone) {
    return thisExpression();
  }
  return result;
}
