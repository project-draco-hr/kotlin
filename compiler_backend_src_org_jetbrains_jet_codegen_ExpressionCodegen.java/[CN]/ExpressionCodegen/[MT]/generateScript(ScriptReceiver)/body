{
  CodegenContext cur=context;
  cur=context;
  StackValue result=StackValue.local(0,TYPE_OBJECT);
  while (cur != null) {
    if (cur instanceof CodegenContexts.MethodContext && !(cur instanceof CodegenContexts.ConstructorContext))     cur=cur.getParentContext();
    if (cur instanceof CodegenContexts.ScriptContext) {
      CodegenContexts.ScriptContext scriptContext=(CodegenContexts.ScriptContext)cur;
      JvmClassName currentScriptClassName=state.getInjector().getClosureAnnotator().classNameForScriptDescriptor(scriptContext.getScriptDescriptor());
      if (scriptContext.getScriptDescriptor() == receiver.getDeclarationDescriptor()) {
        result.put(currentScriptClassName.getAsmType(),v);
      }
 else {
        JvmClassName className=state.getInjector().getClosureAnnotator().classNameForScriptDescriptor(receiver.getDeclarationDescriptor());
        String fieldName=state.getInjector().getScriptCodegen().getScriptFieldName(receiver.getDeclarationDescriptor());
        result.put(currentScriptClassName.getAsmType(),v);
        StackValue.field(className.getAsmType(),currentScriptClassName,fieldName,false).put(className.getAsmType(),v);
      }
      return;
    }
    result=cur.getOuterExpression(result);
    if (cur instanceof CodegenContexts.ConstructorContext) {
      cur=cur.getParentContext();
    }
    cur=cur.getParentContext();
  }
  throw new UnsupportedOperationException();
}
