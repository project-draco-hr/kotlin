{
  final DeclarationDescriptor descriptor=bindingContext.get(BindingContext.REFERENCE_TARGET,expression.getInstanceReference());
  if (descriptor instanceof ClassDescriptor) {
    return generateThisOrOuter((ClassDescriptor)descriptor);
  }
 else {
    if (descriptor instanceof FunctionDescriptor) {
      FunctionDescriptor functionDescriptor=(FunctionDescriptor)descriptor;
      Type type=typeMapper.mapType(functionDescriptor.getReceiverParameter().getType());
      return StackValue.local(descriptor.getContainingDeclaration() instanceof NamespaceDescriptor ? 0 : 1,type);
    }
    throw new UnsupportedOperationException();
  }
}
