{
  if (closure != null) {
    if (!ignoreThisAndReceiver) {
      ClassDescriptor captureThis=closure.getCaptureThis();
      if (captureThis != null) {
        generateThisOrOuter(captureThis,false).put(OBJECT_TYPE,v);
      }
      ClassifierDescriptor captureReceiver=closure.getCaptureReceiver();
      if (captureReceiver != null) {
        Type asmType=typeMapper.mapType(captureReceiver.getDefaultType(),JetTypeMapperMode.IMPL);
        v.load(context.isStatic() ? 0 : 1,asmType);
      }
    }
    for (    Map.Entry<DeclarationDescriptor,EnclosedValueDescriptor> entry : closure.getCaptureVariables().entrySet()) {
      Type sharedVarType=typeMapper.getSharedVarType(entry.getKey());
      if (sharedVarType == null) {
        sharedVarType=typeMapper.mapType((VariableDescriptor)entry.getKey());
      }
      entry.getValue().getOuterValue(this).put(sharedVarType,v);
    }
  }
}
