{
  JetExpression returnedExpression=expression.getReturnedExpression();
  CallableMemberDescriptor descriptor=getContext().getContextDescriptor();
  NonLocalReturnInfo nonLocalReturn=getNonLocalReturnInfo(descriptor,expression);
  boolean isNonLocalReturn=nonLocalReturn != null;
  if (isNonLocalReturn && !state.isInlineEnabled()) {
    throw new CompilationException("Non local returns requires enabled inlining",null,expression);
  }
  Type returnType=isNonLocalReturn ? nonLocalReturn.returnType : this.returnType;
  if (returnedExpression != null) {
    gen(returnedExpression,returnType);
  }
  generateFinallyBlocksIfNeeded(returnType);
  if (isNonLocalReturn) {
    InlineCodegenUtil.generateGlobalReturnFlag(v,nonLocalReturn.labelName);
  }
  v.visitInsn(returnType.getOpcode(Opcodes.IRETURN));
  return StackValue.none();
}
