{
  RealKey realKey=new RealKey(name,queue);
  while (true) {
    RealKey sneakyRef=map.putIfAbsent(realKey,realKey);
    if (sneakyRef == null) {
      return name;
    }
 else {
      Name canonical=sneakyRef.get();
      if (canonical != null) {
        return canonical;
      }
    }
  }
}
