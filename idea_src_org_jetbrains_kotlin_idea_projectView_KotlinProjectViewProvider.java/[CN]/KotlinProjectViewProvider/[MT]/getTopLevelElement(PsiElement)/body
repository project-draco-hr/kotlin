{
  PsiFile file=element.getContainingFile();
  if (file == null || !(file instanceof KtFile))   return null;
  VirtualFile virtualFile=file.getVirtualFile();
  if (!fileInRoots(virtualFile))   return file;
  PsiElement current=element;
  while (current != null) {
    if (isSelectable(current))     break;
    current=current.getParent();
  }
  if (current instanceof KtFile) {
    List<KtDeclaration> declarations=((KtFile)current).getDeclarations();
    String nameWithoutExtension=virtualFile != null ? virtualFile.getNameWithoutExtension() : file.getName();
    if (declarations.size() == 1 && declarations.get(0) instanceof KtClassOrObject && nameWithoutExtension.equals(declarations.get(0).getName())) {
      current=declarations.get(0);
    }
  }
  return current != null ? current : file;
}
