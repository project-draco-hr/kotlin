{
  if (lookupResults.isEmpty()) {
    return Collections.emptyList();
  }
  Collection<DeclarationDescriptor> descriptors=Sets.newLinkedHashSet();
  for (  SuccessfulLookupResult lookupResult : lookupResults) {
    descriptors.addAll(lookupResult.descriptors);
  }
  Collection<JetScope> possibleResolutionScopes=Lists.newArrayList();
  for (  SuccessfulLookupResult lookupResult : lookupResults) {
    if (!lookupResult.descriptors.isEmpty()) {
      possibleResolutionScopes.add(lookupResult.resolutionScope);
    }
  }
  if (possibleResolutionScopes.isEmpty()) {
    for (    SuccessfulLookupResult lookupResult : lookupResults) {
      possibleResolutionScopes.add(lookupResult.resolutionScope);
    }
  }
  Collection<DeclarationDescriptor> filteredDescriptors;
  if (lookupMode == LookupMode.ONLY_CLASSES) {
    filteredDescriptors=Collections2.filter(descriptors,CLASSIFIERS_AND_PACKAGE_VIEWS);
  }
 else {
    filteredDescriptors=Sets.newLinkedHashSet();
    for (    SuccessfulLookupResult lookupResult : lookupResults) {
      if (lookupResult.packageLevel) {
        filteredDescriptors.addAll(lookupResult.descriptors);
        continue;
      }
      filteredDescriptors.addAll(Collections2.filter(lookupResult.descriptors,CLASSIFIERS_AND_PACKAGE_VIEWS));
    }
  }
  if (storeResult) {
    storeResolutionResult(descriptors,filteredDescriptors,referenceExpression,possibleResolutionScopes,trace,scopeToCheckVisibility);
  }
  return filteredDescriptors;
}
