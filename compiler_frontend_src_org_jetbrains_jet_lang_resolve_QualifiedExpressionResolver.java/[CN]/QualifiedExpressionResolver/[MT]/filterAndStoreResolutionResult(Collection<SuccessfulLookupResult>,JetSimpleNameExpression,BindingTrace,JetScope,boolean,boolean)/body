{
  if (lookupResults.isEmpty()) {
    return Collections.emptyList();
  }
  Collection<DeclarationDescriptor> descriptors=Sets.newLinkedHashSet();
  for (  SuccessfulLookupResult lookupResult : lookupResults) {
    descriptors.addAll(lookupResult.descriptors);
  }
  Collection<JetScope> possibleResolutionScopes=Lists.newArrayList();
  for (  SuccessfulLookupResult lookupResult : lookupResults) {
    if (!lookupResult.descriptors.isEmpty()) {
      possibleResolutionScopes.add(lookupResult.resolutionScope);
    }
  }
  if (possibleResolutionScopes.isEmpty()) {
    for (    SuccessfulLookupResult lookupResult : lookupResults) {
      possibleResolutionScopes.add(lookupResult.resolutionScope);
    }
  }
  Collection<DeclarationDescriptor> filteredDescriptors;
  if (onlyClasses) {
    filteredDescriptors=Collections2.filter(descriptors,new Predicate<DeclarationDescriptor>(){
      @Override public boolean apply(      @Nullable DeclarationDescriptor descriptor){
        return (descriptor instanceof ClassifierDescriptor) || (descriptor instanceof NamespaceDescriptor);
      }
    }
);
  }
 else {
    filteredDescriptors=Sets.newLinkedHashSet();
    for (    SuccessfulLookupResult lookupResult : lookupResults) {
      if (lookupResult.namespaceLevel) {
        filteredDescriptors.addAll(lookupResult.descriptors);
        continue;
      }
      filteredDescriptors.addAll(Collections2.filter(lookupResult.descriptors,new Predicate<DeclarationDescriptor>(){
        @Override public boolean apply(        @Nullable DeclarationDescriptor descriptor){
          return (descriptor instanceof NamespaceDescriptor) || (descriptor instanceof ClassifierDescriptor) || (descriptor instanceof VariableDescriptor && ((VariableDescriptor)descriptor).isObjectDeclaration());
        }
      }
));
    }
  }
  if (storeResult) {
    storeResolutionResult(descriptors,filteredDescriptors,referenceExpression,possibleResolutionScopes,trace,scopeToCheckVisibility);
  }
  return filteredDescriptors;
}
