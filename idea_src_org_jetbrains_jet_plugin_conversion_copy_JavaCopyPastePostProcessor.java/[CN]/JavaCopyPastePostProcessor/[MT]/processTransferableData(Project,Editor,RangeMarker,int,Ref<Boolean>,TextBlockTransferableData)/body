{
  if (!(value instanceof CopiedCode))   return;
  final PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  if (!(file instanceof JetFile))   return;
  JetEditorOptions jetEditorOptions=JetEditorOptions.getInstance();
  boolean needConvert=jetEditorOptions.isEnableJavaToKotlinConversion() && (jetEditorOptions.isDonTShowConversionDialog() || okFromDialog(project));
  if (needConvert) {
    final String text=convertCopiedCodeToKotlin((CopiedCode)value,file);
    if (!text.isEmpty()) {
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          editor.getDocument().replaceString(bounds.getStartOffset(),bounds.getEndOffset(),text);
          editor.getCaretModel().moveToOffset(bounds.getStartOffset() + text.length());
          PsiDocumentManager.getInstance(file.getProject()).commitDocument(editor.getDocument());
        }
      }
);
    }
  }
}
