{
  if (context.expectedReturnType == FORBIDDEN) {
    context.trace.getErrorHandler().genericError(expression.getNode(),"'return' is not allowed here");
    return null;
  }
  JetExpression returnedExpression=expression.getReturnedExpression();
  JetType returnedType=JetStandardClasses.getUnitType();
  if (returnedExpression != null) {
    getType(returnedExpression,context.replaceExpectedType(context.expectedReturnType).replaceScope(context.scope));
  }
 else {
    if (context.expectedReturnType != NO_EXPECTED_TYPE && !JetStandardClasses.isUnit(context.expectedReturnType)) {
      context.trace.getErrorHandler().genericError(expression.getNode(),"This function must return a value of type " + context.expectedReturnType);
    }
  }
  return context.services.checkType(JetStandardClasses.getNothingType(),expression,context);
}
