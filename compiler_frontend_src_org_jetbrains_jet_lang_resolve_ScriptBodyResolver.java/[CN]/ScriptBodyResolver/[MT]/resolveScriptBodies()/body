{
  for (  Map.Entry<JetScript,ScriptDescriptor> e : context.getScripts().entrySet()) {
    JetScript declaration=e.getKey();
    ScriptDescriptor descriptor=e.getValue();
    WritableScope scope=context.getScriptScopes().get(declaration);
    scope.changeLockLevel(WritableScope.LockLevel.READING);
    ExpressionTypingContext context=ExpressionTypingContext.newContext(expressionTypingServices,trace,scope,DataFlowInfo.EMPTY,NO_EXPECTED_TYPE,ExpressionPosition.FREE);
    JetType returnType=expressionTypingServices.getBlockReturnedType(scope,declaration.getBlockExpression(),CoercionStrategy.NO_COERCION,context,trace).getType();
    if (returnType == null) {
      returnType=ErrorUtils.createErrorType("getBlockReturnedType returned null");
    }
    descriptor.initialize(returnType,declaration,trace.getBindingContext());
  }
}
