{
  JetElement codeFragmentExpression=codeFragment.getContentElement();
  if (!(codeFragmentExpression instanceof JetExpression))   return;
  PsiElement contextElement=codeFragment.getContext();
  JetScope scopeForContextElement;
  DataFlowInfo dataFlowInfoForContextElement;
  if (contextElement instanceof JetClassOrObject) {
    LazyClassDescriptor descriptor=(LazyClassDescriptor)resolveSession.resolveToDescriptor((JetClassOrObject)contextElement);
    scopeForContextElement=descriptor.getScopeForMemberDeclarationResolution();
    dataFlowInfoForContextElement=DataFlowInfo.EMPTY;
  }
 else {
    if (!(contextElement instanceof JetExpression))     return;
    JetExpression contextExpression=(JetExpression)contextElement;
    BindingContext contextForElement=resolveToElement((JetElement)contextElement,true);
    scopeForContextElement=contextForElement.get(BindingContext.RESOLUTION_SCOPE,contextExpression);
    dataFlowInfoForContextElement=getDataFlowInfo(contextForElement,contextExpression);
  }
  if (scopeForContextElement == null)   return;
  JetScope codeFragmentScope=resolveSession.getScopeProvider().getFileScope(codeFragment);
  ChainedScope chainedScope=new ChainedScope(scopeForContextElement.getContainingDeclaration(),"Scope for resolve code fragment",scopeForContextElement,codeFragmentScope);
  AnalyzerPackage.computeTypeInContext((JetExpression)codeFragmentExpression,chainedScope,trace,dataFlowInfoForContextElement,TypeUtils.NO_EXPECTED_TYPE,resolveSession.getModuleDescriptor());
}
