{
  @SuppressWarnings("unchecked") JetElement elementOfAdditionalResolve=(JetElement)JetPsiUtil.getTopmostParentOfTypes(jetElement,JetNamedFunction.class,JetClassInitializer.class,JetProperty.class,JetParameter.class,JetDelegationSpecifierList.class,JetImportDirective.class,JetAnnotationEntry.class,JetTypeParameter.class,JetTypeConstraint.class,JetPackageDirective.class,JetCodeFragment.class);
  if (elementOfAdditionalResolve != null && !(elementOfAdditionalResolve instanceof JetParameter)) {
    if (elementOfAdditionalResolve instanceof JetPackageDirective) {
      elementOfAdditionalResolve=jetElement;
    }
    if (partialBodyResolve && elementOfAdditionalResolve instanceof JetDeclarationWithBody) {
      JetExpression body=((JetDeclarationWithBody)elementOfAdditionalResolve).getBodyExpression();
      boolean inBody=body != null && PsiTreeUtil.isAncestor(body,jetElement,false);
      Function1<JetElement,Boolean> filter;
      if (inBody) {
        filter=new PartialBodyResolveFilter(jetElement,body,probablyNothingCallableNamesService());
      }
 else {
        filter=new Function1<JetElement,Boolean>(){
          @Override public Boolean invoke(          JetElement element){
            return false;
          }
        }
;
      }
      return elementAdditionalResolve(elementOfAdditionalResolve,filter);
    }
    return getElementAdditionalResolve(elementOfAdditionalResolve);
  }
  JetParameter parameter=(JetParameter)elementOfAdditionalResolve;
  if (parameter != null) {
    JetClass klass=PsiTreeUtil.getParentOfType(parameter,JetClass.class);
    if (klass != null && parameter.getParent() == klass.getPrimaryConstructorParameterList()) {
      return getElementAdditionalResolve(klass);
    }
    jetElement=parameter;
  }
  JetDeclaration declaration=PsiTreeUtil.getParentOfType(jetElement,JetDeclaration.class,false);
  if (declaration != null) {
    resolveSession.resolveToDescriptor(declaration);
  }
  return resolveSession.getBindingContext();
}
