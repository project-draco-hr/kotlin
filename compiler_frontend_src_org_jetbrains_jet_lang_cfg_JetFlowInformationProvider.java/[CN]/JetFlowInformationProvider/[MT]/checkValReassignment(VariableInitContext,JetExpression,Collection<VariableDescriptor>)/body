{
  VariableDescriptor variableDescriptor=ctxt.variableDescriptor;
  if (isBackingFieldReference(expression) && variableDescriptor instanceof PropertyDescriptor) {
    PropertyDescriptor propertyDescriptor=(PropertyDescriptor)variableDescriptor;
    JetPropertyAccessor accessor=PsiTreeUtil.getParentOfType(expression,JetPropertyAccessor.class);
    if (accessor != null) {
      DeclarationDescriptor accessorDescriptor=trace.get(BindingContext.DECLARATION_TO_DESCRIPTOR,accessor);
      if (propertyDescriptor.getGetter() == accessorDescriptor) {
        return false;
      }
    }
  }
  boolean isInitializedNotHere=ctxt.enterInitState.isInitialized;
  if (expression.getParent() instanceof JetProperty && ((JetProperty)expression).getInitializer() != null) {
    isInitializedNotHere=false;
  }
  boolean hasBackingField=true;
  if (variableDescriptor instanceof PropertyDescriptor) {
    hasBackingField=trace.get(BindingContext.BACKING_FIELD_REQUIRED,(PropertyDescriptor)variableDescriptor);
  }
  if (variableDescriptor.isVar() && variableDescriptor instanceof PropertyDescriptor) {
    DeclarationDescriptor descriptor=BindingContextUtils.getEnclosingDescriptor(trace.getBindingContext(),expression);
    PropertySetterDescriptor setterDescriptor=((PropertyDescriptor)variableDescriptor).getSetter();
    if (Visibilities.isVisible(variableDescriptor,descriptor) && !Visibilities.isVisible(setterDescriptor,descriptor) && setterDescriptor != null) {
      report(Errors.INVISIBLE_SETTER.on(expression,variableDescriptor,setterDescriptor.getVisibility(),variableDescriptor.getContainingDeclaration()),ctxt);
      return true;
    }
  }
  if ((isInitializedNotHere || !hasBackingField) && !variableDescriptor.isVar() && !varWithValReassignErrorGenerated.contains(variableDescriptor)) {
    boolean hasReassignMethodReturningUnit=false;
    JetSimpleNameExpression operationReference=null;
    PsiElement parent=expression.getParent();
    if (parent instanceof JetBinaryExpression) {
      operationReference=((JetBinaryExpression)parent).getOperationReference();
    }
 else     if (parent instanceof JetUnaryExpression) {
      operationReference=((JetUnaryExpression)parent).getOperationReference();
    }
    if (operationReference != null) {
      DeclarationDescriptor descriptor=trace.get(BindingContext.REFERENCE_TARGET,operationReference);
      if (descriptor instanceof FunctionDescriptor) {
        if (KotlinBuiltIns.getInstance().isUnit(((FunctionDescriptor)descriptor).getReturnType())) {
          hasReassignMethodReturningUnit=true;
        }
      }
      if (descriptor == null) {
        Collection<? extends DeclarationDescriptor> descriptors=trace.get(BindingContext.AMBIGUOUS_REFERENCE_TARGET,operationReference);
        if (descriptors != null) {
          for (          DeclarationDescriptor referenceDescriptor : descriptors) {
            if (KotlinBuiltIns.getInstance().isUnit(((FunctionDescriptor)referenceDescriptor).getReturnType())) {
              hasReassignMethodReturningUnit=true;
            }
          }
        }
      }
    }
    if (!hasReassignMethodReturningUnit) {
      varWithValReassignErrorGenerated.add(variableDescriptor);
      report(Errors.VAL_REASSIGNMENT.on(expression,variableDescriptor),ctxt);
      return true;
    }
  }
  return false;
}
