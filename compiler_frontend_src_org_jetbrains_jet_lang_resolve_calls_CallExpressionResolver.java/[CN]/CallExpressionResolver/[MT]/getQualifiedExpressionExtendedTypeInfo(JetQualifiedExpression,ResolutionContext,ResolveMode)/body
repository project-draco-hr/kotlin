{
  JetExpression selectorExpression=expression.getSelectorExpression();
  JetExpression receiverExpression=expression.getReceiverExpression();
  JetTypeInfo receiverTypeInfo=expressionTypingServices.getTypeInfoWithNamespaces(receiverExpression,context.scope,NO_EXPECTED_TYPE,context.dataFlowInfo,context.trace);
  JetType receiverType=receiverTypeInfo.getType();
  if (selectorExpression == null)   return TypeInfoForCall.create(null,context.dataFlowInfo);
  if (receiverType == null)   receiverType=ErrorUtils.createErrorType("Type for " + expression.getText());
  context=context.replaceDataFlowInfo(receiverTypeInfo.getDataFlowInfo());
  if (selectorExpression instanceof JetSimpleNameExpression) {
    ConstantUtils.propagateConstantValues(expression,context.trace,(JetSimpleNameExpression)selectorExpression);
  }
  TypeInfoForCall selectorReturnTypeInfo=getSelectorReturnTypeInfo(new ExpressionReceiver(receiverExpression,receiverType),expression.getOperationTokenNode(),selectorExpression,context,resolveMode);
  JetType selectorReturnType=selectorReturnTypeInfo.getType();
  if (!(receiverType instanceof NamespaceType) && expression.getOperationSign() == JetTokens.SAFE_ACCESS) {
    if (selectorReturnType != null && !selectorReturnType.isNullable() && !KotlinBuiltIns.getInstance().isUnit(selectorReturnType)) {
      if (receiverType.isNullable()) {
        selectorReturnType=TypeUtils.makeNullable(selectorReturnType);
      }
    }
  }
  if (selectorReturnType != null) {
    context.trace.record(BindingContext.EXPRESSION_TYPE,selectorExpression,selectorReturnType);
  }
  JetTypeInfo typeInfo=JetTypeInfo.create(selectorReturnType,selectorReturnTypeInfo.getDataFlowInfo());
  if (resolveMode == ResolveMode.TOP_LEVEL_CALL) {
    DataFlowUtils.checkType(typeInfo.getType(),expression,context,typeInfo.getDataFlowInfo());
  }
  return TypeInfoForCall.create(typeInfo,selectorReturnTypeInfo);
}
