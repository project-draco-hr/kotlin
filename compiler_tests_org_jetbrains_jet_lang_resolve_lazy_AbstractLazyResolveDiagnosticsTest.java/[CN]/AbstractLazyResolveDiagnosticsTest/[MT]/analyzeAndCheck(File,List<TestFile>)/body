{
  List<JetFile> jetFiles=getJetFiles(files);
  ModuleDescriptor lazyModule=LazyResolveTestUtil.resolveLazily(jetFiles,getEnvironment());
  ModuleDescriptor eagerModule=LazyResolveTestUtil.resolveEagerly(jetFiles,getEnvironment());
  String path=JetTestUtils.getFilePath(new File(FileUtil.getRelativePath(TEST_DATA_DIR,testDataFile)));
  NamespaceDescriptor expected=eagerModule.getNamespace(FqName.ROOT);
  NamespaceDescriptor actual=lazyModule.getNamespace(FqName.ROOT);
  String txtFileRelativePath=path.replaceAll("\\.kt$|\\.ktscript",".txt");
  File txtFile=new File("compiler/testData/lazyResolve/diagnostics/" + txtFileRelativePath);
  final Set<Name> names=LazyResolveTestUtil.getTopLevelPackagesFromFileList(jetFiles);
  validateAndCompareDescriptors(expected,actual,RECURSIVE.filterRecursion(new Predicate<FqNameUnsafe>(){
    @Override public boolean apply(    FqNameUnsafe fqName){
      if (fqName.isRoot())       return true;
      if (fqName.parent().isRoot()) {
        return names.contains(fqName.shortName());
      }
      return true;
    }
  }
),txtFile);
}
