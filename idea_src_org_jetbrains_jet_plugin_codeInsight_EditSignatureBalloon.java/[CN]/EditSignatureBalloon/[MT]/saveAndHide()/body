{
  final String newSignature=editor.getDocument().getText();
  if (!previousSignature.equals(newSignature)) {
    new WriteCommandAction(project){
      @Override protected void run(      final Result result) throws Throwable {
        ExternalAnnotationsManager.getInstance(project).deannotate(method,KotlinSignatureInJavaMarkerProvider.KOTLIN_SIGNATURE_ANNOTATION);
        ExternalAnnotationsManager.getInstance(project).annotateExternally(method,KotlinSignatureInJavaMarkerProvider.KOTLIN_SIGNATURE_ANNOTATION,method.getContainingFile(),signatureToNameValuePairs(project,newSignature));
      }
    }
.execute();
  }
  balloon.hide();
}
