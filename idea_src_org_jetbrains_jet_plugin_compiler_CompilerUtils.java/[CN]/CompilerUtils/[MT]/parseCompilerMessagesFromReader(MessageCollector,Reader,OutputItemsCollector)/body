{
  final StringBuilder stringBuilder=new StringBuilder();
  Reader wrappingReader=new Reader(){
    @Override public int read(    char[] cbuf,    int off,    int len) throws IOException {
      int read=reader.read(cbuf,off,len);
      stringBuilder.append(cbuf,off,len);
      return read;
    }
    @Override public void close() throws IOException {
    }
  }
;
  try {
    SAXParserFactory factory=SAXParserFactory.newInstance();
    SAXParser parser=factory.newSAXParser();
    parser.parse(new InputSource(wrappingReader),new CompilerOutputSAXHandler(messageCollector,collector));
  }
 catch (  Throwable e) {
    try {
      FileUtil.loadTextAndClose(wrappingReader);
    }
 catch (    IOException ioException) {
      LOG.error(ioException);
    }
    String message=stringBuilder.toString();
    LOG.error(message);
    LOG.error(e);
    messageCollector.report(ERROR,message,NO_LOCATION);
  }
 finally {
    try {
      reader.close();
    }
 catch (    IOException e) {
      LOG.error(e);
    }
  }
}
