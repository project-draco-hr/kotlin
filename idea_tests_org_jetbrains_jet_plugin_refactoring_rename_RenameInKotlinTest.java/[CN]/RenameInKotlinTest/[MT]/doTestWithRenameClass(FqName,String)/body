{
  doTest(new PerformAction(){
    @Override public void performAction(    VirtualFile rootDir,    VirtualFile rootAfter) throws Exception {
      BindingContext bindingContext=WholeProjectAnalyzerFacade.analyzeProjectWithCache(getProject(),GlobalSearchScope.allScope(getProject())).getBindingContext();
      ClassDescriptor classDescriptor=bindingContext.get(BindingContext.FQNAME_TO_CLASS_DESCRIPTOR,qClassName);
      assertNotNull(classDescriptor);
      PsiElement psiElement=BindingContextUtils.classDescriptorToDeclaration(bindingContext,classDescriptor);
      assertNotNull(psiElement);
      new RenameProcessor(myProject,psiElement,newName,true,true).run();
      PsiDocumentManager.getInstance(myProject).commitAllDocuments();
      FileDocumentManager.getInstance().saveAllDocuments();
      VirtualFileManager.getInstance().refresh(false);
    }
  }
);
}
