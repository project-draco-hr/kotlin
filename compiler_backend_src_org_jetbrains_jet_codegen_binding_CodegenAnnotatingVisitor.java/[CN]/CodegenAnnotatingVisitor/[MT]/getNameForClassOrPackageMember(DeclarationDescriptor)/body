{
  DeclarationDescriptor containingDeclaration=descriptor.getContainingDeclaration();
  String peek=peekFromStack(nameStack);
  String name=safeIdentifier(descriptor.getName()).asString();
  if (containingDeclaration instanceof ClassDescriptor) {
    return peek + '$' + name;
  }
 else   if (containingDeclaration instanceof PackageFragmentDescriptor) {
    FqName qualifiedName=((PackageFragmentDescriptor)containingDeclaration).getFqName();
    String packageClassShortName=PackageClassUtils.getPackageClassName(qualifiedName);
    String packageClassName=peek.isEmpty() ? packageClassShortName : peek + "/" + packageClassShortName;
    return packageClassName + '$' + name;
  }
 else {
    return null;
  }
}
