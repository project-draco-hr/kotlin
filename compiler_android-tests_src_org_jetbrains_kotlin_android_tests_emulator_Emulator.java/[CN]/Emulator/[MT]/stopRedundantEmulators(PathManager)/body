{
  GeneralCommandLine commandLineForListOfDevices=createAdbCommand();
  commandLineForListOfDevices.addParameter("devices");
  RunResult runResult=RunUtils.execute(commandLineForListOfDevices);
  OutputUtils.checkResult(runResult);
  Matcher matcher=EMULATOR_PATTERN.matcher(runResult.getOutput());
  boolean isDdmsStopped=false;
  while (matcher.find()) {
    System.out.println("Stopping redundant emulator...");
    GeneralCommandLine commandLineForStoppingEmulators=new GeneralCommandLine();
    if (SystemInfo.isWindows) {
      commandLineForStoppingEmulators.setExePath("taskkill");
      commandLineForStoppingEmulators.addParameter("/F");
      commandLineForStoppingEmulators.addParameter("/IM");
      commandLineForStoppingEmulators.addParameter("emulator-arm.exe");
      OutputUtils.checkResult(RunUtils.execute(commandLineForStoppingEmulators));
      break;
    }
 else {
      if (!isDdmsStopped && SystemInfo.isUnix) {
        stopEmulator();
        stopDdmsProcess();
        isDdmsStopped=true;
      }
      commandLineForStoppingEmulators.setExePath(pathManager.getPlatformToolsFolderInAndroidSdk() + "/adb");
      commandLineForStoppingEmulators.addParameter("-s");
      commandLineForStoppingEmulators.addParameter(matcher.group());
      commandLineForStoppingEmulators.addParameter("emu");
      commandLineForStoppingEmulators.addParameter("kill");
      OutputUtils.checkResult(RunUtils.execute(commandLineForStoppingEmulators));
    }
  }
  OutputUtils.checkResult(RunUtils.execute(commandLineForListOfDevices));
}
