{
  ASTNode spaceNode=whiteSpace.getNode();
  if (spaceNode.getTextRange().contains(offset)) {
    String beforeWhiteSpaceText=spaceNode.getText().substring(0,offset - spaceNode.getStartOffset());
    if (!StringUtil.containsLineBreak(beforeWhiteSpaceText)) {
      beforeWhiteSpaceText+="\n";
    }
    JetPsiFactory factory=JetPsiFactory(whiteSpace.getProject());
    PsiElement insertAfter=whiteSpace.getPrevSibling();
    whiteSpace.delete();
    PsiElement beforeSpace=factory.createWhiteSpace(beforeWhiteSpaceText);
    insertAfter.getParent().addAfter(beforeSpace,insertAfter);
    return insertAfter.getNextSibling();
  }
  return whiteSpace;
}
