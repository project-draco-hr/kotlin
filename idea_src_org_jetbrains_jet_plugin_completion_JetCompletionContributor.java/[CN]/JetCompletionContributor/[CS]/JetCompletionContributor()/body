{
  extend(CompletionType.BASIC,PlatformPatterns.psiElement(),new CompletionProvider<CompletionParameters>(){
    @Override protected void addCompletions(    @NotNull CompletionParameters parameters,    ProcessingContext context,    final @NotNull CompletionResultSet result){
      final HashSet<LookupPositionObject> positions=new HashSet<LookupPositionObject>();
      if (result.getPrefixMatcher().getPrefix().isEmpty()) {
        return;
      }
      final PsiElement position=parameters.getPosition();
      if (!(position.getContainingFile() instanceof JetFile)) {
        return;
      }
      final JetSimpleNameReference jetReference=getJetReference(parameters);
      if (jetReference != null) {
        for (        Object variant : jetReference.getVariants()) {
          addReferenceVariant(result,variant,positions);
        }
        if (shouldRunTopLevelCompletion(parameters)) {
          addClasses(parameters,result,positions);
          addJetTopLevelFunctions(result,position,positions);
          addJetExtensionFunctions(jetReference.getExpression(),result,position);
        }
        result.stopHere();
      }
    }
  }
);
}
