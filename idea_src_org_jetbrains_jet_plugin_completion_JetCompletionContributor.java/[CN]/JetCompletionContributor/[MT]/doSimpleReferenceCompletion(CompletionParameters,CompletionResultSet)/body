{
  PsiElement position=parameters.getPosition();
  if (!(position.getContainingFile() instanceof JetFile)) {
    return;
  }
  JetSimpleNameReference jetReference=getJetReference(parameters);
  if (jetReference != null) {
    try {
      result.restartCompletionWhenNothingMatches();
      CompletionSession session=new CompletionSession(parameters,result,jetReference,position);
      if (parameters.getCompletionType() == CompletionType.BASIC) {
        session.completeForReference();
        if (!session.getJetResult().isSomethingAdded() && session.getParameters().getInvocationCount() < 2) {
          session=new CompletionSession(parameters.withInvocationCount(2),result,jetReference,position);
          session.completeForReference();
        }
      }
 else {
        session.completeSmart();
      }
    }
 catch (    ProcessCanceledException e) {
      throw CompletionProgressIndicatorUtil.rethrowWithCancelIndicator(e);
    }
  }
}
