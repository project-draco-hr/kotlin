{
  PsiFile file=declaration.getContainingFile();
  if (!(file instanceof JetFile))   return null;
  BindingContext bindingContext=ResolvePackage.analyzeFully((JetFile)file);
  DeclarationDescriptor descriptor=bindingContext.get(BindingContext.DECLARATION_TO_DESCRIPTOR,declaration);
  if (!(descriptor instanceof CallableDescriptor))   return null;
  JetType type=((CallableDescriptor)descriptor).getReturnType();
  if (type instanceof DeferredType) {
    type=((DeferredType)type).getDelegate();
  }
  return type;
}
