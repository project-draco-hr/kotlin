{
  jetCoreEnvironment=JetTestUtils.createEnvironmentWithMockJdk(myTestRootDisposable);
  String text=FileUtil.loadFile(ktFile);
  LightVirtualFile virtualFile=new LightVirtualFile(ktFile.getName(),JetLanguage.INSTANCE,text);
  virtualFile.setCharset(CharsetToolkit.UTF8_CHARSET);
  JetFile psiFile=(JetFile)((PsiFileFactoryImpl)PsiFileFactory.getInstance(jetCoreEnvironment.getProject())).trySetupPsiForFile(virtualFile,JetLanguage.INSTANCE,true,false);
  ClassFileFactory classFileFactory=GenerationUtils.compileFileGetClassFileFactoryForTest(psiFile,CompilerSpecialMode.REGULAR);
  CompileEnvironmentUtil.writeToOutputDirectory(classFileFactory,tmpdir.getPath());
  Disposer.dispose(myTestRootDisposable);
  JavaCompiler javaCompiler=ToolProvider.getSystemJavaCompiler();
  StandardJavaFileManager fileManager=javaCompiler.getStandardFileManager(null,Locale.ENGLISH,Charset.forName("utf-8"));
  try {
    Iterable<? extends JavaFileObject> javaFileObjectsFromFiles=fileManager.getJavaFileObjectsFromFiles(Collections.singleton(javaFile));
    List<String> options=Arrays.asList("-classpath",tmpdir.getPath() + System.getProperty("path.separator") + "out/production/stdlib","-d",tmpdir.getPath());
    JavaCompiler.CompilationTask task=javaCompiler.getTask(null,fileManager,null,options,null,javaFileObjectsFromFiles);
    Assert.assertTrue(task.call());
  }
  finally {
    fileManager.close();
  }
}
