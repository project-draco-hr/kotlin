{
  if (context.trace.get(BindingContext.PROCESSED,expression)) {
    return context.trace.getBindingContext().get(BindingContext.EXPRESSION_TYPE,expression);
  }
  JetType result;
  try {
    result=expression.visit(this,context);
    if ((boolean)context.trace.get(BindingContext.PROCESSED,expression)) {
      return context.trace.getBindingContext().get(BindingContext.EXPRESSION_TYPE,expression);
    }
    if (result instanceof DeferredType) {
      result=((DeferredType)result).getActualType();
    }
    if (result != null) {
      context.trace.record(BindingContext.EXPRESSION_TYPE,expression,result);
      if (JetStandardClasses.isNothing(result) && !result.isNullable()) {
        markDominatedExpressionsAsUnreachable(expression,context);
      }
    }
  }
 catch (  ReenteringLazyValueComputationException e) {
    context.trace.getErrorHandler().genericError(expression.getNode(),"Type checking has run into a recursive problem");
    result=null;
  }
  if (!(boolean)context.trace.get(BindingContext.PROCESSED,expression)) {
    context.trace.record(BindingContext.RESOLUTION_SCOPE,expression,context.scope);
  }
  context.trace.record(BindingContext.PROCESSED,expression);
  return result;
}
