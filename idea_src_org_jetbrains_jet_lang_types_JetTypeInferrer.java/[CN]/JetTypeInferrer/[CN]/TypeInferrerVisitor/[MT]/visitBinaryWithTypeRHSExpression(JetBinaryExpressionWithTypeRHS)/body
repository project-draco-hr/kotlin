{
  IElementType operationType=expression.getOperationSign().getReferencedNameElementType();
  JetType actualType=getType(context.scope,expression.getLeft(),false);
  JetTypeReference right=expression.getRight();
  if (right != null) {
    JetType targetType=context.typeResolver.resolveType(context.scope,right);
    if (operationType == JetTokens.COLON) {
      if (actualType != null && !semanticServices.getTypeChecker().isSubtypeOf(actualType,targetType)) {
        context.trace.getErrorHandler().typeMismatch(expression.getLeft(),targetType,actualType);
      }
      result=targetType;
    }
 else     if (operationType == JetTokens.AS_KEYWORD) {
      checkForCastImpossibility(expression,actualType,targetType);
      result=targetType;
    }
 else     if (operationType == JetTokens.AS_SAFE) {
      checkForCastImpossibility(expression,actualType,targetType);
      result=TypeUtils.makeNullable(targetType);
    }
 else {
      context.trace.getErrorHandler().genericError(expression.getOperationSign().getNode(),"Unsupported binary operation");
    }
  }
}
