{
  JetExpression baseExpression=expression.getBaseExpression();
  if (baseExpression == null) {
    return;
  }
  JetSimpleNameExpression operationSign=expression.getOperationSign();
  if (JetTokens.LABELS.contains(operationSign.getReferencedNameElementType())) {
    result=getType(baseExpression);
    return;
  }
  IElementType operationType=operationSign.getReferencedNameElementType();
  String name=unaryOperationNames.get(operationType);
  if (name == null) {
    context.trace.getErrorHandler().genericError(operationSign.getNode(),"Unknown unary operation");
  }
 else {
    JetType receiverType=getType(context.scope,baseExpression,false);
    if (receiverType != null) {
      FunctionDescriptor functionDescriptor=services.lookupFunction(context.scope,expression.getOperationSign(),name,receiverType,Collections.<JetType>emptyList(),true);
      if (functionDescriptor != null) {
        JetType returnType=functionDescriptor.getReturnType();
        if (operationType == JetTokens.PLUSPLUS || operationType == JetTokens.MINUSMINUS) {
          if (semanticServices.getTypeChecker().isSubtypeOf(returnType,JetStandardClasses.getUnitType())) {
            result=JetStandardClasses.getUnitType();
          }
 else {
            if (!semanticServices.getTypeChecker().isSubtypeOf(returnType,receiverType)) {
              context.trace.getErrorHandler().genericError(operationSign.getNode(),name + " must return " + receiverType+ " but returns "+ returnType);
            }
            result=receiverType;
          }
        }
 else {
          result=returnType;
        }
      }
    }
  }
}
