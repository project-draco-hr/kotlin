{
  if (block.isEmpty()) {
    return JetStandardClasses.getUnitType();
  }
  TypeInferrerVisitorWithWritableScope blockLevelVisitor=new TypeInferrerVisitorWithWritableScope(scope,true,dataFlowInfo);
  JetType result=null;
  for (  JetElement statement : block) {
    trace.recordStatement(statement);
    JetExpression statementExpression=(JetExpression)statement;
    result=blockLevelVisitor.getType(statementExpression);
    DataFlowInfo newDataFlowInfo=blockLevelVisitor.getResultingDataFlowInfo();
    if (newDataFlowInfo == null) {
      newDataFlowInfo=dataFlowInfo;
    }
    WritableScope newScope=blockLevelVisitor.getResultScope();
    if (newScope == null) {
      newScope=scope;
    }
    if (newDataFlowInfo != dataFlowInfo || newScope != scope) {
      blockLevelVisitor=new TypeInferrerVisitorWithWritableScope(newScope,true,newDataFlowInfo);
    }
 else {
      blockLevelVisitor.resetResult();
    }
  }
  return result;
}
