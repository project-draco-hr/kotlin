{
  Map<JetElement,JetType> typeMap=getReturnedExpressions(outerScope,function,functionDescriptor);
  if (typeMap.isEmpty()) {
    return;
  }
  JetType expectedReturnType=functionDescriptor.getUnsubstitutedReturnType();
  for (  Map.Entry<JetElement,JetType> entry : typeMap.entrySet()) {
    JetType actualType=entry.getValue();
    JetElement element=entry.getKey();
    JetTypeChecker typeChecker=semanticServices.getTypeChecker();
    if (!typeChecker.isSubtypeOf(actualType,expectedReturnType)) {
      if (typeChecker.isConvertibleBySpecialConversion(actualType,expectedReturnType)) {
        if (expectedReturnType.getConstructor().equals(JetStandardClasses.getUnitType().getConstructor()) && element.getParent() instanceof JetReturnExpression) {
          semanticServices.getErrorHandler().genericError(element.getNode(),"This function must return a value of type Unit");
        }
      }
 else {
        if (element instanceof JetExpression) {
          JetExpression expression=(JetExpression)element;
          semanticServices.getErrorHandler().typeMismatch(expression,expectedReturnType,actualType);
        }
 else {
          semanticServices.getErrorHandler().genericError(element.getNode(),"This function must return a value of type " + expectedReturnType);
        }
      }
    }
  }
}
