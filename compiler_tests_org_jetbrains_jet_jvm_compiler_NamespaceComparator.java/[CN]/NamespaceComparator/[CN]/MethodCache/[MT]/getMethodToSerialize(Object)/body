{
  if (o == null) {
    throw new IllegalStateException("won't serialize null");
  }
  buildMethodCache();
  Method method=methodCache.get(o.getClass());
  if (method != null) {
    return method;
  }
  for (  Map.Entry<Class<?>,Method> entry : methodCache.entrySet()) {
    Class<?> parameterType=entry.getKey();
    Method serializeMethod=entry.getValue();
    if (parameterType.isInstance(o)) {
      methodCache.put(o.getClass(),serializeMethod);
      return serializeMethod;
    }
  }
  throw new IllegalStateException("don't know how to serialize " + o + " (of "+ o.getClass()+ ")");
}
