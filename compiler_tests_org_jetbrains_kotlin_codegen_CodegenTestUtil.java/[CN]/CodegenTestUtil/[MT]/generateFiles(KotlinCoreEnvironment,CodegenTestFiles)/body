{
  AnalysisResult analysisResult=JvmResolveUtil.analyzeFilesWithJavaIntegrationAndCheckForErrors(environment.getProject(),files.getPsiFiles(),new JvmPackagePartProvider(environment));
  analysisResult.throwIfError();
  AnalyzingUtils.throwExceptionOnErrors(analysisResult.getBindingContext());
  CompilerConfiguration configuration=environment.getConfiguration();
  BindingTraceContext forExtraDiagnostics=new BindingTraceContext();
  GenerationState state=new GenerationState(environment.getProject(),ClassBuilderFactories.TEST,analysisResult.getModuleDescriptor(),analysisResult.getBindingContext(),files.getPsiFiles(),configuration.get(JVMConfigurationKeys.DISABLE_CALL_ASSERTIONS,false),configuration.get(JVMConfigurationKeys.DISABLE_PARAM_ASSERTIONS,false),GenerationState.GenerateClassFilter.GENERATE_ALL,configuration.get(JVMConfigurationKeys.DISABLE_INLINE,false),configuration.get(JVMConfigurationKeys.DISABLE_OPTIMIZATION,false),forExtraDiagnostics);
  KotlinCodegenFacade.compileCorrectFiles(state,CompilationErrorHandler.THROW_EXCEPTION);
  AnalyzingUtils.throwExceptionOnErrors(forExtraDiagnostics.getBindingContext());
  return state.getFactory();
}
