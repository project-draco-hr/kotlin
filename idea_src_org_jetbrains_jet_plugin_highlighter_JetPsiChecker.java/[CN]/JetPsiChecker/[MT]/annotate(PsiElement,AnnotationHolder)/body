{
  if (!JetPluginUtil.isInSource(element) || JetPluginUtil.isKtFileInGradleProjectInWrongFolder(element)) {
    return;
  }
  for (  HighlightingVisitor visitor : getBeforeAnalysisVisitors(holder)) {
    element.accept(visitor);
  }
  JetFile file=(JetFile)element.getContainingFile();
  if (passCache == null || passCache.isOutdated(file)) {
    passCache=new HighlightingPassCache(AnalyzerFacadeWithCache.analyzeFileWithCache(file),file);
  }
  if (!passCache.analyzeExhaust.isError()) {
    BindingContext bindingContext=passCache.analyzeExhaust.getBindingContext();
    for (    HighlightingVisitor visitor : getAfterAnalysisVisitor(holder,bindingContext)) {
      element.accept(visitor);
    }
    if (JetPluginUtil.isInSource(element,false)) {
      for (      Diagnostic diagnostic : passCache.elementToDiagnostic.get(element)) {
        registerDiagnosticAnnotations(diagnostic,passCache.redeclarations,holder);
      }
    }
  }
 else   if (element instanceof JetFile) {
    Throwable error=passCache.analyzeExhaust.getError();
    if (JetPluginUtil.isInSource(element,false)) {
      holder.createErrorAnnotation(file,error.getClass().getCanonicalName() + ": " + error.getMessage());
    }
    LOG.error(error);
  }
}
