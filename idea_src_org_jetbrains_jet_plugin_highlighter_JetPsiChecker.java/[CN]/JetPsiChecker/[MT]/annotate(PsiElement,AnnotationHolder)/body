{
  if (!JetPluginUtil.isInSource(element) || JetPluginUtil.isKtFileInGradleProjectInWrongFolder(element)) {
    return;
  }
  for (  HighlightingVisitor visitor : getBeforeAnalysisVisitors(holder)) {
    element.accept(visitor);
  }
  JetFile file=(JetFile)element.getContainingFile();
  AnalyzeExhaust analyzeExhaust=AnalyzerFacadeWithCache.analyzeFileWithCache(file);
  if (analyzeExhaust.isError()) {
    HighlighterPackage.updateHighlightingResult(file,true);
    throw new ProcessCanceledException(analyzeExhaust.getError());
  }
  BindingContext bindingContext=analyzeExhaust.getBindingContext();
  for (  HighlightingVisitor visitor : getAfterAnalysisVisitor(holder,bindingContext)) {
    element.accept(visitor);
  }
  if (JetPluginUtil.isInSource(element,false)) {
    ElementAnnotator elementAnnotator=new ElementAnnotator(element,holder);
    for (    Diagnostic diagnostic : bindingContext.getDiagnostics().forElement(element)) {
      elementAnnotator.registerDiagnosticAnnotations(diagnostic);
    }
  }
  if (element instanceof JetFile) {
    HighlighterPackage.updateHighlightingResult(file,false);
  }
}
