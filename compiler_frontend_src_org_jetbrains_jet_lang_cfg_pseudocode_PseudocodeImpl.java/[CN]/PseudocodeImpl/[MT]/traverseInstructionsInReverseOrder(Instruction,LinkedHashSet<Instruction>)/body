{
  Deque<Instruction> stack=Queues.newArrayDeque();
  stack.push(rootInstruction);
  List<Instruction> previousInstructions=Lists.newArrayList();
  while (!stack.isEmpty()) {
    final Instruction instruction=stack.pop();
    if (instructions.contains(instruction))     continue;
    instructions.add(instruction);
    previousInstructions.addAll(instruction.getPreviousInstructions());
    for (    Instruction previousInstruction : Lists.reverse(previousInstructions)) {
      stack.push(previousInstruction);
    }
    previousInstructions.clear();
  }
}
