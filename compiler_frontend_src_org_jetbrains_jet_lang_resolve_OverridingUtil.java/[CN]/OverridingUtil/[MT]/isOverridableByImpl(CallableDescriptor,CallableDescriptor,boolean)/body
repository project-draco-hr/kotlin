{
  if ((superDescriptor.getReceiverParameter() == null) != (subDescriptor.getReceiverParameter() == null)) {
    return OverrideCompatibilityInfo.receiverPresenceMismatch();
  }
  if (superDescriptor.getValueParameters().size() != subDescriptor.getValueParameters().size()) {
    return OverrideCompatibilityInfo.valueParameterNumberMismatch();
  }
  List<JetType> superValueParameters=compiledValueParameters(superDescriptor);
  List<JetType> subValueParameters=compiledValueParameters(subDescriptor);
  if (forOverride) {
    if (superDescriptor.getTypeParameters().size() != subDescriptor.getTypeParameters().size()) {
      for (int i=0; i < superValueParameters.size(); ++i) {
        JetType superValueParameterType=getUpperBound(superValueParameters.get(i));
        JetType subValueParameterType=getUpperBound(subValueParameters.get(i));
        if (!JetTypeChecker.INSTANCE.equalTypes(superValueParameterType,subValueParameterType)) {
          return OverrideCompatibilityInfo.typeParameterNumberMismatch();
        }
      }
      return OverrideCompatibilityInfo.valueParameterTypeMismatch(null,null,OverrideCompatibilityInfo.Result.CONFLICT);
    }
  }
  if (forOverride) {
    List<TypeParameterDescriptor> superTypeParameters=superDescriptor.getTypeParameters();
    List<TypeParameterDescriptor> subTypeParameters=subDescriptor.getTypeParameters();
    BiMap<TypeConstructor,TypeConstructor> axioms=HashBiMap.create();
    for (int i=0, typeParametersSize=superTypeParameters.size(); i < typeParametersSize; i++) {
      TypeParameterDescriptor superTypeParameter=superTypeParameters.get(i);
      TypeParameterDescriptor subTypeParameter=subTypeParameters.get(i);
      axioms.put(superTypeParameter.getTypeConstructor(),subTypeParameter.getTypeConstructor());
    }
    for (int i=0, typeParametersSize=superTypeParameters.size(); i < typeParametersSize; i++) {
      TypeParameterDescriptor superTypeParameter=superTypeParameters.get(i);
      TypeParameterDescriptor subTypeParameter=subTypeParameters.get(i);
      if (!JetTypeChecker.INSTANCE.equalTypes(superTypeParameter.getUpperBoundsAsType(),subTypeParameter.getUpperBoundsAsType(),axioms)) {
        return OverrideCompatibilityInfo.boundsMismatch(superTypeParameter,subTypeParameter);
      }
    }
    for (int i=0, unsubstitutedValueParametersSize=superValueParameters.size(); i < unsubstitutedValueParametersSize; i++) {
      JetType superValueParameter=superValueParameters.get(i);
      JetType subValueParameter=subValueParameters.get(i);
      boolean bothErrors=ErrorUtils.isErrorType(superValueParameter) && ErrorUtils.isErrorType(subValueParameter);
      if (!bothErrors && !JetTypeChecker.INSTANCE.equalTypes(superValueParameter,subValueParameter,axioms)) {
        return OverrideCompatibilityInfo.valueParameterTypeMismatch(superValueParameter,subValueParameter,OverrideCompatibilityInfo.Result.INCOMPATIBLE);
      }
    }
    for (    ExternalOverridabilityCondition externalCondition : ServiceLoader.load(ExternalOverridabilityCondition.class,ExternalOverridabilityCondition.class.getClassLoader())) {
      if (!externalCondition.isOverridable(superDescriptor,subDescriptor)) {
        return OverrideCompatibilityInfo.externalConditionFailed(externalCondition.getClass());
      }
    }
  }
 else {
    for (int i=0; i < superValueParameters.size(); ++i) {
      JetType superValueParameterType=getUpperBound(superValueParameters.get(i));
      JetType subValueParameterType=getUpperBound(subValueParameters.get(i));
      if (!JetTypeChecker.INSTANCE.equalTypes(superValueParameterType,subValueParameterType)) {
        return OverrideCompatibilityInfo.valueParameterTypeMismatch(superValueParameterType,subValueParameterType,OverrideCompatibilityInfo.Result.INCOMPATIBLE);
      }
    }
    return OverrideCompatibilityInfo.success();
  }
  return OverrideCompatibilityInfo.success();
}
