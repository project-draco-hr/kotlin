{
  @SuppressWarnings("unchecked") JetElement elementOfAdditionalResolve=(JetElement)JetPsiUtil.getTopmostParentOfTypes(jetElement,JetNamedFunction.class,JetClassInitializer.class,JetProperty.class,JetParameter.class,JetDelegationSpecifierList.class,JetImportDirective.class,JetAnnotationEntry.class,JetTypeParameter.class,JetTypeConstraint.class,JetPackageDirective.class,JetCodeFragment.class);
  if (elementOfAdditionalResolve != null && !(elementOfAdditionalResolve instanceof JetParameter)) {
    if (elementOfAdditionalResolve instanceof JetPackageDirective) {
      elementOfAdditionalResolve=jetElement;
    }
    return additionalResolveCache.getValue().invoke(elementOfAdditionalResolve);
  }
  JetParameter parameter=(JetParameter)elementOfAdditionalResolve;
  if (parameter != null) {
    JetClass klass=PsiTreeUtil.getParentOfType(parameter,JetClass.class);
    if (klass != null && parameter.getParent() == klass.getPrimaryConstructorParameterList()) {
      return additionalResolveCache.getValue().invoke(klass);
    }
    jetElement=parameter;
  }
  JetDeclaration declaration=PsiTreeUtil.getParentOfType(jetElement,JetDeclaration.class,false);
  if (declaration != null) {
    resolveSession.resolveToDescriptor(declaration);
  }
  return resolveSession.getBindingContext();
}
