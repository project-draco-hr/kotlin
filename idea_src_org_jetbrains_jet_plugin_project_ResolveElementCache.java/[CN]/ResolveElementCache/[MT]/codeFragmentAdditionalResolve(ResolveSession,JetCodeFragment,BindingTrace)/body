{
  JetExpression codeFragmentExpression=null;
  if (codeFragment instanceof JetExpressionCodeFragment) {
    codeFragmentExpression=((JetExpressionCodeFragment)codeFragment).getExpression();
  }
 else   if (codeFragment instanceof JetBlockCodeFragment) {
    codeFragmentExpression=((JetBlockCodeFragment)codeFragment).getBlock();
  }
  if (codeFragmentExpression == null)   return;
  PsiElement contextElement=codeFragment.getContext();
  if (!(contextElement instanceof JetExpression))   return;
  JetExpression contextExpression=(JetExpression)contextElement;
  BindingContext contextForElement=resolveToElement(contextExpression);
  JetScope scopeForContextElement=contextForElement.get(BindingContext.RESOLUTION_SCOPE,contextExpression);
  if (scopeForContextElement != null) {
    JetScope codeFragmentScope=resolveSession.getScopeProvider().getFileScope(codeFragment);
    ChainedScope chainedScope=new ChainedScope(scopeForContextElement.getContainingDeclaration(),"Scope for resolve code fragment",scopeForContextElement,codeFragmentScope);
    DataFlowInfo dataFlowInfoForContextElement=contextForElement.get(BindingContext.EXPRESSION_DATA_FLOW_INFO,contextExpression);
    AnalyzerPackage.computeTypeInContext(codeFragmentExpression,chainedScope,trace,dataFlowInfoForContextElement == null ? DataFlowInfo.EMPTY : dataFlowInfoForContextElement,TypeUtils.NO_EXPECTED_TYPE,resolveSession.getModuleDescriptor());
  }
}
