{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
      if (model.findLibraryOrderEntry(library) == null) {
        model.addLibraryEntry(library);
        model.commit();
      }
 else {
        model.dispose();
      }
      afterSetUp.run();
      if (!jdkAnnotationsArePresent(module)) {
        addJdkAnnotations(module);
      }
    }
  }
);
}
