{
  Map<Module,ClassFileFactory> outputFiles=Maps.newHashMap();
  AnalysisResult result=analyze(environment);
  if (result == null) {
    return false;
  }
  result.throwIfError();
  for (  Module module : chunk) {
    List<JetFile> jetFiles=CompileEnvironmentUtil.getJetFiles(environment.getProject(),getAbsolutePaths(directory,module),new Function1<String,Unit>(){
      @Override public Unit invoke(      String s){
        throw new IllegalStateException("Should have been checked before: " + s);
      }
    }
);
    GenerationState generationState=generate(environment,result,jetFiles,module.getModuleName(),new File(module.getOutputDirectory()));
    outputFiles.put(module,generationState.getFactory());
  }
  for (  Module module : chunk) {
    writeOutput(configuration,outputFiles.get(module),new File(module.getOutputDirectory()),jarPath,jarRuntime,null);
  }
  return true;
}
