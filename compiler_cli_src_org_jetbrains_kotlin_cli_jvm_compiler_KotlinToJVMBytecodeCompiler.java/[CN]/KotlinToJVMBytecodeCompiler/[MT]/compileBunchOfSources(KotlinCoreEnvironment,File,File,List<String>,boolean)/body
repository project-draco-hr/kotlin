{
  ModuleVisibilityManager moduleVisibilityManager=ModuleVisibilityManager.SERVICE.getInstance(environment.getProject());
  for (  String path : friendPaths) {
    moduleVisibilityManager.addFriendPath(path);
  }
  GenerationState generationState=analyzeAndGenerate(environment);
  if (generationState == null) {
    return false;
  }
  FqName mainClass=findMainClass(generationState,environment.getSourceFiles());
  try {
    writeOutput(environment.getConfiguration(),generationState.getFactory(),outputDir,jar,includeRuntime,mainClass);
    return true;
  }
  finally {
    generationState.destroy();
  }
}
