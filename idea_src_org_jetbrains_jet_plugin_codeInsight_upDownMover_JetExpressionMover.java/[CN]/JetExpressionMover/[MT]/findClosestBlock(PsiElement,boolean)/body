{
  PsiElement current=PsiTreeUtil.getParentOfType(anchor,JetBlockExpression.class);
  while (current != null) {
    PsiElement parent=current.getParent();
    if (parent instanceof JetClassBody || parent instanceof JetClassInitializer || parent instanceof JetFunction|| parent instanceof JetProperty) {
      return null;
    }
    if (parent instanceof JetBlockExpression)     return (JetBlockExpression)parent;
    PsiElement sibling=down ? current.getNextSibling() : current.getPrevSibling();
    if (sibling != null) {
      JetBlockExpression block=JetPsiUtil.getOutermostJetElement(sibling,down,JetBlockExpression.class);
      if (block != null)       return block;
      current=sibling;
    }
 else {
      current=parent;
    }
  }
  return null;
}
