{
  JetExpression condition=ifExpression.getCondition();
  JetExpression thenRoot=ifExpression.getThen();
  JetExpression elseRoot=(JetExpression)JetPsiUtil.skipTrailingWhitespacesAndComments(ifExpression);
  assertNotNull(condition);
  assertNotNull(thenRoot);
  assertNotNull(elseRoot);
  JetPsiFactory psiFactory=JetPsiFactory(ifExpression);
  JetIfExpression newIfExpression=psiFactory.createIf(condition,thenRoot,elseRoot);
  JetReturnExpression newReturnExpression=psiFactory.createReturn(newIfExpression);
  newIfExpression=(JetIfExpression)newReturnExpression.getReturnedExpression();
  assertNotNull(newIfExpression);
  JetReturnExpression thenReturn=getFoldableBranchedReturn(newIfExpression.getThen());
  JetReturnExpression elseReturn=getFoldableBranchedReturn(newIfExpression.getElse());
  assertNotNull(thenReturn);
  assertNotNull(elseReturn);
  JetExpression thenExpr=thenReturn.getReturnedExpression();
  JetExpression elseExpr=elseReturn.getReturnedExpression();
  assertNotNull(thenExpr);
  assertNotNull(elseExpr);
  thenReturn.replace(thenExpr);
  elseReturn.replace(elseExpr);
  elseRoot.delete();
  ifExpression.replace(newReturnExpression);
}
