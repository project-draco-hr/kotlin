{
  JetBinaryExpression thenAssignment=getFoldableBranchedAssignment(ifExpression.getThen());
  assertNotNull(thenAssignment);
  String op=thenAssignment.getOperationReference().getText();
  JetSimpleNameExpression lhs=(JetSimpleNameExpression)thenAssignment.getLeft();
  JetExpression assignment=createExpressionByPattern(JetPsiFactory(ifExpression),"$0 $1 $2",lhs,op,ifExpression);
  JetIfExpression newIfExpression=(JetIfExpression)((JetBinaryExpression)assignment).getRight();
  assertNotNull(newIfExpression);
  thenAssignment=getFoldableBranchedAssignment(newIfExpression.getThen());
  JetBinaryExpression elseAssignment=getFoldableBranchedAssignment(newIfExpression.getElse());
  assertNotNull(thenAssignment);
  assertNotNull(elseAssignment);
  JetExpression thenRhs=thenAssignment.getRight();
  JetExpression elseRhs=elseAssignment.getRight();
  assertNotNull(thenRhs);
  assertNotNull(elseRhs);
  thenAssignment.replace(thenRhs);
  elseAssignment.replace(elseRhs);
  ifExpression.replace(assignment);
}
