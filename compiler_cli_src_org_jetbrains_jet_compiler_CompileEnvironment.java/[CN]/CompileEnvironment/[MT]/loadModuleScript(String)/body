{
  CompileSession scriptCompileSession=newCompileSession();
  scriptCompileSession.addSources(moduleFile);
  ensureRuntime();
  if (compilerDependencies.getRuntimeJar() != null) {
    addToClasspath(compilerDependencies.getRuntimeJar());
  }
  if (!scriptCompileSession.analyze()) {
    return null;
  }
  ClassFileFactory factory=scriptCompileSession.generate(true).getFactory();
  return runDefineModules(moduleFile,factory);
}
