{
  List<PsiClass> answer=new SmartList<PsiClass>();
  final List<PsiFile> filesInScope=ensureUpToDate(scope);
  final String qualifiedName=psiPackage.getQualifiedName();
  for (  PsiFile file : filesInScope) {
    final PsiJavaFileStub stub=file.getUserData(JAVA_API_STUB);
    if (stub == null)     continue;
    if (Comparing.equal(qualifiedName,stub.getPackageName())) {
      for (      StubElement child : stub.getChildrenStubs()) {
        if (child instanceof PsiClassStub) {
          answer.add((PsiClass)child.getPsi());
        }
      }
    }
  }
  return answer.toArray(new PsiClass[answer.size()]);
}
