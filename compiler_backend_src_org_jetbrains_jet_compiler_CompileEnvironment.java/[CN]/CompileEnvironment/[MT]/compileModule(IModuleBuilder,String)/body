{
  CompileSession moduleCompileSession=new CompileSession(myEnvironment);
  if (!"stdlib".equals(moduleBuilder.getModuleName())) {
    moduleCompileSession.addStdLibSources(false);
  }
  for (  String sourceFile : moduleBuilder.getSourceFiles()) {
    File source=new File(sourceFile);
    if (!source.isAbsolute()) {
      source=new File(directory,sourceFile);
    }
    moduleCompileSession.addSources(source.getPath());
  }
  for (  String classpathRoot : moduleBuilder.getClasspathRoots()) {
    if (classpathRoot.contains("/stdlib/") || classpathRoot.contains("\\stdlib\\"))     continue;
    myEnvironment.addToClasspath(new File(classpathRoot));
  }
  if (!moduleCompileSession.analyze(myErrorStream)) {
    return null;
  }
  return moduleCompileSession.generate();
}
