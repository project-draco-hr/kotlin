{
  if (descriptor == null)   return null;
  if (substitutor.isEmpty())   return descriptor;
  if (substitutedDescriptors == null) {
    substitutedDescriptors=new HashMap<DeclarationDescriptor,DeclarationDescriptor>();
  }
  DeclarationDescriptor substituted=substitutedDescriptors.get(descriptor);
  if (substituted == null && !substitutedDescriptors.containsKey(descriptor)) {
    substituted=descriptor.substitute(substitutor);
    substitutedDescriptors.put(descriptor,substituted);
  }
  return (D)substituted;
}
