{
  JetExpression bodyExpression=function.getBodyExpression();
  if (bodyExpression == null)   return;
  final boolean blockBody=function.hasBlockBody();
  final ExpressionTypingContext context=blockBody ? ExpressionTypingContext.newRootContext(semanticServices,trace,functionInnerScope,dataFlowInfo,TypeUtils.NO_EXPECTED_TYPE,expectedReturnType) : ExpressionTypingContext.newRootContext(semanticServices,trace,functionInnerScope,dataFlowInfo,expectedReturnType,TypeUtils.FORBIDDEN);
  if (function instanceof JetFunctionLiteralExpression) {
    JetFunctionLiteralExpression functionLiteralExpression=(JetFunctionLiteralExpression)function;
    getBlockReturnedType(functionInnerScope,functionLiteralExpression.getBodyExpression(),CoercionStrategy.COERCION_TO_UNIT,context);
  }
 else {
    expressionTyperVisitor.getType(bodyExpression,context);
  }
}
