{
  if (isRoot()) {
    return;
  }
  int pos=fqName.indexOf('.');
  if (pos < 0) {
    if (this.parent == null) {
      this.parent=FqName.ROOT.toUnsafe();
    }
    if (this.shortName == null) {
      this.shortName=Name.guess(fqName);
    }
    callback.segment(shortName,this);
    return;
  }
  Name firstSegment=Name.guess(fqName.substring(0,pos));
  FqNameUnsafe last=new FqNameUnsafe(firstSegment.getName(),FqName.ROOT.toUnsafe(),firstSegment);
  callback.segment(firstSegment,last);
  while (true) {
    int next=fqName.indexOf('.',pos + 1);
    if (next < 0) {
      if (this.parent == null) {
        this.parent=last;
      }
      Name shortName=Name.guess(fqName.substring(pos + 1));
      if (this.shortName == null) {
        this.shortName=shortName;
      }
      callback.segment(shortName,this);
      return;
    }
    Name shortName=Name.guess(fqName.substring(pos + 1,next));
    last=new FqNameUnsafe(fqName.substring(0,next),last,shortName);
    callback.segment(shortName,last);
    pos=next;
  }
}
