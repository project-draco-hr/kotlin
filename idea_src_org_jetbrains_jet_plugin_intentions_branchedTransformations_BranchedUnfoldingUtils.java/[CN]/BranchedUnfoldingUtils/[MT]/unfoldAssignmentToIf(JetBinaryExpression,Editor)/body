{
  Project project=assignment.getProject();
  String op=assignment.getOperationReference().getText();
  JetExpression lhs=assignment.getLeft();
  JetIfExpression ifExpression=(JetIfExpression)assignment.getRight();
  assertNotNull(ifExpression);
  JetIfExpression newIfExpression=(JetIfExpression)ifExpression.copy();
  JetExpression thenExpr=getOutermostLastBlockElement(newIfExpression.getThen());
  JetExpression elseExpr=getOutermostLastBlockElement(newIfExpression.getElse());
  assertNotNull(thenExpr);
  assertNotNull(elseExpr);
  JetPsiFactory psiFactory=JetPsiFactory(project);
  thenExpr.replace(psiFactory.createBinaryExpression(lhs,op,thenExpr));
  elseExpr.replace(psiFactory.createBinaryExpression(lhs,op,elseExpr));
  PsiElement resultElement=assignment.replace(newIfExpression);
  editor.getCaretModel().moveToOffset(resultElement.getTextOffset());
}
