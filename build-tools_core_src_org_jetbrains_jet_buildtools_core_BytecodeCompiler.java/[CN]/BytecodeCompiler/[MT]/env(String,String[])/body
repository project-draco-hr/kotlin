{
  CompilerSpecialMode compilerSpecialMode=CompilerSpecialMode.REGULAR;
  File runtimeJar;
  if (compilerSpecialMode.includeKotlinRuntime()) {
    if ((stdlib != null) && (stdlib.trim().length() > 0)) {
      runtimeJar=new File(stdlib);
    }
 else {
      runtimeJar=PathUtil.getDefaultRuntimePath();
    }
  }
 else {
    runtimeJar=null;
  }
  CompileEnvironment env=new CompileEnvironment(new CompilerDependencies(compilerSpecialMode,compilerSpecialMode.includeJdkHeaders() ? PathUtil.getAltHeadersPath() : null,runtimeJar));
  if ((classpath != null) && (classpath.length > 0)) {
    env.addToClasspath(classpath);
  }
  env.getEnvironment().getCompilerPlugins().addAll(getCompilerPlugins());
  return env;
}
