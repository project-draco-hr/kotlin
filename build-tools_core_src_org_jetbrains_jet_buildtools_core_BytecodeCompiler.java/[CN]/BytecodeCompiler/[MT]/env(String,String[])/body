{
  CompilerDependencies dependencies=CompilerDependencies.compilerDependenciesForProduction(CompilerSpecialMode.REGULAR);
  JetCoreEnvironment environment=new JetCoreEnvironment(CompileEnvironmentUtil.createMockDisposable(),dependencies);
  CompileEnvironmentConfiguration env=new CompileEnvironmentConfiguration(environment,dependencies,MessageCollector.PLAIN_TEXT_TO_SYSTEM_ERR);
  if ((stdlib != null) && (stdlib.trim().length() > 0)) {
    File file=new File(stdlib);
    CompileEnvironmentUtil.addToClasspath(env.getEnvironment(),file);
  }
  if ((classpath != null) && (classpath.length > 0)) {
    CompileEnvironmentUtil.addToClasspath(env.getEnvironment(),classpath);
  }
  env.getEnvironment().getCompilerPlugins().addAll(getCompilerPlugins());
  return env;
}
