{
  Pair<JetFile,KotlinCoreEnvironment> fileAndEnv=createPsiFile(filename);
  JetFile psiFile=fileAndEnv.getFirst();
  KotlinCoreEnvironment environment=fileAndEnv.getSecond();
  GenerationState state=GenerationUtils.compileFileGetGenerationStateForTest(psiFile,environment);
  List<Integer> expectedLineNumbers;
  List<Integer> actualLineNumbers;
  if (custom) {
    expectedLineNumbers=extractCustomLineNumbersFromSource(psiFile);
    actualLineNumbers=extractActualLineNumbersFromBytecode(state,false);
    assertEquals(expectedLineNumbers,actualLineNumbers);
  }
 else {
    expectedLineNumbers=extractSelectedLineNumbersFromSource(psiFile);
    actualLineNumbers=extractActualLineNumbersFromBytecode(state,true);
    assertSameElements(actualLineNumbers,expectedLineNumbers);
  }
}
