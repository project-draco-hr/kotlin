{
  boolean nullable=!EnumSet.of(TYPE_ARGUMENT,SUPERTYPE_ARGUMENT,SUPERTYPE).contains(howThisTypeIsUsed);
  ClassDescriptor classData=JavaToKotlinClassMap.getInstance().mapKotlinClass(fqName,howThisTypeIsUsed);
  if (classData == null) {
    classData=classResolver.resolveClass(fqName,INCLUDE_KOTLIN_SOURCES);
  }
  if (classData == null) {
    return null;
  }
  List<TypeProjection> arguments=Lists.newArrayList();
  List<TypeParameterDescriptor> parameters=classData.getTypeConstructor().getParameters();
  if (isRaw(classType,!parameters.isEmpty())) {
    for (    TypeParameterDescriptor parameter : parameters) {
      Variance projectionKind=parameter.getVariance() == OUT_VARIANCE || howThisTypeIsUsed == SUPERTYPE ? INVARIANT : OUT_VARIANCE;
      arguments.add(new TypeProjection(projectionKind,KotlinBuiltIns.getInstance().getNullableAnyType()));
    }
  }
 else {
    PsiType[] psiArguments=classType.getPsi().getParameters();
    if (parameters.size() != psiArguments.length) {
      LOG.warn("parameters = " + parameters.size() + ", actual arguments = "+ psiArguments.length+ " in "+ classType.getPresentableText()+ "\n fqName: \n"+ fqName);
      for (      TypeParameterDescriptor parameter : parameters) {
        arguments.add(new TypeProjection(ErrorUtils.createErrorType(parameter.getName().asString())));
      }
    }
 else {
      for (int i=0; i < parameters.size(); i++) {
        PsiType psiArgument=psiArguments[i];
        TypeParameterDescriptor typeParameterDescriptor=parameters.get(i);
        TypeUsage howTheProjectionIsUsed=howThisTypeIsUsed == SUPERTYPE ? SUPERTYPE_ARGUMENT : TYPE_ARGUMENT;
        TypeProjection typeProjection=transformToTypeProjection(JavaType.create(psiArgument),typeParameterDescriptor,typeVariableResolver,howTheProjectionIsUsed);
        if (typeProjection.getProjectionKind() == typeParameterDescriptor.getVariance()) {
          arguments.add(new TypeProjection(INVARIANT,typeProjection.getType()));
        }
 else {
          arguments.add(typeProjection);
        }
      }
    }
  }
  return new JetTypeImpl(Collections.<AnnotationDescriptor>emptyList(),classData.getTypeConstructor(),nullable,arguments,classData.getMemberScope(arguments));
}
