{
  boolean nullable=!EnumSet.of(TYPE_ARGUMENT,SUPERTYPE_ARGUMENT,SUPERTYPE).contains(howThisTypeIsUsed);
  ClassDescriptor classData=JavaToKotlinClassMap.getInstance().mapKotlinClass(fqName,howThisTypeIsUsed);
  if (classData == null) {
    classData=classResolver.resolveClass(fqName,INCLUDE_KOTLIN_SOURCES);
  }
  if (classData == null) {
    return null;
  }
  List<TypeProjection> arguments=new ArrayList<TypeProjection>();
  List<TypeParameterDescriptor> parameters=classData.getTypeConstructor().getParameters();
  if (isRaw(classifierType,!parameters.isEmpty())) {
    for (    TypeParameterDescriptor parameter : parameters) {
      Variance projectionKind=parameter.getVariance() == OUT_VARIANCE || howThisTypeIsUsed == SUPERTYPE ? INVARIANT : OUT_VARIANCE;
      arguments.add(new TypeProjection(projectionKind,KotlinBuiltIns.getInstance().getNullableAnyType()));
    }
  }
 else {
    Collection<JavaType> javaTypeArguments=classifierType.getTypeArguments();
    if (parameters.size() != javaTypeArguments.size()) {
      LOG.warn("parameters = " + parameters.size() + ", actual arguments = "+ javaTypeArguments.size()+ " in "+ classifierType.getPresentableText()+ "\n fqName: \n"+ fqName);
      for (      TypeParameterDescriptor parameter : parameters) {
        arguments.add(new TypeProjection(ErrorUtils.createErrorType(parameter.getName().asString())));
      }
    }
 else {
      int index=0;
      for (      JavaType typeArgument : javaTypeArguments) {
        TypeParameterDescriptor typeParameterDescriptor=parameters.get(index);
        index++;
        TypeUsage howTheProjectionIsUsed=howThisTypeIsUsed == SUPERTYPE ? SUPERTYPE_ARGUMENT : TYPE_ARGUMENT;
        TypeProjection typeProjection=transformToTypeProjection(typeArgument,typeParameterDescriptor,typeVariableResolver,howTheProjectionIsUsed);
        if (typeProjection.getProjectionKind() == typeParameterDescriptor.getVariance()) {
          arguments.add(new TypeProjection(INVARIANT,typeProjection.getType()));
        }
 else {
          arguments.add(typeProjection);
        }
      }
    }
  }
  return new JetTypeImpl(Collections.<AnnotationDescriptor>emptyList(),classData.getTypeConstructor(),nullable,arguments,classData.getMemberScope(arguments));
}
