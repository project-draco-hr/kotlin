{
  if (file instanceof KtCodeFragment) {
    KtFile contextFile=((KtCodeFragment)file).getContextContainingFile();
    if (contextFile != null) {
      return getPlatform(contextFile);
    }
  }
  VirtualFile virtualFile=file.getOriginalFile().getVirtualFile();
  if (virtualFile == null) {
    return getDefaultPlatform();
  }
  Module moduleForFile=ProjectFileIndex.SERVICE.getInstance(file.getProject()).getModuleForFile(virtualFile);
  if (moduleForFile == null) {
    return getDefaultPlatform();
  }
  return getPlatform(moduleForFile);
}
