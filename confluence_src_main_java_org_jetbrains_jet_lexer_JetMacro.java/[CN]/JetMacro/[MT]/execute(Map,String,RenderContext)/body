{
  try {
    VelocityContext context=new VelocityContext(MacroUtils.defaultVelocityContext());
    String renderedTemplate=VelocityUtils.getRenderedTemplate("template.velocity",context);
    StringBuilder result=new StringBuilder(renderedTemplate);
    generateHtmlFromCode(code,result);
    return result.toString();
  }
 catch (  Throwable e) {
    return ConfluenceUtils.getErrorInHtml(e,code);
  }
}
