{
  String text=expression.getText();
  if (!noExpectedTypeOrError(expectedType) && !JetTypeChecker.INSTANCE.isSubtypeOf(builtIns.getCharType(),expectedType)) {
    return reportError(CONSTANT_EXPECTED_TYPE_MISMATCH.on(expression,"character",expectedType));
  }
  if (text.length() < 2 || text.charAt(0) != '\'' || text.charAt(text.length() - 1) != '\'') {
    return reportError(INCORRECT_CHARACTER_LITERAL.on(expression));
  }
  text=text.substring(1,text.length() - 1);
  if (text.length() == 0) {
    return reportError(EMPTY_CHARACTER_LITERAL.on(expression));
  }
  if (text.charAt(0) != '\\') {
    if (text.length() == 1) {
      return false;
    }
    return reportError(TOO_MANY_CHARACTERS_IN_CHARACTER_LITERAL.on(expression,expression));
  }
  if (constant == null) {
    return reportError(ILLEGAL_ESCAPE.on(expression,expression));
  }
  return false;
}
