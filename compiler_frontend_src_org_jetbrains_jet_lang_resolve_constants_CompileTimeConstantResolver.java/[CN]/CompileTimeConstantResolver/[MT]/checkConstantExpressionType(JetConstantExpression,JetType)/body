{
  CompileTimeConstant<?> compileTimeConstant=getCompileTimeConstant(expression,expectedType);
  Set<DiagnosticFactory> errorsThatDependOnExpectedType=Sets.<DiagnosticFactory>newHashSet(CONSTANT_EXPECTED_TYPE_MISMATCH,NULL_FOR_NONNULL_TYPE);
  if (compileTimeConstant instanceof ErrorValueWithDiagnostic) {
    Diagnostic diagnostic=((ErrorValueWithDiagnostic)compileTimeConstant).getDiagnostic();
    if (errorsThatDependOnExpectedType.contains(diagnostic.getFactory())) {
      return diagnostic;
    }
  }
  return null;
}
