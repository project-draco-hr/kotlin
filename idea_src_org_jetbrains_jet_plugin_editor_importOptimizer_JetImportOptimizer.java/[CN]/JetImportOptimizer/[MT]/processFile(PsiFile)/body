{
  return new Runnable(){
    @Override public void run(){
      final JetFile jetFile=(JetFile)file;
      final Set<FqName> usedQualifiedNames=extractUsedQualifiedNames(jetFile);
      final List<JetImportDirective> directives=jetFile.getImportDirectives();
      final List<JetImportDirective> directivesBeforeCurrent=Lists.newArrayList();
      final List<JetImportDirective> directivesAfterCurrent=jetFile.getImportDirectives();
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          for (          JetImportDirective anImport : directives) {
            directivesAfterCurrent.remove(anImport);
            ImportPath importPath=JetPsiUtil.getImportPath(anImport);
            if (importPath == null) {
              continue;
            }
            if (isUseful(importPath,usedQualifiedNames) && needImport(importPath,jetFile,directivesBeforeCurrent) && needImport(importPath,jetFile,directivesAfterCurrent)) {
              directivesBeforeCurrent.add(anImport);
            }
 else {
              anImport.delete();
            }
          }
        }
      }
);
    }
  }
;
}
