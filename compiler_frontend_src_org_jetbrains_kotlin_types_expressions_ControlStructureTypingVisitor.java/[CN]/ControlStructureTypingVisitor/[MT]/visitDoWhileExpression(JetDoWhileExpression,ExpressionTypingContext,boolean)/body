{
  if (!isStatement)   return DataFlowUtils.illegalStatementType(expression,contextWithExpectedType,facade);
  ExpressionTypingContext context=contextWithExpectedType.replaceExpectedType(NO_EXPECTED_TYPE).replaceContextDependency(INDEPENDENT);
  JetExpression body=expression.getBody();
  JetScope conditionScope=context.scope;
  PreliminaryLoopVisitor loopVisitor=PreliminaryLoopVisitor.visitLoop(expression);
  context=context.replaceDataFlowInfo(loopVisitor.clearDataFlowInfoForAssignedLocalVariables(context.dataFlowInfo));
  JetTypeInfo bodyTypeInfo;
  if (body instanceof JetFunctionLiteralExpression) {
    bodyTypeInfo=facade.getTypeInfo(body,context.replaceScope(context.scope));
  }
 else   if (body != null) {
    WritableScope writableScope=newWritableScopeImpl(context,"do..while body scope");
    conditionScope=writableScope;
    List<JetElement> block;
    if (body instanceof JetBlockExpression) {
      block=((JetBlockExpression)body).getStatements();
    }
 else {
      block=Collections.<JetElement>singletonList(body);
    }
    bodyTypeInfo=components.expressionTypingServices.getBlockReturnedTypeWithWritableScope(writableScope,block,CoercionStrategy.NO_COERCION,context);
  }
 else {
    bodyTypeInfo=TypeInfoFactoryPackage.noTypeInfo(context);
  }
  JetExpression condition=expression.getCondition();
  DataFlowInfo conditionDataFlowInfo=checkCondition(conditionScope,condition,context);
  DataFlowInfo dataFlowInfo;
  if (!containsJumpOutOfLoop(expression,context)) {
    dataFlowInfo=DataFlowUtils.extractDataFlowInfoFromCondition(condition,false,context).and(conditionDataFlowInfo);
  }
 else {
    dataFlowInfo=context.dataFlowInfo;
  }
  if (body != null) {
    dataFlowInfo=dataFlowInfo.and(loopVisitor.clearDataFlowInfoForAssignedLocalVariables(bodyTypeInfo.getJumpFlowInfo()));
  }
  return DataFlowUtils.checkType(bodyTypeInfo.replaceType(components.builtIns.getUnitType()),expression,contextWithExpectedType).replaceDataFlowInfo(dataFlowInfo);
}
