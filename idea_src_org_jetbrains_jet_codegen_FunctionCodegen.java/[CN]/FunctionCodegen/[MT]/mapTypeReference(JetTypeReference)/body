{
  if (typeRef == null) {
    throw new UnsupportedOperationException("Cannot evaluate type for parameter with no type ref");
  }
  final JetTypeElement typeElement=typeRef.getTypeElement();
  if (typeElement instanceof JetUserType) {
    final String referencedName=((JetUserType)typeElement).getReferencedName();
    if ("Array".equals(referencedName)) {
      final List<JetTypeProjection> typeArguments=((JetUserType)typeElement).getTypeArguments();
      if (typeArguments.size() != 1) {
        throw new UnsupportedOperationException("arrays must have one type argument");
      }
      final JetTypeReference elementTypeRef=typeArguments.get(0).getTypeReference();
      Type elementType=mapTypeReference(elementTypeRef);
      return Type.getType("[" + elementType.getDescriptor());
    }
    if ("String".equals(referencedName)) {
      return Type.getType(String.class);
    }
  }
  throw new UnsupportedOperationException("Unknown type " + typeRef);
}
