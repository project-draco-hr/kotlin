{
  File parentFile=file.getParentFile();
  if (!parentFile.exists()) {
    if (parentFile.mkdirs()) {
      System.out.println("Directory created: " + parentFile.getAbsolutePath());
    }
 else {
      throw new IllegalStateException("Cannot create directory: " + parentFile);
    }
  }
  if (checkFileIgnoringLineSeparators(file,newText)) {
    if (logNotChanged) {
      System.out.println("Not changed: " + file.getAbsolutePath());
    }
    return;
  }
  boolean useTmpfile=!SystemInfo.isWindows;
  File tmpfile=useTmpfile ? new File(file.getName() + ".tmp") : file;
  FileUtil.writeToFile(tmpfile,newText);
  System.out.println("File written: " + tmpfile.getAbsolutePath());
  if (useTmpfile) {
    if (!tmpfile.renameTo(file)) {
      throw new RuntimeException("failed to rename " + tmpfile + " to "+ file);
    }
    System.out.println("Renamed " + tmpfile + " to "+ file);
  }
  System.out.println();
}
