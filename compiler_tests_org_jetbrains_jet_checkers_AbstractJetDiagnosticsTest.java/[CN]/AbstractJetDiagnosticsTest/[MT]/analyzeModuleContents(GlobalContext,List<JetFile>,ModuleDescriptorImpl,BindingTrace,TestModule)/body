{
  String platform=getPlatform(testModule);
  if ("jvm".equals(platform)) {
    TopDownAnalyzerFacadeForJVM.analyzeFilesWithJavaIntegrationWithCustomContext(getProject(),context,jetFiles,moduleTrace,Predicates.<PsiFile>alwaysTrue(),module,null,null);
  }
 else   if ("js".equals(platform)) {
    TopDownAnalyzerFacadeForJS.analyzeFilesWithGivenTrace(jetFiles,moduleTrace,module,Predicates.<PsiFile>alwaysTrue(),new Config(getProject(),"module",EcmaVersion.v5,false,true){
      @NotNull @Override protected List<JetFile> generateLibFiles(){
        return Collections.emptyList();
      }
    }
);
  }
 else {
    throw new IllegalStateException("Unknown platform in module " + testModule.getName() + ": "+ platform);
  }
}
