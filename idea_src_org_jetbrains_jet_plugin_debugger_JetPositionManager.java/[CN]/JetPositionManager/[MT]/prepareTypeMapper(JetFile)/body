{
  FqName fqName=JetPsiUtil.getFQName(file);
  CachedValue<JetTypeMapper> value=myTypeMappers.get(fqName);
  if (value == null) {
    value=CachedValuesManager.getManager(file.getProject()).createCachedValue(new CachedValueProvider<JetTypeMapper>(){
      @Override public Result<JetTypeMapper> compute(){
        final AnalyzeExhaust analyzeExhaust=WholeProjectAnalyzerFacade.analyzeProjectWithCacheOnAFile(file);
        analyzeExhaust.throwIfError();
        List<JetFile> namespaceFiles=JetFilesProvider.getInstance(file.getProject()).allNamespaceFiles().fun(file);
        final DelegatingBindingTrace bindingTrace=new DelegatingBindingTrace(analyzeExhaust.getBindingContext());
        JetTypeMapper typeMapper=new JetTypeMapper(bindingTrace,true,ClassBuilderMode.FULL);
        CodegenBinding.initTrace(bindingTrace,namespaceFiles);
        return new Result<JetTypeMapper>(typeMapper,PsiModificationTracker.MODIFICATION_COUNT);
      }
    }
,false);
    myTypeMappers.put(fqName,value);
  }
  return value.getValue();
}
