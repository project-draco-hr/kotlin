{
  final Pair<FqName,IdeaModuleInfo> key=createKeyForTypeMapper(file);
  CachedValue<JetTypeMapper> value=myTypeMappers.get(key);
  if (value == null) {
    value=CachedValuesManager.getManager(file.getProject()).createCachedValue(new CachedValueProvider<JetTypeMapper>(){
      @Override public Result<JetTypeMapper> compute(){
        Project project=file.getProject();
        GlobalSearchScope packageFacadeScope=key.second.contentScope();
        Collection<JetFile> packageFiles=findFilesWithExactPackage(key.first,packageFacadeScope,project);
        AnalysisResult analysisResult=ResolvePackage.getAnalysisResultsForElements(packageFiles);
        analysisResult.throwIfError();
        GenerationState state=new GenerationState(project,ClassBuilderFactories.THROW_EXCEPTION,analysisResult.getModuleDescriptor(),analysisResult.getBindingContext(),new ArrayList<JetFile>(packageFiles));
        state.beforeCompile();
        return new Result<JetTypeMapper>(state.getTypeMapper(),PsiModificationTracker.MODIFICATION_COUNT);
      }
    }
,false);
    myTypeMappers.put(key,value);
  }
  return value.getValue();
}
