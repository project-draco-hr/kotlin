{
  ExpressionTypingContext context=contextWithExpectedType.replaceExpectedType(TypeUtils.NO_EXPECTED_TYPE).replaceExpectedReturnType(TypeUtils.NO_EXPECTED_TYPE);
  JetExpression left=JetPsiUtil.deparenthesize(expression.getLeft());
  JetExpression right=expression.getRight();
  if (left instanceof JetArrayAccessExpression) {
    JetArrayAccessExpression arrayAccessExpression=(JetArrayAccessExpression)left;
    JetType assignmentType=basic.resolveArrayAccessSetMethod(arrayAccessExpression,right,context.replaceScope(scope),context.trace);
    basic.checkLValue(context.trace,arrayAccessExpression);
    return checkAssignmentType(assignmentType,expression,contextWithExpectedType);
  }
  JetType leftType=facade.getType(expression.getLeft(),context.replaceScope(scope));
  if (right != null) {
    JetType rightType=facade.getType(right,context.replaceExpectedType(leftType).replaceScope(scope));
  }
  if (leftType != null) {
    basic.checkLValue(context.trace,expression.getLeft());
  }
  if (left instanceof JetSimpleNameExpression) {
    ExpressionTypingUtils.checkWrappingInRef(left,context);
  }
  return DataFlowUtils.checkStatementType(expression,contextWithExpectedType);
}
