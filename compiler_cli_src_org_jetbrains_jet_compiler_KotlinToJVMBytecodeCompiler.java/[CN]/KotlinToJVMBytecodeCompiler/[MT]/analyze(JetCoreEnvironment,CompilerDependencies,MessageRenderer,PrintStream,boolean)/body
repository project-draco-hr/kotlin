{
  final MessageCollector messageCollector=new MessageCollector(messageRenderer);
  for (  JetFile file : environment.getSourceFiles()) {
    file.accept(new PsiRecursiveElementWalkingVisitor(){
      @Override public void visitErrorElement(      PsiErrorElement element){
        String description=element.getErrorDescription();
        String message=StringUtil.isEmpty(description) ? "Syntax error" : description;
        Diagnostic diagnostic=DiagnosticFactory.create(Severity.ERROR,message).on(element);
        reportDiagnostic(messageCollector,diagnostic);
      }
    }
);
  }
  Predicate<PsiFile> filesToAnalyzeCompletely=stubs ? Predicates.<PsiFile>alwaysFalse() : Predicates.<PsiFile>alwaysTrue();
  AnalyzeExhaust exhaust=AnalyzerFacadeForJVM.analyzeFilesWithJavaIntegration(environment.getProject(),environment.getSourceFiles(),filesToAnalyzeCompletely,JetControlFlowDataTraceFactory.EMPTY,dependencies);
  for (  Diagnostic diagnostic : exhaust.getBindingContext().getDiagnostics()) {
    reportDiagnostic(messageCollector,diagnostic);
  }
  reportIncompleteHierarchies(messageCollector,exhaust);
  messageCollector.printTo(errorStream);
  return messageCollector.hasErrors() ? null : exhaust;
}
