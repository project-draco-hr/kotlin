{
  if (file instanceof JetCodeFragment) {
    JetImportDirective newDirective=JetPsiFactory.createImportDirective(file.getProject(),importPath);
    ((JetCodeFragment)file).addImportsFromString(newDirective.getText());
    return;
  }
  JetImportList importList=file.getImportList();
  if (importList != null) {
    JetImportDirective newDirective=JetPsiFactory.createImportDirective(file.getProject(),importPath);
    importList.add(newDirective);
  }
 else {
    JetImportList newDirective=JetPsiFactory.createImportDirectiveWithImportList(file.getProject(),importPath);
    JetPackageDirective packageDirective=file.getPackageDirective();
    if (packageDirective == null) {
      throw new IllegalStateException("Scripts are not supported: " + file.getName());
    }
    packageDirective.getParent().addAfter(newDirective,packageDirective);
  }
}
