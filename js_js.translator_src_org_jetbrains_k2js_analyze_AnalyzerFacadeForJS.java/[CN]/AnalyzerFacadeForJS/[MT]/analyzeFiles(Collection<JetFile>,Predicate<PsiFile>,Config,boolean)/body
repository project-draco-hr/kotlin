{
  Project project=config.getProject();
  BindingTraceContext bindingTraceContext=new BindingTraceContext();
  final ModuleDescriptor owner=new ModuleDescriptor(Name.special("<module>"));
  Predicate<PsiFile> completely=Predicates.and(notLibFiles(config.getLibFiles()),filesToAnalyzeCompletely);
  TopDownAnalysisParameters topDownAnalysisParameters=new TopDownAnalysisParameters(completely,false,false,Collections.<AnalyzerScriptParameter>emptyList());
  InjectorForTopDownAnalyzerForJs injector=new InjectorForTopDownAnalyzerForJs(project,topDownAnalysisParameters,new ObservableBindingTrace(bindingTraceContext),owner,JsConfiguration.jsLibConfiguration(project));
  try {
    injector.getTopDownAnalyzer().analyzeFiles(withJsLibAdded(files,config),Collections.<AnalyzerScriptParameter>emptyList());
    BodiesResolveContext bodiesResolveContext=storeContextForBodiesResolve ? new CachedBodiesResolveContext(injector.getTopDownAnalysisContext()) : null;
    return AnalyzeExhaust.success(bindingTraceContext.getBindingContext(),JetStandardLibrary.getInstance(),bodiesResolveContext);
  }
  finally {
    injector.destroy();
  }
}
