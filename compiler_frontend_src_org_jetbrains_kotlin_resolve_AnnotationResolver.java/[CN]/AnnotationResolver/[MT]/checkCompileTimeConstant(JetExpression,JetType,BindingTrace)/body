{
  JetType expressionType=trace.getType(argumentExpression);
  if (expressionType == null || !JetTypeChecker.DEFAULT.isSubtypeOf(expressionType,expectedType)) {
    return;
  }
  if (argumentExpression instanceof JetCallExpression) {
    Pair<List<JetExpression>,JetType> arrayArgument=getArgumentExpressionsForArrayCall((JetCallExpression)argumentExpression,trace);
    if (arrayArgument != null) {
      for (      JetExpression expression : arrayArgument.getFirst()) {
        checkCompileTimeConstant(expression,arrayArgument.getSecond(),trace);
      }
    }
  }
  CompileTimeConstant<?> constant=ConstantExpressionEvaluator.getConstant(argumentExpression,trace.getBindingContext());
  if (constant != null && constant.getCanBeUsedInAnnotations()) {
    return;
  }
  ClassifierDescriptor descriptor=expressionType.getConstructor().getDeclarationDescriptor();
  if (descriptor != null && DescriptorUtils.isEnumClass(descriptor)) {
    trace.report(Errors.ANNOTATION_PARAMETER_MUST_BE_ENUM_CONST.on(argumentExpression));
  }
 else   if (descriptor instanceof ClassDescriptor && KotlinBuiltIns.isKClass((ClassDescriptor)descriptor)) {
    trace.report(Errors.ANNOTATION_PARAMETER_MUST_BE_KCLASS_LITERAL.on(argumentExpression));
  }
 else {
    trace.report(Errors.ANNOTATION_PARAMETER_MUST_BE_CONST.on(argumentExpression));
  }
}
