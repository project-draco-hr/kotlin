{
  configureByFile(path);
  String fileText=FileUtil.loadFile(new File(path),true);
  boolean isWithRuntime=InTextDirectivesUtils.findStringWithPrefixes(fileText,"// WITH_RUNTIME") != null;
  try {
    if (isWithRuntime) {
      ConfigLibraryUtil.configureKotlinRuntime(getModule(),getFullJavaJDK());
    }
    DirectiveBasedActionUtils.checkForUnexpectedErrors((JetFile)getFile());
    doTestFor(path,intentionAction,fileText);
  }
  finally {
    if (isWithRuntime) {
      ConfigLibraryUtil.unConfigureKotlinRuntime(getModule(),getProjectJDK());
    }
  }
}
