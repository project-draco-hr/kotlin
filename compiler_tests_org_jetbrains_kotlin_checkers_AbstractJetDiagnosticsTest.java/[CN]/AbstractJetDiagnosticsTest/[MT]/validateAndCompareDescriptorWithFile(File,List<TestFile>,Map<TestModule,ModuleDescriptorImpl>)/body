{
  RecursiveDescriptorComparator comparator=new RecursiveDescriptorComparator(createdAffectedPackagesConfiguration(testFiles));
  boolean isMultiModuleTest=modules.size() != 1;
  StringBuilder rootPackageText=new StringBuilder();
  for (  TestModule module : KotlinPackage.sort(modules.keySet())) {
    ModuleDescriptorImpl moduleDescriptor=modules.get(module);
    DeclarationDescriptor aPackage=moduleDescriptor.getPackage(FqName.ROOT);
    assertNotNull(aPackage);
    if (isMultiModuleTest) {
      rootPackageText.append(String.format("// -- Module: %s --\n",moduleDescriptor.getName()));
    }
    String actualSerialized=comparator.serializeRecursively(aPackage);
    rootPackageText.append(actualSerialized);
    if (isMultiModuleTest) {
      rootPackageText.append("\n\n");
    }
  }
  JetTestUtils.assertEqualsToFile(expectedFile,rootPackageText.toString());
}
