{
  if (expression == null) {
    return noChange(context);
  }
  JetTypeInfo typeInfo=facade.getTypeInfo(expression,context);
  KotlinType type=typeInfo.getType();
  if (type == null) {
    return noChange(context);
  }
  context=context.replaceDataFlowInfo(typeInfo.getDataFlowInfo());
  if (conditionExpected) {
    KotlinType booleanType=components.builtIns.getBooleanType();
    if (!KotlinTypeChecker.DEFAULT.equalTypes(booleanType,type)) {
      context.trace.report(TYPE_MISMATCH_IN_CONDITION.on(expression,type));
    }
 else {
      DataFlowInfo ifInfo=components.dataFlowAnalyzer.extractDataFlowInfoFromCondition(expression,true,context);
      DataFlowInfo elseInfo=components.dataFlowAnalyzer.extractDataFlowInfoFromCondition(expression,false,context);
      return new DataFlowInfos(ifInfo,elseInfo);
    }
    return noChange(context);
  }
  checkTypeCompatibility(context,type,subjectType,expression);
  DataFlowValue expressionDataFlowValue=DataFlowValueFactory.createDataFlowValue(expression,type,context);
  DataFlowInfos result=noChange(context);
  result=new DataFlowInfos(result.thenInfo.equate(subjectDataFlowValue,expressionDataFlowValue),result.elseInfo.disequate(subjectDataFlowValue,expressionDataFlowValue));
  return result;
}
