{
  JetExpression bodyExpression=function.getBodyExpression();
  if (bodyExpression == null)   return;
  final boolean blockBody=function.hasBlockBody();
  final ExpressionTypingContext newContext=blockBody ? context.replaceExpectedType(NO_EXPECTED_TYPE) : context.replaceExpectedType(context.expectedReturnType == FORBIDDEN ? NO_EXPECTED_TYPE : context.expectedReturnType).replaceExpectedReturnType(FORBIDDEN);
  if (function instanceof JetFunctionLiteralExpression) {
    JetFunctionLiteralExpression functionLiteralExpression=(JetFunctionLiteralExpression)function;
    getBlockReturnedType(newContext.scope,functionLiteralExpression.getBodyExpression(),CoercionStrategy.COERCION_TO_UNIT,newContext);
  }
 else {
    expressionTypingFacade.getType(bodyExpression,newContext);
  }
}
