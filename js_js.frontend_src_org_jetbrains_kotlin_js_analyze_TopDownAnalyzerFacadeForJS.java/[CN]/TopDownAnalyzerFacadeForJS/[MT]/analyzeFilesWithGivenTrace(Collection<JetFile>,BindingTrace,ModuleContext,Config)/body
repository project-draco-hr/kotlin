{
  Collection<JetFile> allFiles=Config.withJsLibAdded(files,config);
  InjectorForTopDownAnalyzerForJs injector=new InjectorForTopDownAnalyzerForJs(moduleContext,trace,new FileBasedDeclarationProviderFactory(moduleContext.getStorageManager(),allFiles));
  try {
    injector.getLazyTopDownAnalyzerForTopLevel().analyzeFiles(TopDownAnalysisMode.TopLevelDeclarations,files,Collections.<PackageFragmentProvider>emptyList());
    return JsAnalysisResult.success(trace,moduleContext.getModule());
  }
  finally {
    injector.destroy();
  }
}
