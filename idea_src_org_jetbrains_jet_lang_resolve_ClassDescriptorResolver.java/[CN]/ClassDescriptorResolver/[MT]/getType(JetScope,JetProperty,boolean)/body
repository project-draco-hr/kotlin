{
  JetTypeReference propertyTypeRef=property.getPropertyTypeRef();
  JetType type;
  if (propertyTypeRef == null) {
    final JetExpression initializer=property.getInitializer();
    if (initializer == null) {
      trace.getErrorHandler().genericError(property.getNode(),"This property must either have a type annotation or be initialized");
      type=ErrorUtils.createErrorType("No type, no body");
    }
 else {
      LazyValue<JetType> lazyValue=new LazyValue<JetType>(){
        @Override protected JetType compute(){
          return semanticServices.getTypeInferrer(trace,JetFlowInformationProvider.THROW_EXCEPTION).safeGetType(scope,initializer,false);
        }
      }
;
      if (allowDeferred) {
        type=new DeferredType(lazyValue);
      }
 else {
        type=lazyValue.get();
      }
    }
  }
 else {
    type=typeResolver.resolveType(scope,propertyTypeRef);
  }
  return type;
}
