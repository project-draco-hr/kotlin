{
  ProtoBuf.Class.Builder builder=ProtoBuf.Class.newBuilder();
  int flags=Flags.getClassFlags(hasAnnotations(classDescriptor),classDescriptor.getVisibility(),classDescriptor.getModality(),classDescriptor.getKind(),classDescriptor.isInner(),classDescriptor.isCompanionObject(),classDescriptor.isData());
  if (flags != builder.getFlags()) {
    builder.setFlags(flags);
  }
  builder.setFqName(getClassId(classDescriptor));
  for (  TypeParameterDescriptor typeParameterDescriptor : classDescriptor.getDeclaredTypeParameters()) {
    builder.addTypeParameter(typeParameter(typeParameterDescriptor));
  }
  if (!KotlinBuiltIns.isSpecialClassWithNoSupertypes(classDescriptor)) {
    for (    KotlinType supertype : classDescriptor.getTypeConstructor().getSupertypes()) {
      if (useTypeTable()) {
        builder.addSupertypeId(typeId(supertype));
      }
 else {
        builder.addSupertype(type(supertype));
      }
    }
  }
  for (  ConstructorDescriptor descriptor : classDescriptor.getConstructors()) {
    builder.addConstructor(constructorProto(descriptor));
  }
  for (  DeclarationDescriptor descriptor : sort(DescriptorUtils.getAllDescriptors(classDescriptor.getDefaultType().getMemberScope()))) {
    if (descriptor instanceof CallableMemberDescriptor) {
      CallableMemberDescriptor member=(CallableMemberDescriptor)descriptor;
      if (member.getKind() == CallableMemberDescriptor.Kind.FAKE_OVERRIDE)       continue;
      if (descriptor instanceof PropertyDescriptor) {
        builder.addProperty(propertyProto((PropertyDescriptor)descriptor));
      }
 else       if (descriptor instanceof FunctionDescriptor) {
        builder.addFunction(functionProto((FunctionDescriptor)descriptor));
      }
    }
  }
  for (  DeclarationDescriptor descriptor : sort(DescriptorUtils.getAllDescriptors(classDescriptor.getUnsubstitutedInnerClassesScope()))) {
    int name=getSimpleNameIndex(descriptor.getName());
    if (isEnumEntry(descriptor)) {
      builder.addEnumEntry(name);
    }
 else {
      builder.addNestedClassName(name);
    }
  }
  ClassDescriptor companionObjectDescriptor=classDescriptor.getCompanionObjectDescriptor();
  if (companionObjectDescriptor != null) {
    builder.setCompanionObjectName(getSimpleNameIndex(companionObjectDescriptor.getName()));
  }
  ProtoBuf.TypeTable typeTableProto=typeTable.serialize();
  if (typeTableProto != null) {
    builder.setTypeTable(typeTableProto);
  }
  extension.serializeClass(classDescriptor,builder);
  return builder;
}
