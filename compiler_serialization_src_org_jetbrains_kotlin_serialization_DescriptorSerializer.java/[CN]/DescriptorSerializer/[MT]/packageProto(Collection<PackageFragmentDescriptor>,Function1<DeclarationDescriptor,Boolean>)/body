{
  ProtoBuf.Package.Builder builder=ProtoBuf.Package.newBuilder();
  Collection<DeclarationDescriptor> members=new ArrayList<DeclarationDescriptor>();
  for (  PackageFragmentDescriptor fragment : fragments) {
    members.addAll(DescriptorUtils.getAllDescriptors(fragment.getMemberScope()));
  }
  for (  DeclarationDescriptor declaration : sort(members)) {
    if (skip != null && skip.invoke(declaration))     continue;
    if (declaration instanceof PropertyDescriptor) {
      builder.addProperty(propertyProto((PropertyDescriptor)declaration));
    }
 else     if (declaration instanceof FunctionDescriptor) {
      builder.addFunction(functionProto((FunctionDescriptor)declaration));
    }
  }
  ProtoBuf.TypeTable typeTableProto=typeTable.serialize();
  if (typeTableProto != null) {
    builder.setTypeTable(typeTableProto);
  }
  extension.serializePackage(builder);
  return builder;
}
