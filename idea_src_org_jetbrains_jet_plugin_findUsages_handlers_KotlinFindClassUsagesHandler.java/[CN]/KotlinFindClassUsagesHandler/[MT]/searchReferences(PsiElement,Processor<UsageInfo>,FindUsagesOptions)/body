{
  return ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
    @Override public Boolean compute(){
      KotlinClassFindUsagesOptions kotlinOptions=(KotlinClassFindUsagesOptions)options;
      JetClass jetClass=(JetClass)element;
      if (kotlinOptions.isUsages || kotlinOptions.searchConstructorUsages) {
        Collection<PsiReference> references=ReferencesSearch.search(new ReferencesSearch.SearchParameters(jetClass,kotlinOptions.searchScope,false)).findAll();
        for (        PsiReference ref : references) {
          boolean constructorUsage=FindUsagesUtils.isConstructorUsage(ref.getElement(),jetClass);
          if ((constructorUsage && !kotlinOptions.searchConstructorUsages) || (!constructorUsage && !kotlinOptions.isUsages))           continue;
          TextRange rangeInElement=ref.getRangeInElement();
          processor.process(new UsageInfo(ref.getElement(),rangeInElement.getStartOffset(),rangeInElement.getEndOffset(),false));
        }
      }
      PsiClass lightClass=LightClassUtil.getPsiClass(getElement());
      if (lightClass == null)       return true;
      if (!processInheritors(lightClass,processor,kotlinOptions))       return false;
      if (!processDeclarationsUsages(jetClass,processor,kotlinOptions))       return false;
      return true;
    }
  }
);
}
