{
  Variance projectionKind=projection.getProjectionKind();
  Variance parameterVariance=parameter.getVariance();
  if (parameterVariance == Variance.INVARIANT) {
    return projectionKind;
  }
  if (mode.getSkipDeclarationSiteWildcards()) {
    return Variance.INVARIANT;
  }
  if (projectionKind == Variance.INVARIANT || projectionKind == parameterVariance) {
    if (mode.getSkipDeclarationSiteWildcardsIfPossible() && !projection.isStarProjection()) {
      if (parameterVariance == Variance.OUT_VARIANCE && TypeMappingUtil.isMostPreciseCovariantArgument(projection.getType())) {
        return Variance.INVARIANT;
      }
      if (parameterVariance == Variance.IN_VARIANCE && TypeMappingUtil.isMostPreciseContravariantArgument(projection.getType(),parameter)) {
        return Variance.INVARIANT;
      }
    }
    return parameterVariance;
  }
  return Variance.OUT_VARIANCE;
}
