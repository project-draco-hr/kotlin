{
  Type blockType=jetTypeMapper.mapType(scriptDescriptor.getReturnType(),MapTypeMode.VALUE);
  classBuilder.newField(null,Opcodes.ACC_PUBLIC | Opcodes.ACC_FINAL,ScriptNameUtil.LAST_EXPRESSION_VALUE_FIELD_NAME,blockType.getDescriptor(),null,null);
  JvmMethodSignature jvmSignature=jetTypeMapper.mapScriptSignature(scriptDescriptor,importedScripts);
  state.setScriptConstructorMethod(jvmSignature.getAsmMethod());
  MethodVisitor mv=classBuilder.newMethod(scriptDeclaration,Opcodes.ACC_PUBLIC,jvmSignature.getAsmMethod().getName(),jvmSignature.getAsmMethod().getDescriptor(),null,null);
  mv.visitCode();
  InstructionAdapter instructionAdapter=new InstructionAdapter(mv);
  JvmClassName className=closureAnnotator.classNameForClassDescriptor(classDescriptorForScript);
  instructionAdapter.load(0,className.getAsmType());
  instructionAdapter.invokespecial(JdkNames.JL_OBJECT.getInternalName(),"<init>","()V");
  instructionAdapter.load(0,className.getAsmType());
  FrameMap frameMap=context.prepareFrame(jetTypeMapper);
  for (  ScriptDescriptor importedScript : importedScripts) {
    frameMap.enter(importedScript,TYPE_OBJECT);
  }
  Type[] argTypes=jvmSignature.getAsmMethod().getArgumentTypes();
  int add=0;
  for (int i=0; i < scriptDescriptor.getValueParameters().size(); i++) {
    ValueParameterDescriptor parameter=scriptDescriptor.getValueParameters().get(i);
    frameMap.enter(parameter,argTypes[i + add]);
  }
  ImplementationBodyCodegen.generateInitializers(new ExpressionCodegen(instructionAdapter,frameMap,Type.VOID_TYPE,context,state),instructionAdapter,scriptDeclaration.getDeclarations(),bindingContext,jetTypeMapper);
  int offset=1;
  for (  ScriptDescriptor earlierScript : importedScripts) {
    JvmClassName earlierClassName=closureAnnotator.classNameForScriptDescriptor(earlierScript);
    instructionAdapter.load(0,className.getAsmType());
    instructionAdapter.load(offset,earlierClassName.getAsmType());
    offset+=earlierClassName.getAsmType().getSize();
    instructionAdapter.putfield(className.getInternalName(),getScriptFieldName(earlierScript),earlierClassName.getAsmType().getDescriptor());
  }
  for (  ValueParameterDescriptor parameter : scriptDescriptor.getValueParameters()) {
    Type parameterType=jetTypeMapper.mapType(parameter.getType(),MapTypeMode.VALUE);
    instructionAdapter.load(0,className.getAsmType());
    instructionAdapter.load(offset,parameterType);
    offset+=parameterType.getSize();
    instructionAdapter.putfield(className.getInternalName(),parameter.getName().getIdentifier(),parameterType.getDescriptor());
  }
  StackValue stackValue=new ExpressionCodegen(mv,frameMap,Type.VOID_TYPE,context,state).gen(scriptDeclaration.getBlockExpression());
  if (stackValue.type != Type.VOID_TYPE) {
    stackValue.put(stackValue.type,instructionAdapter);
    instructionAdapter.putfield(className.getInternalName(),ScriptNameUtil.LAST_EXPRESSION_VALUE_FIELD_NAME,blockType.getDescriptor());
  }
  instructionAdapter.areturn(Type.VOID_TYPE);
  mv.visitMaxs(-1,-1);
  mv.visitEnd();
}
