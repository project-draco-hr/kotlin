{
  ReplInterpreter.LineResult lineResult=getReplInterpreter().eval(line);
  if (lineResult.getType() == ReplInterpreter.LineResultType.SUCCESS) {
    if (!lineResult.isUnit()) {
      replWriter.outputCommandResult(lineResult.getValue());
    }
  }
 else   if (lineResult.getType() == ReplInterpreter.LineResultType.INCOMPLETE) {
    replWriter.notifyIncomplete();
  }
 else   if (lineResult.getType() == ReplInterpreter.LineResultType.COMPILE_ERROR) {
    replWriter.outputCompileError(lineResult.getErrorText());
  }
 else   if (lineResult.getType() == ReplInterpreter.LineResultType.RUNTIME_ERROR) {
    replWriter.outputRuntimeError(lineResult.getErrorText());
  }
 else {
    throw new IllegalStateException("unknown line result type: " + lineResult);
  }
  return lineResult.getType();
}
