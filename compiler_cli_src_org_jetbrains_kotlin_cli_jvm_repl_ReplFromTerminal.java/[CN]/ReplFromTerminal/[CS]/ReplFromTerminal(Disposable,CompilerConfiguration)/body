{
  new Thread("initialize-repl"){
    @Override public void run(){
      try {
        replInterpreter=new ReplInterpreter(disposable,compilerConfiguration);
      }
 catch (      Throwable e) {
        replInitializationFailed=e;
      }
synchronized (waitRepl) {
        waitRepl.notifyAll();
      }
    }
  }
.start();
  String replIdeMode=System.getProperty("repl.ideMode");
  ideMode=replIdeMode != null && replIdeMode.equals("true");
  try {
    OutputStream outStream=System.out;
    if (ideMode) {
      VirtualFile consoleOutputRedirect=new LightVirtualFile("kotlinConsoleReplRedirect");
      outStream=consoleOutputRedirect.getOutputStream(null);
      replWriter=new ReplSystemOutWrapper(System.out);
      System.setOut(replWriter);
    }
    consoleReader=new ConsoleReader("kotlin",System.in,outStream,null);
    consoleReader.setHistoryEnabled(true);
    consoleReader.setExpandEvents(false);
    consoleReader.setHistory(new FileHistory(new File(new File(System.getProperty("user.home")),".kotlin_history")));
  }
 catch (  Exception e) {
    throw UtilsPackage.rethrow(e);
  }
  getReplInterpreter().setIdeMode(ideMode);
}
