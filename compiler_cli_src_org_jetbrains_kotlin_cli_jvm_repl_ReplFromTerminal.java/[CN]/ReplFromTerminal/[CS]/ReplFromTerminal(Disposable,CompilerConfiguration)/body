{
  String replIdeMode=System.getProperty("repl.ideMode");
  ideMode=replIdeMode != null && replIdeMode.equals("true");
  replWriter=new ReplSystemOutWrapper(ideMode,System.out);
  System.setOut(replWriter);
  if (ideMode) {
    replReader=new ReplSystemInWrapper(System.in,replWriter);
    System.setIn(replReader);
  }
  replErrorLogger=new ReplErrorLogger(ideMode,replWriter);
  new Thread("initialize-repl"){
    @Override public void run(){
      try {
        replInterpreter=new ReplInterpreter(disposable,compilerConfiguration,ideMode,replReader);
      }
 catch (      Throwable e) {
        replInitializationFailed=e;
      }
synchronized (waitRepl) {
        waitRepl.notifyAll();
      }
    }
  }
.start();
  try {
    OutputStream outStream=System.out;
    if (ideMode) {
      VirtualFile consoleOutputRedirect=new LightVirtualFile("kotlinConsoleReplRedirect");
      outStream=consoleOutputRedirect.getOutputStream(null);
    }
    consoleReader=new ConsoleReader("kotlin",System.in,outStream,null);
    consoleReader.setHistoryEnabled(true);
    consoleReader.setExpandEvents(false);
    consoleReader.setHistory(new FileHistory(new File(new File(System.getProperty("user.home")),".kotlin_history")));
  }
 catch (  Exception e) {
    replErrorLogger.logException(e);
  }
}
