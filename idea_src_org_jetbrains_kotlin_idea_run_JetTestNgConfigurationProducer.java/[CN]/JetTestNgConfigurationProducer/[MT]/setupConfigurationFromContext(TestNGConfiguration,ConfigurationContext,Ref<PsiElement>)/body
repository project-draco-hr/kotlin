{
  Location location=context.getLocation();
  if (location == null) {
    return false;
  }
  Project project=context.getProject();
  PsiElement leaf=location.getPsiElement();
  if (!ProjectRootsUtil.isInProjectOrLibSource(leaf)) {
    return false;
  }
  if (!(leaf.getContainingFile() instanceof JetFile)) {
    return false;
  }
  JetFile jetFile=(JetFile)leaf.getContainingFile();
  if (ProjectStructureUtil.isJsKotlinModule(jetFile)) {
    return false;
  }
  JetNamedDeclaration declarationToRun=getDeclarationToRun(leaf);
  if (declarationToRun instanceof JetNamedFunction) {
    JetNamedFunction function=(JetNamedFunction)declarationToRun;
    @SuppressWarnings("unchecked") JetElement owner=PsiTreeUtil.getParentOfType(function,JetFunction.class,JetClass.class);
    if (owner instanceof JetClass) {
      PsiClass delegate=LightClassUtil.INSTANCE$.getPsiClass((JetClass)owner);
      if (delegate != null) {
        for (        PsiMethod method : delegate.getMethods()) {
          if (method.getNavigationElement() == function) {
            if (TestNGUtil.hasTest(method)) {
              return configure(configuration,location,context,project,delegate,method);
            }
            break;
          }
        }
      }
    }
  }
  if (declarationToRun instanceof JetClass) {
    PsiClass delegate=LightClassUtil.INSTANCE$.getPsiClass((JetClassOrObject)declarationToRun);
    if (!isTestNGClass(delegate)) {
      return false;
    }
    return configure(configuration,location,context,project,delegate,null);
  }
  return false;
}
