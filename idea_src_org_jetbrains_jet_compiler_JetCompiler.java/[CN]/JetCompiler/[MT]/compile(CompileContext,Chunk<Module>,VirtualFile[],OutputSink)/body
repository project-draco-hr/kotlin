{
  Map<Module,ModuleCompileState> moduleMap=new HashMap<Module,ModuleCompileState>();
  for (  VirtualFile virtualFile : virtualFiles) {
    Module module=compileContext.getModuleByFile(virtualFile);
    ModuleCompileState state=moduleMap.get(module);
    if (state == null) {
      state=new ModuleCompileState(compileContext,module,outputSink);
      moduleMap.put(module,state);
    }
    state.compile(virtualFile);
  }
  for (  ModuleCompileState state : moduleMap.values()) {
    state.done();
  }
}
