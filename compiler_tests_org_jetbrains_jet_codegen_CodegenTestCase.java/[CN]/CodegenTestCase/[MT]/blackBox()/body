{
  GenerationState state=generateClassesInFileGetState();
  GeneratedClassLoader loader=createClassLoader(state.getFactory());
  String r;
  try {
    if (myFiles.isScript()) {
      String scriptClassName=ScriptNameUtil.classNameForScript(myFiles.getPsiFile());
      Class<?> scriptClass=loader.loadClass(scriptClassName);
      Constructor constructor=getConstructor(scriptClass,state.getScriptConstructorMethod());
      scriptInstance=constructor.newInstance(myFiles.getScriptParameterValues().toArray());
      assertFalse("expecting at least one expectation",myFiles.getExpectedValues().isEmpty());
      for (      Pair<String,String> nameValue : myFiles.getExpectedValues()) {
        String fieldName=nameValue.first;
        String expectedValue=nameValue.second;
        if (expectedValue.equals("<nofield>")) {
          try {
            scriptClass.getDeclaredField(fieldName);
            fail("must have no field " + fieldName);
          }
 catch (          NoSuchFieldException e) {
            continue;
          }
        }
        Field field=scriptClass.getDeclaredField(fieldName);
        field.setAccessible(true);
        Object result=field.get(scriptInstance);
        String resultString=result != null ? result.toString() : "null";
        assertEquals("comparing field " + fieldName,expectedValue,resultString);
      }
    }
 else {
      String fqName=NamespaceCodegen.getJVMClassNameForKotlinNs(JetPsiUtil.getFQName(myFiles.getPsiFiles().get(0))).getFqName().getFqName();
      Class<?> namespaceClass=loader.loadClass(fqName);
      Method method=namespaceClass.getMethod("box");
      r=(String)method.invoke(null);
      assertEquals("OK",r);
    }
  }
 catch (  Error e) {
    System.out.println(generateToText());
    throw e;
  }
catch (  Throwable e) {
    System.out.println(generateToText());
    throw new RuntimeException(e);
  }
 finally {
    loader.dispose();
  }
}
