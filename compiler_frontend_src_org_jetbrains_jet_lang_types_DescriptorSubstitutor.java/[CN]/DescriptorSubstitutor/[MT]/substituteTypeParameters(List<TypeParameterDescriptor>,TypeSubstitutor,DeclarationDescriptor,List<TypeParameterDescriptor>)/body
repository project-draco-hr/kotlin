{
  final Map<TypeConstructor,TypeProjection> mutableSubstitution=Maps.newHashMap();
  TypeSubstitutor substitutor=TypeSubstitutor.create(new TypeSubstitutor.TypeSubstitution(){
    @Override public TypeProjection get(    TypeConstructor key){
      if (originalSubstitutor.inRange(key)) {
        return originalSubstitutor.getSubstitution().get(key);
      }
      return mutableSubstitution.get(key);
    }
    @Override public boolean isEmpty(){
      return originalSubstitutor.isEmpty() && mutableSubstitution.isEmpty();
    }
  }
);
  for (  TypeParameterDescriptor descriptor : typeParameters) {
    TypeParameterDescriptor substituted=TypeParameterDescriptor.createForFurtherModification(newContainingDeclaration,descriptor.getAnnotations(),descriptor.getVariance(),descriptor.getName(),descriptor.getIndex());
    mutableSubstitution.put(descriptor.getTypeConstructor(),new TypeProjection(substituted.getDefaultType()));
    for (    JetType upperBound : descriptor.getUpperBounds()) {
      substituted.getUpperBounds().add(substitutor.substitute(upperBound,Variance.INVARIANT));
    }
    result.add(substituted);
  }
  return substitutor;
}
