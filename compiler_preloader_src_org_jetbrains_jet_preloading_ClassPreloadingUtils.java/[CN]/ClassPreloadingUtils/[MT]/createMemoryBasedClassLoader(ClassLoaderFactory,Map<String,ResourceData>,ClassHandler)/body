{
  return new ClassLoader(null){
    private final ClassLoader parent=parentFactory == null ? null : parentFactory.create(this);
    @Override public Class<?> loadClass(    String name) throws ClassNotFoundException {
      Class<?> aClass=super.loadClass(name);
      if (aClass == null) {
        if (parent == null) {
          throw new ClassNotFoundException("Class not available in preloader: " + name);
        }
        return parent.loadClass(name);
      }
      return aClass;
    }
    @Override protected Class<?> findClass(    String name) throws ClassNotFoundException {
      String internalName=name.replace('.','/').concat(".class");
      ResourceData resourceData=preloadedResources.get(internalName);
      if (resourceData == null)       return null;
      int sizeInBytes=resourceData.bytes.length;
      if (handler != null) {
        handler.beforeDefineClass(name,sizeInBytes);
      }
      Class<?> definedClass=defineClass(name,resourceData.bytes,0,sizeInBytes);
      if (handler != null) {
        handler.afterDefineClass(name);
      }
      return definedClass;
    }
    @Override public URL getResource(    String name){
      URL resource=super.getResource(name);
      if (resource == null && parent != null) {
        return parent.getResource(name);
      }
      return resource;
    }
    @Override protected URL findResource(    String name){
      ResourceData resourceData=preloadedResources.get(name);
      if (resourceData == null)       return null;
      return resourceData.getURL();
    }
    @Override public Enumeration<URL> getResources(    String name) throws IOException {
      Enumeration<URL> resources=super.getResources(name);
      if (!resources.hasMoreElements() && parent != null) {
        return parent.getResources(name);
      }
      return resources;
    }
    @Override protected Enumeration<URL> findResources(    String name) throws IOException {
      URL resource=findResource(name);
      if (resource == null) {
        return new CompoundEnumeration<URL>(new Enumeration[0]);
      }
      return Collections.enumeration(Collections.singletonList(resource));
    }
  }
;
}
