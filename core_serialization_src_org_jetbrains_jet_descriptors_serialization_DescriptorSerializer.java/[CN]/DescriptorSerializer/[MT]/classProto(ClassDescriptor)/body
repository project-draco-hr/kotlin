{
  ProtoBuf.Class.Builder builder=ProtoBuf.Class.newBuilder();
  int flags=Flags.getClassFlags(hasAnnotations(classDescriptor),classDescriptor.getVisibility(),classDescriptor.getModality(),classDescriptor.getKind(),classDescriptor.isInner());
  builder.setFlags(flags);
  builder.setFqName(getClassId(classDescriptor));
  DescriptorSerializer local=createChildSerializer();
  for (  TypeParameterDescriptor typeParameterDescriptor : classDescriptor.getTypeConstructor().getParameters()) {
    builder.addTypeParameter(local.typeParameter(typeParameterDescriptor));
  }
  if (!KotlinBuiltIns.getInstance().isSpecialClassWithNoSupertypes(classDescriptor)) {
    for (    JetType supertype : classDescriptor.getTypeConstructor().getSupertypes()) {
      builder.addSupertype(local.type(supertype));
    }
  }
  ConstructorDescriptor primaryConstructor=classDescriptor.getUnsubstitutedPrimaryConstructor();
  if (primaryConstructor != null) {
    if (DescriptorFactory.isDefaultPrimaryConstructor(primaryConstructor)) {
      builder.setPrimaryConstructor(ProtoBuf.Class.PrimaryConstructor.getDefaultInstance());
    }
 else {
      ProtoBuf.Class.PrimaryConstructor.Builder constructorBuilder=ProtoBuf.Class.PrimaryConstructor.newBuilder();
      constructorBuilder.setData(local.callableProto(primaryConstructor));
      builder.setPrimaryConstructor(constructorBuilder);
    }
  }
  for (  DeclarationDescriptor descriptor : sort(classDescriptor.getDefaultType().getMemberScope().getAllDescriptors())) {
    if (descriptor instanceof CallableMemberDescriptor) {
      CallableMemberDescriptor member=(CallableMemberDescriptor)descriptor;
      if (member.getKind() == CallableMemberDescriptor.Kind.FAKE_OVERRIDE)       continue;
      builder.addMember(local.callableProto(member));
    }
  }
  Collection<DeclarationDescriptor> nestedClasses=classDescriptor.getUnsubstitutedInnerClassesScope().getAllDescriptors();
  for (  DeclarationDescriptor descriptor : sort(nestedClasses)) {
    if (!isEnumEntry(descriptor)) {
      builder.addNestedClassName(nameTable.getSimpleNameIndex(descriptor.getName()));
    }
  }
  ClassDescriptor classObject=classDescriptor.getClassObjectDescriptor();
  if (classObject != null) {
    builder.setClassObject(classObjectProto(classObject));
  }
  if (classDescriptor.getKind() == ClassKind.ENUM_CLASS) {
    for (    DeclarationDescriptor descriptor : nestedClasses) {
      if (isEnumEntry(descriptor)) {
        builder.addEnumEntry(nameTable.getSimpleNameIndex(descriptor.getName()));
      }
    }
  }
  return builder;
}
