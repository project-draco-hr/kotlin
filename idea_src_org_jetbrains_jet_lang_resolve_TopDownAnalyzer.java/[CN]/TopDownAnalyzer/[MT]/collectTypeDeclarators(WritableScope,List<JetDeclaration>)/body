{
  for (  JetDeclaration declaration : declarations) {
    declaration.accept(new JetVisitor(){
      @Override public void visitClass(      JetClass klass){
        WritableScope classScope=processClass(declaringScope,klass);
        collectTypeDeclarators(classScope,klass.getDeclarations());
      }
      @Override public void visitNamespace(      JetNamespace namespace){
        List<JetImportDirective> importDirectives=namespace.getImportDirectives();
        String name=namespace.getName();
        NamespaceDescriptor namespaceDescriptor=declaringScope.getDeclaredNamespace(name);
        if (namespaceDescriptor == null) {
          namespaceDescriptor=new NamespaceDescriptor(declaringScope.getContainingDeclaration(),Collections.<Attribute>emptyList(),name);
          declaringScope.addNamespace(namespaceDescriptor);
          trace.recordDeclarationResolution(namespace,namespaceDescriptor);
        }
        WritableScope namespaceScope=semanticServices.createWritableScope(declaringScope,namespaceDescriptor);
        namespaceScopes.put(namespace,namespaceScope);
        for (        JetImportDirective importDirective : importDirectives) {
          if (importDirective.isAbsoluteInRootNamespace()) {
            throw new UnsupportedOperationException();
          }
          if (importDirective.isAllUnder()) {
            JetExpression importedReference=importDirective.getImportedReference();
            JetType type=semanticServices.getTypeInferrer(trace).getType(namespaceScope,importedReference,false);
            if (type != null) {
              namespaceScope.importScope(type.getMemberScope());
            }
          }
 else {
            throw new UnsupportedOperationException();
          }
        }
        collectTypeDeclarators(namespaceScope,namespace.getDeclarations());
      }
      @Override public void visitTypedef(      JetTypedef typedef){
        processTypeDef(typedef);
      }
      @Override public void visitDeclaration(      JetDeclaration dcl){
        throw new UnsupportedOperationException();
      }
    }
);
  }
}
