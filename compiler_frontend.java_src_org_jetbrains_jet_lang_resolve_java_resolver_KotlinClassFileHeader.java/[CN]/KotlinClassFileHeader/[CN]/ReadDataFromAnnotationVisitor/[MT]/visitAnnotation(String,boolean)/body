{
  HeaderType headerTypeByAnnotation=HeaderType.byDescriptor(desc);
  if (headerTypeByAnnotation == HeaderType.NONE) {
    return null;
  }
  if (headerTypeByAnnotation.isValidAnnotation() && type.isValidAnnotation()) {
    throw new IllegalStateException("Both " + type.correspondingAnnotation + " and "+ headerTypeByAnnotation.correspondingAnnotation+ " present!");
  }
  if (!type.isValidAnnotation()) {
    type=headerTypeByAnnotation;
  }
  if (!headerTypeByAnnotation.isValidAnnotation()) {
    return null;
  }
  return new AnnotationVisitor(Opcodes.ASM4){
    @Override public void visit(    String name,    Object value){
      if (name.equals(JvmAnnotationNames.ABI_VERSION_FIELD_NAME)) {
        version=(Integer)value;
      }
 else       if (isAbiVersionCompatible(version)) {
        throw new IllegalStateException("Unexpected argument " + name + " for annotation "+ desc);
      }
    }
    @Override public AnnotationVisitor visitArray(    String name){
      if (name.equals(JvmAnnotationNames.DATA_FIELD_NAME)) {
        return stringArrayVisitor();
      }
 else       if (isAbiVersionCompatible(version)) {
        throw new IllegalStateException("Unexpected array argument " + name + " for annotation "+ desc);
      }
      return super.visitArray(name);
    }
    @NotNull private AnnotationVisitor stringArrayVisitor(){
      final List<String> strings=new ArrayList<String>(1);
      return new AnnotationVisitor(Opcodes.ASM4){
        @Override public void visit(        String name,        Object value){
          if (!(value instanceof String)) {
            throw new IllegalStateException("Unexpected argument value: " + value);
          }
          strings.add((String)value);
        }
        @Override public void visitEnd(){
          annotationData=strings.toArray(new String[strings.size()]);
        }
      }
;
    }
  }
;
}
