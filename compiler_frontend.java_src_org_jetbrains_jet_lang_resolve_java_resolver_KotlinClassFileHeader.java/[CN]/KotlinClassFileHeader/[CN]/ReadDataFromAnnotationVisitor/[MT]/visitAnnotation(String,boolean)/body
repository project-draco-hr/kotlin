{
  for (  HeaderType headerType : HeaderType.values()) {
    JvmClassName annotation=headerType.correspondingAnnotation;
    if (annotation == null) {
      continue;
    }
    if (desc.equals(annotation.getDescriptor())) {
      if (type != HeaderType.NONE) {
        throw new IllegalStateException("Both " + type.correspondingAnnotation + " and "+ headerType.correspondingAnnotation+ " present!");
      }
      type=headerType;
    }
  }
  if (type == HeaderType.NONE) {
    return null;
  }
  return new AnnotationVisitor(Opcodes.ASM4){
    @Override public void visit(    String name,    Object value){
      if (name.equals(JvmAnnotationNames.ABI_VERSION_FIELD_NAME)) {
        version=(Integer)value;
      }
 else       if (AbiVersionUtil.isAbiVersionCompatible(version)) {
        throw new IllegalStateException("Unexpected argument " + name + " for annotation "+ desc);
      }
    }
    @Override public AnnotationVisitor visitArray(    String name){
      if (name.equals(JvmAnnotationNames.DATA_FIELD_NAME)) {
        return stringArrayVisitor();
      }
 else       if (AbiVersionUtil.isAbiVersionCompatible(version)) {
        throw new IllegalStateException("Unexpected array argument " + name + " for annotation "+ desc);
      }
      return super.visitArray(name);
    }
    @NotNull private AnnotationVisitor stringArrayVisitor(){
      final List<String> strings=new ArrayList<String>(1);
      return new AnnotationVisitor(Opcodes.ASM4){
        @Override public void visit(        String name,        Object value){
          if (!(value instanceof String)) {
            throw new IllegalStateException("Unexpected argument value: " + value);
          }
          strings.add((String)value);
        }
        @Override public void visitEnd(){
          annotationData=strings.toArray(new String[strings.size()]);
        }
      }
;
    }
  }
;
}
