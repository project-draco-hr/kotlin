{
  JetParameter declaredParameter=declaredValueParameters.get(index);
  JetTypeReference typeReference=declaredParameter.getTypeReference();
  JetType expectedType;
  if (expectedValueParameters != null && index < expectedValueParameters.size()) {
    expectedType=expectedValueParameters.get(index).getType();
  }
 else {
    expectedType=null;
  }
  JetType type;
  if (typeReference != null) {
    type=components.expressionTypingServices.getTypeResolver().resolveType(context.scope,typeReference,context.trace,true);
    if (expectedType != null) {
      if (!JetTypeChecker.DEFAULT.isSubtypeOf(expectedType,type)) {
        context.trace.report(EXPECTED_PARAMETER_TYPE_MISMATCH.on(declaredParameter,expectedType));
      }
    }
  }
 else {
    boolean containsUninferredParameter=TypeUtils.containsSpecialType(expectedType,new Function1<JetType,Boolean>(){
      @Override public Boolean invoke(      JetType type){
        return TypeUtils.isDontCarePlaceholder(type) || ErrorUtils.isUninferredParameter(type);
      }
    }
);
    if (expectedType == null || containsUninferredParameter) {
      context.trace.report(CANNOT_INFER_PARAMETER_TYPE.on(declaredParameter));
    }
    if (expectedType != null) {
      type=expectedType;
    }
 else {
      type=CANT_INFER_LAMBDA_PARAM_TYPE;
    }
  }
  return components.expressionTypingServices.getDescriptorResolver().resolveValueParameterDescriptorWithAnnotationArguments(context.scope,functionDescriptor,declaredParameter,index,type,context.trace);
}
