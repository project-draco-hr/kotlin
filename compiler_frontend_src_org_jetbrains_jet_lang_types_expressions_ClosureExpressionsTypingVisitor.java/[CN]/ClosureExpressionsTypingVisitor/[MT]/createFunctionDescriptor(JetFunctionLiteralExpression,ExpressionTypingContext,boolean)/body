{
  JetFunctionLiteral functionLiteral=expression.getFunctionLiteral();
  JetTypeReference receiverTypeRef=functionLiteral.getReceiverTypeRef();
  final JetType receiverType;
  if (receiverTypeRef != null) {
    receiverType=context.getTypeResolver().resolveType(context.scope,receiverTypeRef);
  }
 else {
    ReceiverDescriptor implicitReceiver=context.scope.getImplicitReceiver();
    receiverType=implicitReceiver.exists() ? implicitReceiver.getType() : null;
  }
  FunctionDescriptorImpl functionDescriptor=new FunctionDescriptorImpl(context.scope.getContainingDeclaration(),Collections.<AnnotationDescriptor>emptyList(),"<anonymous>");
  List<ValueParameterDescriptor> valueParameterDescriptors=createValueParameterDescriptors(context,functionLiteral,functionDescriptor,functionTypeExpected);
  JetType effectiveReceiverType;
  if (receiverTypeRef == null) {
    if (functionTypeExpected) {
      effectiveReceiverType=JetStandardClasses.getReceiverType(context.expectedType);
    }
 else {
      effectiveReceiverType=null;
    }
  }
 else {
    effectiveReceiverType=receiverType;
  }
  functionDescriptor.initialize(effectiveReceiverType,NO_RECEIVER,Collections.<TypeParameterDescriptor>emptyList(),valueParameterDescriptors,null,Modality.FINAL,Visibility.LOCAL);
  context.trace.record(BindingContext.FUNCTION,expression,functionDescriptor);
  return functionDescriptor;
}
