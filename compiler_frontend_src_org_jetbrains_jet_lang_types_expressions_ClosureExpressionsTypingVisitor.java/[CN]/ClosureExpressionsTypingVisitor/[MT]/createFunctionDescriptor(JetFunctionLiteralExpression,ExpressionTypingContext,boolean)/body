{
  JetFunctionLiteral functionLiteral=expression.getFunctionLiteral();
  JetTypeReference receiverTypeRef=functionLiteral.getReceiverTypeRef();
  SimpleFunctionDescriptorImpl functionDescriptor=new SimpleFunctionDescriptorImpl(context.scope.getContainingDeclaration(),Collections.<AnnotationDescriptor>emptyList(),Name.special("<anonymous>"),CallableMemberDescriptor.Kind.DECLARATION);
  List<ValueParameterDescriptor> valueParameterDescriptors=createValueParameterDescriptors(context,functionLiteral,functionDescriptor,functionTypeExpected);
  JetType effectiveReceiverType;
  if (receiverTypeRef == null) {
    if (functionTypeExpected) {
      effectiveReceiverType=KotlinBuiltIns.getInstance().getReceiverType(context.expectedType);
    }
 else {
      effectiveReceiverType=null;
    }
  }
 else {
    effectiveReceiverType=context.expressionTypingServices.getTypeResolver().resolveType(context.scope,receiverTypeRef,context.trace,true);
  }
  functionDescriptor.initialize(effectiveReceiverType,ReceiverParameterDescriptor.NO_RECEIVER_PARAMETER,Collections.<TypeParameterDescriptorImpl>emptyList(),valueParameterDescriptors,null,Modality.FINAL,Visibilities.LOCAL,false);
  context.trace.record(BindingContext.FUNCTION,functionLiteral,functionDescriptor);
  BindingContextUtils.recordFunctionDeclarationToDescriptor(context.trace,functionLiteral,functionDescriptor);
  return functionDescriptor;
}
