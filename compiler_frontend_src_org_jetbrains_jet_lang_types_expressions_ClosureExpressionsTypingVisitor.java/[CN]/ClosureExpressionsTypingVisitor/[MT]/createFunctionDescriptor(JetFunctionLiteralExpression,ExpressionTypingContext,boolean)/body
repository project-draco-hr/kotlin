{
  JetFunctionLiteral functionLiteral=expression.getFunctionLiteral();
  JetTypeReference receiverTypeRef=functionLiteral.getReceiverTypeRef();
  AnonymousFunctionDescriptor functionDescriptor=new AnonymousFunctionDescriptor(context.scope.getContainingDeclaration(),Annotations.EMPTY,CallableMemberDescriptor.Kind.DECLARATION,toSourceElement(functionLiteral));
  List<ValueParameterDescriptor> valueParameterDescriptors=createValueParameterDescriptors(context,functionLiteral,functionDescriptor,functionTypeExpected);
  JetType effectiveReceiverType;
  if (receiverTypeRef == null) {
    if (functionTypeExpected) {
      effectiveReceiverType=KotlinBuiltIns.getInstance().getReceiverType(context.expectedType);
    }
 else {
      effectiveReceiverType=null;
    }
  }
 else {
    effectiveReceiverType=components.expressionTypingServices.getTypeResolver().resolveType(context.scope,receiverTypeRef,context.trace,true);
  }
  functionDescriptor.initialize(effectiveReceiverType,ReceiverParameterDescriptor.NO_RECEIVER_PARAMETER,Collections.<TypeParameterDescriptorImpl>emptyList(),valueParameterDescriptors,null,Modality.FINAL,Visibilities.LOCAL);
  BindingContextUtils.recordFunctionDeclarationToDescriptor(context.trace,functionLiteral,functionDescriptor);
  return functionDescriptor;
}
