{
  String javaHome=System.getenv("JAVA_HOME");
  File rtJar=null;
  if (javaHome == null) {
    ClassLoader systemClassLoader=ClassLoader.getSystemClassLoader();
    if (systemClassLoader instanceof URLClassLoader) {
      URLClassLoader loader=(URLClassLoader)systemClassLoader;
      for (      URL url : loader.getURLs()) {
        if ("file".equals(url.getProtocol())) {
          if (url.getFile().endsWith("/lib/rt.jar")) {
            rtJar=new File(url.getFile());
            break;
          }
          if (url.getFile().endsWith("/Classes/classes.jar")) {
            rtJar=new File(url.getFile()).getAbsoluteFile();
            break;
          }
        }
      }
    }
    if (rtJar == null) {
      System.out.println("JAVA_HOME environment variable needs to be defined");
      return null;
    }
  }
 else {
    rtJar=findRtJar(javaHome);
  }
  if (rtJar == null || !rtJar.exists()) {
    System.out.print("No rt.jar found under JAVA_HOME=" + javaHome);
    return null;
  }
  return rtJar;
}
