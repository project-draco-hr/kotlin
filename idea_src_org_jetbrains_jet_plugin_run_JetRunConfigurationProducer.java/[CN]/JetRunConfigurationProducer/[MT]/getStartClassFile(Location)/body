{
  Module module=location.getModule();
  if (module == null)   return null;
  if (ProjectStructureUtil.isJsKotlinModule(module))   return null;
  PsiFile psiFile=location.getPsiElement().getContainingFile();
  if (!(psiFile instanceof JetFile && ProjectRootsUtil.isInProjectOrLibSource(psiFile)))   return null;
  JetFile jetFile=(JetFile)psiFile;
  final ResolveSessionForBodies session=ResolvePackage.getLazyResolveSession(jetFile);
  MainFunctionDetector mainFunctionDetector=new MainFunctionDetector(new NotNullFunction<JetNamedFunction,FunctionDescriptor>(){
    @NotNull @Override public FunctionDescriptor fun(    JetNamedFunction function){
      return (FunctionDescriptor)session.resolveToDescriptor(function);
    }
  }
);
  return mainFunctionDetector.hasMain(jetFile.getDeclarations()) ? jetFile : null;
}
