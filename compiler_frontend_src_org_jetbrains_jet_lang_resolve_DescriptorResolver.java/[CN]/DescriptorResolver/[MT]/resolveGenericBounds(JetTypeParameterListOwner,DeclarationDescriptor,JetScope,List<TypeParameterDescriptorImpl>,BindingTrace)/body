{
  List<UpperBoundCheckerTask> deferredUpperBoundCheckerTasks=Lists.newArrayList();
  List<JetTypeParameter> typeParameters=declaration.getTypeParameters();
  Map<Name,TypeParameterDescriptorImpl> parameterByName=Maps.newHashMap();
  for (int i=0; i < typeParameters.size(); i++) {
    JetTypeParameter jetTypeParameter=typeParameters.get(i);
    TypeParameterDescriptorImpl typeParameterDescriptor=parameters.get(i);
    parameterByName.put(typeParameterDescriptor.getName(),typeParameterDescriptor);
    JetTypeReference extendsBound=jetTypeParameter.getExtendsBound();
    if (extendsBound != null) {
      JetType type=typeResolver.resolveType(scope,extendsBound,trace,false);
      typeParameterDescriptor.addUpperBound(type);
      deferredUpperBoundCheckerTasks.add(new UpperBoundCheckerTask(extendsBound,type,false));
    }
  }
  for (  JetTypeConstraint constraint : declaration.getTypeConstraints()) {
    reportUnsupportedClassObjectConstraint(trace,constraint);
    JetSimpleNameExpression subjectTypeParameterName=constraint.getSubjectTypeParameterName();
    if (subjectTypeParameterName == null) {
      continue;
    }
    Name referencedName=subjectTypeParameterName.getReferencedNameAsName();
    TypeParameterDescriptorImpl typeParameterDescriptor=parameterByName.get(referencedName);
    JetTypeReference boundTypeReference=constraint.getBoundTypeReference();
    JetType bound=null;
    if (boundTypeReference != null) {
      bound=typeResolver.resolveType(scope,boundTypeReference,trace,false);
      deferredUpperBoundCheckerTasks.add(new UpperBoundCheckerTask(boundTypeReference,bound,constraint.isClassObjectConstraint()));
    }
    if (typeParameterDescriptor != null) {
      trace.record(BindingContext.REFERENCE_TARGET,subjectTypeParameterName,typeParameterDescriptor);
      if (bound != null) {
        if (constraint.isClassObjectConstraint()) {
        }
 else {
          typeParameterDescriptor.addUpperBound(bound);
        }
      }
    }
  }
  for (  TypeParameterDescriptorImpl parameter : parameters) {
    parameter.addDefaultUpperBound();
    parameter.setInitialized();
    if (KotlinBuiltIns.getInstance().isNothing(parameter.getUpperBoundsAsType())) {
      PsiElement nameIdentifier=typeParameters.get(parameter.getIndex()).getNameIdentifier();
      if (nameIdentifier != null) {
        trace.report(CONFLICTING_UPPER_BOUNDS.on(nameIdentifier,parameter));
      }
    }
    JetType classObjectType=parameter.getClassObjectType();
    if (classObjectType != null && KotlinBuiltIns.getInstance().isNothing(classObjectType)) {
      PsiElement nameIdentifier=typeParameters.get(parameter.getIndex()).getNameIdentifier();
      if (nameIdentifier != null) {
        trace.report(CONFLICTING_CLASS_OBJECT_UPPER_BOUNDS.on(nameIdentifier,parameter));
      }
    }
  }
  if (!(declaration instanceof JetClass)) {
    for (    UpperBoundCheckerTask checkerTask : deferredUpperBoundCheckerTasks) {
      checkUpperBoundType(checkerTask.upperBound,checkerTask.upperBoundType,checkerTask.isClassObjectConstraint,trace);
    }
    checkNamesInConstraints(declaration,descriptor,scope,trace);
  }
}
