{
  JetTypeReference propertyTypeRef=variable.getTypeRef();
  if (propertyTypeRef == null) {
    final JetExpression initializer=variable.getInitializer();
    if (initializer == null) {
      if (!notLocal) {
        trace.report(VARIABLE_WITH_NO_TYPE_NO_INITIALIZER.on(variable));
      }
      return ErrorUtils.createErrorType("No type, no body");
    }
 else {
      LazyValue<JetType> lazyValue=new LazyValueWithDefault<JetType>(ErrorUtils.createErrorType("Recursive dependency")){
        @Override protected JetType compute(){
          return expressionTypingServices.safeGetType(scope,initializer,TypeUtils.NO_EXPECTED_TYPE,dataFlowInfo,trace);
        }
      }
;
      if (notLocal) {
        return DeferredType.create(trace,lazyValue);
      }
 else {
        return lazyValue.get();
      }
    }
  }
 else {
    return typeResolver.resolveType(scope,propertyTypeRef,trace,true);
  }
}
