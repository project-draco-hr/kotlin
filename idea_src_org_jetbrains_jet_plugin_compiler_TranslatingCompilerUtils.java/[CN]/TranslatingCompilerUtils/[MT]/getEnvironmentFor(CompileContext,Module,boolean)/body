{
  VirtualFile mainOutput=compileContext.getModuleOutputDirectory(module);
  VirtualFile outputDirectoryForTests=compileContext.getModuleOutputDirectoryForTests(module);
  File outputDir=tests ? toNullableIoFile(outputDirectoryForTests) : toNullableIoFile(mainOutput);
  KotlinPaths kotlinPaths=ApplicationManager.getApplication().isUnitTestMode() ? PathUtil.getKotlinPathsForDistDirectory() : PathUtil.getKotlinPathsForIdeaPlugin();
  return CompilerEnvironment.getEnvironmentFor(kotlinPaths,outputDir);
}
