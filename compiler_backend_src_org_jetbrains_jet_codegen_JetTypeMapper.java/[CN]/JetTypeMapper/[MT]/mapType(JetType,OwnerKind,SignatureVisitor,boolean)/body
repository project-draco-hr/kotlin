{
  Type known=knowTypes.get(jetType);
  if (known != null) {
    return mapKnownAsmType(jetType,known,signatureVisitor,boxPrimitive);
  }
  DeclarationDescriptor descriptor=jetType.getConstructor().getDeclarationDescriptor();
  if (standardLibrary.getArray().equals(descriptor)) {
    if (jetType.getArguments().size() != 1) {
      throw new UnsupportedOperationException("arrays must have one type argument");
    }
    JetType memberType=jetType.getArguments().get(0).getType();
    if (signatureVisitor != null) {
      SignatureVisitor arraySignatureVisitor=signatureVisitor.visitArrayType();
      mapType(memberType,kind,arraySignatureVisitor,true);
    }
    if (!isGenericsArray(jetType)) {
      return Type.getType("[" + boxType(mapType(memberType,kind)).getDescriptor());
    }
 else {
      return ARRAY_GENERIC_TYPE;
    }
  }
  if (JetStandardClasses.getAny().equals(descriptor)) {
    if (signatureVisitor != null) {
      visitAsmType(signatureVisitor,TYPE_OBJECT);
    }
    return TYPE_OBJECT;
  }
  if (descriptor instanceof ClassDescriptor) {
    String name=getFQName(descriptor);
    Type asmType=Type.getObjectType(name + (kind == OwnerKind.TRAIT_IMPL ? "$$TImpl" : ""));
    if (signatureVisitor != null) {
      signatureVisitor.visitClassType(asmType.getInternalName());
      for (      TypeProjection proj : jetType.getArguments()) {
        SignatureVisitor argumentSignatureVisitor=signatureVisitor.visitTypeArgument('=');
        mapType(proj.getType(),kind,argumentSignatureVisitor,true);
      }
      signatureVisitor.visitEnd();
    }
    return asmType;
  }
  if (descriptor instanceof TypeParameterDescriptor) {
    if (signatureVisitor != null) {
      TypeParameterDescriptor typeParameterDescriptor=(TypeParameterDescriptor)jetType.getConstructor().getDeclarationDescriptor();
      signatureVisitor.visitTypeVariable(typeParameterDescriptor.getName());
    }
    return mapType(((TypeParameterDescriptor)descriptor).getUpperBoundsAsType(),kind);
  }
  throw new UnsupportedOperationException("Unknown type " + jetType);
}
