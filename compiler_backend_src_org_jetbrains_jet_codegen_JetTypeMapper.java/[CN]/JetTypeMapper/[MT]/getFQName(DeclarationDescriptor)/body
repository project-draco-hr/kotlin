{
  descriptor=descriptor.getOriginal();
  if (descriptor instanceof FunctionDescriptor) {
    return getFQName(descriptor.getContainingDeclaration());
  }
  if (descriptor.getContainingDeclaration() instanceof ModuleDescriptor) {
    return "";
  }
  if (descriptor instanceof ModuleDescriptor) {
    throw new IllegalStateException("missed something");
  }
  DeclarationDescriptor container=descriptor.getContainingDeclaration();
  Name name=descriptor.getName();
  if (JetPsiUtil.NO_NAME_PROVIDED.equals(name)) {
    return closureAnnotator.classNameForAnonymousClass((JetElement)BindingContextUtils.descriptorToDeclaration(bindingContext,descriptor)).getInternalName();
  }
  if (name.getName().contains("/"))   return name.getName();
  if (container != null) {
    String baseName=getFQName(container);
    if (!baseName.isEmpty()) {
      return baseName + (container instanceof NamespaceDescriptor ? "/" : "$") + name;
    }
  }
  return name.getName();
}
