{
  descriptor=descriptor.getOriginal();
  if (descriptor instanceof FunctionDescriptor) {
    return getFQName(descriptor.getContainingDeclaration());
  }
  DeclarationDescriptor container=descriptor.getContainingDeclaration();
  String name=descriptor.getName();
  if (JetPsiUtil.NO_NAME_PROVIDED.equals(name)) {
    return closureAnnotator.classNameForAnonymousClass((JetElement)bindingContext.get(BindingContext.DESCRIPTOR_TO_DECLARATION,descriptor));
  }
  if (name.contains("/"))   return name;
  if (container != null) {
    if (container.getContainingDeclaration() instanceof ModuleDescriptor) {
      return name;
    }
    if (container instanceof ModuleDescriptor) {
      throw new IllegalStateException("missed something");
    }
    String baseName=getFQName(container);
    if (!baseName.isEmpty()) {
      return baseName + (container instanceof NamespaceDescriptor ? "/" : "$") + name;
    }
  }
  return name;
}
