{
  if (expression instanceof JetObjectLiteralExpression) {
    JetObjectLiteralExpression jetObjectLiteralExpression=(JetObjectLiteralExpression)expression;
    expression=jetObjectLiteralExpression.getObjectDeclaration();
  }
  if (expression instanceof JetObjectDeclaration) {
    DeclarationDescriptor declarationDescriptor=bindingContext.get(BindingContext.DECLARATION_TO_DESCRIPTOR,expression);
    return getFQName(declarationDescriptor);
  }
  String name=classNamesForAnonymousClasses.get(expression);
  if (name != null) {
    return name;
  }
  @SuppressWarnings("unchecked") JetNamedDeclaration container=PsiTreeUtil.getParentOfType(expression,JetNamespace.class,JetClass.class,JetObjectDeclaration.class);
  String baseName;
  if (container instanceof JetNamespace) {
    baseName=NamespaceCodegen.getJVMClassName(CodegenUtil.getFQName(((JetNamespace)container)));
  }
 else {
    ClassDescriptor aClass=bindingContext.get(BindingContext.CLASS,container);
    baseName=mapType(aClass.getDefaultType(),OwnerKind.IMPLEMENTATION).getInternalName();
  }
  Integer count=anonymousSubclassesCount.get(baseName);
  if (count == null)   count=0;
  anonymousSubclassesCount.put(baseName,count + 1);
  final String className=baseName + "$" + (count + 1);
  classNamesForAnonymousClasses.put(expression,className);
  return className;
}
