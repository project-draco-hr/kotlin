{
  String message=IdeErrorMessages.RENDERER.render(diagnostic);
  if (KotlinInternalMode.OBJECT$.getEnabled() || ApplicationManager.getApplication().isUnitTestMode()) {
    String factoryName=diagnostic.getFactory().getName();
    if (message.startsWith("<html>")) {
      message=String.format("<html>[%s] %s",factoryName,message.substring("<html>".length()));
    }
 else {
      message=String.format("[%s] %s",factoryName,message);
    }
  }
  if (!message.startsWith("<html>")) {
    message="<html><body>" + XmlStringUtil.escapeString(message) + "</body></html>";
  }
  return message;
}
