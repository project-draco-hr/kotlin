{
  JetType expectedReturnType=functionTypeExpected ? KotlinBuiltIns.getReturnTypeFromFunctionType(context.expectedType) : null;
  JetType returnType=computeUnsafeReturnType(expression,context,functionDescriptor,expectedReturnType);
  if (!expression.getFunctionLiteral().hasDeclaredReturnType() && functionTypeExpected) {
    if (KotlinBuiltIns.isUnit(expectedReturnType)) {
      return components.builtIns.getUnitType();
    }
  }
  return returnType == null ? CANT_INFER_LAMBDA_PARAM_TYPE : returnType;
}
