{
  for (  Module moduleBuilder : modules) {
    if (configuration.getEnvironment().getCompilerDependencies().getRuntimeJar() != null) {
      CompileEnvironmentUtil.addToClasspath(configuration.getEnvironment(),configuration.getEnvironment().getCompilerDependencies().getRuntimeJar());
    }
    ClassFileFactory moduleFactory=compileModule(configuration,moduleBuilder,directory);
    if (moduleFactory == null) {
      return false;
    }
    if (outputDir != null) {
      CompileEnvironmentUtil.writeToOutputDirectory(moduleFactory,outputDir);
    }
 else {
      String path=jarPath != null ? jarPath : new File(directory,moduleBuilder.getModuleName() + ".jar").getPath();
      FileOutputStream outputStream=null;
      try {
        outputStream=new FileOutputStream(path);
        CompileEnvironmentUtil.writeToJar(moduleFactory,outputStream,null,jarRuntime);
        outputStream.close();
      }
 catch (      FileNotFoundException e) {
        throw new CompileEnvironmentException("Invalid jar path " + path,e);
      }
catch (      IOException e) {
        throw ExceptionUtils.rethrow(e);
      }
 finally {
        try {
          outputStream.close();
        }
 catch (        Throwable e) {
        }
      }
    }
  }
  return true;
}
