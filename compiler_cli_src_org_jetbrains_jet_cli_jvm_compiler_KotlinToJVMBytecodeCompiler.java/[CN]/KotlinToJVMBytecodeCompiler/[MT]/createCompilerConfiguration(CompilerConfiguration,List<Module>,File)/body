{
  CompilerConfiguration configuration=base.copy();
  for (  Module module : chunk) {
    configuration.addAll(CommonConfigurationKeys.SOURCE_ROOTS_KEY,getAbsolutePaths(directory,module));
    for (    String classpathRoot : module.getClasspathRoots()) {
      configuration.add(JVMConfigurationKeys.CLASSPATH_KEY,new File(classpathRoot));
    }
    for (    String annotationsRoot : module.getAnnotationsRoots()) {
      configuration.add(JVMConfigurationKeys.ANNOTATIONS_PATH_KEY,new File(annotationsRoot));
    }
    configuration.add(JVMConfigurationKeys.MODULE_IDS,module.getModuleName());
  }
  Module anyModule=chunk.get(0);
  if (anyModule instanceof CompileEnvironmentUtil.DescriptionToModuleAdapter) {
    String incrementalCacheDir=((CompileEnvironmentUtil.DescriptionToModuleAdapter)anyModule).getIncrementalCacheDir();
    if (incrementalCacheDir != null) {
      configuration.put(JVMConfigurationKeys.INCREMENTAL_CACHE_BASE_DIR,new File(incrementalCacheDir));
    }
  }
  return configuration;
}
