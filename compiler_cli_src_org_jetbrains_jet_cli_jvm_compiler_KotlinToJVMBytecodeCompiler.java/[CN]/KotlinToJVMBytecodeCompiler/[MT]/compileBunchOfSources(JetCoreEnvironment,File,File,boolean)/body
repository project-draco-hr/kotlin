{
  GenerationState generationState=analyzeAndGenerate(environment);
  if (generationState == null) {
    return false;
  }
  FqName mainClass=findMainClass(generationState,environment.getSourceFiles());
  try {
    OutputDirector outputDirector=outputDir != null ? new SingleDirectoryDirector(outputDir) : null;
    writeOutput(environment.getConfiguration(),generationState.getFactory(),outputDirector,jar,includeRuntime,mainClass);
    return true;
  }
  finally {
    generationState.destroy();
  }
}
