{
  FqName mainClass=findMainClass(environment.getSourceFiles());
  GenerationState generationState=analyzeAndGenerate(environment);
  if (generationState == null) {
    return false;
  }
  try {
    CompileEnvironmentUtil.OutputDirector outputDirector=CompileEnvironmentUtil.singleDirectory(outputDir);
    writeOutput(environment.getConfiguration(),generationState.getFactory(),outputDirector,jar,includeRuntime,mainClass);
    return true;
  }
  finally {
    generationState.destroy();
  }
}
