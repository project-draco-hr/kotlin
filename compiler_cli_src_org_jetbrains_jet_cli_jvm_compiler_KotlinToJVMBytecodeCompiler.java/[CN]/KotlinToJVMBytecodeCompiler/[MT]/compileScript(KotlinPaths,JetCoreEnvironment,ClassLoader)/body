{
  GenerationState generationState=analyzeAndGenerate(environment);
  if (generationState == null) {
    return null;
  }
  GeneratedClassLoader classLoader=null;
  try {
    ClassFileFactory factory=generationState.getFactory();
    classLoader=new GeneratedClassLoader(factory,new URLClassLoader(new URL[]{paths.getRuntimePath().toURI().toURL()},parentLoader == null ? AllModules.class.getClassLoader() : parentLoader));
    JetFile scriptFile=environment.getSourceFiles().get(0);
    return classLoader.loadClass(ScriptNameUtil.classNameForScript(scriptFile));
  }
 catch (  Exception e) {
    throw new RuntimeException("Failed to evaluate script: " + e,e);
  }
 finally {
    if (classLoader != null) {
      classLoader.dispose();
    }
    generationState.destroy();
  }
}
