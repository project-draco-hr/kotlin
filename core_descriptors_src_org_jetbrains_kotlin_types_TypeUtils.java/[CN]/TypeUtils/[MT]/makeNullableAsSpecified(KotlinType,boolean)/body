{
  Flexibility flexibility=type.getCapability(Flexibility.class);
  if (flexibility != null) {
    return flexibility.makeNullableAsSpecified(nullable);
  }
  if (type instanceof AbstractTypeWithKnownNullability) {
    return makeNullableAsSpecified(((AbstractTypeWithKnownNullability)type).delegate,nullable);
  }
  if (!(type instanceof LazyType) && type.isMarkedNullable() == nullable) {
    return type;
  }
  return nullable ? new NullableType(type) : new NotNullType(type);
}
