{
  TopDownAnalysisParameters params=new TopDownAnalysisParameters(Predicates.<PsiFile>alwaysTrue(),false,false,Collections.<AnalyzerScriptParameter>emptyList());
  ModuleDescriptor module=new ModuleDescriptor(Name.special("<test module>"));
  InjectorForTopDownAnalyzerForJvm injector=new InjectorForTopDownAnalyzerForJvm(project,params,new BindingTraceContext(),module,compilerDependencies);
  List<JetFile> files=JetTestUtils.createTestFiles(testFileName,FileUtil.loadFile(new File(testFileName)),new JetTestUtils.TestFileFactory<JetFile>(){
    @Override public JetFile create(    String fileName,    String text){
      return JetPsiFactory.createFile(project,fileName,text);
    }
  }
);
  ModuleDescriptor lazyModule=new ModuleDescriptor(Name.special("<lazy module>"));
  ResolveSession session=new ResolveSession(project,lazyModule,injector.getJavaBridgeConfiguration(),new FileBasedDeclarationProviderFactory(files));
  injector.getTopDownAnalyzer().analyzeFiles(files,Collections.<AnalyzerScriptParameter>emptyList());
  Pair<NamespaceDescriptor,NamespaceDescriptor> namespacesToCompare=transform.fun(Pair.create(module,lazyModule));
  NamespaceComparator.compareNamespaces(namespacesToCompare.first,namespacesToCompare.second,true,new File(FileUtil.getNameWithoutExtension(testFileName) + ".txt"));
}
