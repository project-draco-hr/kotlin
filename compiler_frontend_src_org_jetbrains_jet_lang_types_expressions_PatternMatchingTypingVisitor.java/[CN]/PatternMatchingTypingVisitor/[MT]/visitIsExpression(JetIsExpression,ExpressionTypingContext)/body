{
  ExpressionTypingContext context=contextWithExpectedType.replaceExpectedType(NO_EXPECTED_TYPE).replaceContextDependency(INDEPENDENT);
  JetExpression leftHandSide=expression.getLeftHandSide();
  JetTypeInfo typeInfo=facade.safeGetTypeInfo(leftHandSide,context.replaceScope(context.scope));
  JetType knownType=typeInfo.getType();
  DataFlowInfo dataFlowInfo=typeInfo.getDataFlowInfo();
  if (expression.getTypeReference() != null) {
    DataFlowValue dataFlowValue=DataFlowValueFactory.createDataFlowValue(leftHandSide,knownType,context.trace.getBindingContext());
    DataFlowInfo conditionInfo=checkTypeForIs(context,knownType,expression.getTypeReference(),dataFlowValue).thenInfo;
    DataFlowInfo newDataFlowInfo=conditionInfo.and(dataFlowInfo);
    context.trace.record(BindingContext.DATAFLOW_INFO_AFTER_CONDITION,expression,newDataFlowInfo);
  }
  return DataFlowUtils.checkType(KotlinBuiltIns.getInstance().getBooleanType(),expression,contextWithExpectedType,dataFlowInfo);
}
