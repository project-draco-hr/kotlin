{
  Type blockType=typeMapper.mapType(scriptDescriptor.getScriptCodeDescriptor().getReturnType());
  PropertyDescriptor scriptResultProperty=scriptDescriptor.getScriptResultProperty();
  classBuilder.newField(JvmDeclarationOriginKt.OtherOrigin(scriptResultProperty),ACC_PUBLIC | ACC_FINAL,scriptResultProperty.getName().asString(),blockType.getDescriptor(),null,null);
  JvmMethodSignature jvmSignature=typeMapper.mapScriptSignature(scriptDescriptor,context.getEarlierScripts());
  MethodVisitor mv=classBuilder.newMethod(JvmDeclarationOriginKt.OtherOrigin(scriptDeclaration,scriptDescriptor.getClassDescriptor().getUnsubstitutedPrimaryConstructor()),ACC_PUBLIC,jvmSignature.getAsmMethod().getName(),jvmSignature.getAsmMethod().getDescriptor(),null,null);
  if (state.getClassBuilderMode() == ClassBuilderMode.FULL) {
    mv.visitCode();
    InstructionAdapter iv=new InstructionAdapter(mv);
    Type classType=typeMapper.mapType(classDescriptorForScript);
    iv.load(0,classType);
    iv.invokespecial("java/lang/Object","<init>","()V",false);
    iv.load(0,classType);
    FrameMap frameMap=new FrameMap();
    frameMap.enterTemp(OBJECT_TYPE);
    for (    ScriptDescriptor importedScript : context.getEarlierScripts()) {
      frameMap.enter(importedScript,OBJECT_TYPE);
    }
    Type[] argTypes=jvmSignature.getAsmMethod().getArgumentTypes();
    int add=0;
    for (int i=0; i < scriptDescriptor.getScriptCodeDescriptor().getValueParameters().size(); i++) {
      ValueParameterDescriptor parameter=scriptDescriptor.getScriptCodeDescriptor().getValueParameters().get(i);
      frameMap.enter(parameter,argTypes[i + add]);
    }
    int offset=1;
    for (    ScriptDescriptor earlierScript : context.getEarlierScripts()) {
      Type earlierClassType=asmTypeForScriptDescriptor(bindingContext,earlierScript);
      iv.load(0,classType);
      iv.load(offset,earlierClassType);
      offset+=earlierClassType.getSize();
      iv.putfield(classType.getInternalName(),context.getScriptFieldName(earlierScript),earlierClassType.getDescriptor());
    }
    for (    ValueParameterDescriptor parameter : scriptDescriptor.getScriptCodeDescriptor().getValueParameters()) {
      Type parameterType=typeMapper.mapType(parameter.getType());
      iv.load(0,classType);
      iv.load(offset,parameterType);
      offset+=parameterType.getSize();
      iv.putfield(classType.getInternalName(),parameter.getName().getIdentifier(),parameterType.getDescriptor());
    }
    final ExpressionCodegen codegen=new ExpressionCodegen(mv,frameMap,Type.VOID_TYPE,methodContext,state,this);
    generateInitializers(new Function0<ExpressionCodegen>(){
      @Override public ExpressionCodegen invoke(){
        return codegen;
      }
    }
);
    StackValue stackValue=codegen.gen(scriptDeclaration.getBlockExpression());
    if (stackValue.type != Type.VOID_TYPE) {
      StackValue.Field resultValue=StackValue.field(blockType,classType,ScriptDescriptor.LAST_EXPRESSION_VALUE_FIELD_NAME,false,StackValue.LOCAL_0);
      resultValue.store(stackValue,iv);
    }
 else {
      stackValue.put(blockType,iv);
    }
    iv.areturn(Type.VOID_TYPE);
  }
  mv.visitMaxs(-1,-1);
  mv.visitEnd();
}
