{
  JetFile file=(JetFile)script.getContainingFile();
  JetPackageDirective packageDirective=file.getPackageDirective();
  FqName fqName=packageDirective != null ? new FqName(packageDirective.getQualifiedName()) : FqName.ROOT;
  PackageFragmentDescriptor ns=packageFragmentProvider.getOrCreateFragment(fqName);
  Integer priority=script.getUserData(PRIORITY_KEY);
  if (priority == null) {
    priority=0;
  }
  Name className=new FqName(ScriptNameUtil.classNameForScript((JetFile)script.getContainingFile()).replace('/','.')).shortName();
  ScriptDescriptor scriptDescriptor=new ScriptDescriptor(ns,priority,outerScope,className);
  WritableScopeImpl scriptScope=new WritableScopeImpl(outerScope,scriptDescriptor,RedeclarationHandler.DO_NOTHING,"script");
  scriptScope.changeLockLevel(WritableScope.LockLevel.BOTH);
  context.getScriptScopes().put(script,scriptScope);
  context.getScripts().put(script,scriptDescriptor);
  trace.record(BindingContext.SCRIPT,script,scriptDescriptor);
  ((WritableScope)outerScope).addClassifierDescriptor(scriptDescriptor.getClassDescriptor());
}
