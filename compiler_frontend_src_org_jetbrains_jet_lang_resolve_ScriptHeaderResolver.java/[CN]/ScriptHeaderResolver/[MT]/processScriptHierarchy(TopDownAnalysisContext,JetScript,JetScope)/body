{
  JetFile file=(JetFile)script.getContainingFile();
  FqName fqName=file.getPackageFqName();
  PackageFragmentDescriptor ns=packageFragmentProvider.getOrCreateFragment(fqName);
  Integer priority=script.getUserData(PRIORITY_KEY);
  if (priority == null) {
    priority=0;
  }
  Name className=new FqName(ScriptNameUtil.classNameForScript((JetFile)script.getContainingFile()).replace('/','.')).shortName();
  ScriptDescriptor scriptDescriptor=new ScriptDescriptor(ns,priority,outerScope,className);
  WritableScopeImpl scriptScope=new WritableScopeImpl(outerScope,scriptDescriptor,RedeclarationHandler.DO_NOTHING,"script");
  scriptScope.changeLockLevel(WritableScope.LockLevel.BOTH);
  c.getScriptScopes().put(script,scriptScope);
  c.getScripts().put(script,scriptDescriptor);
  trace.record(BindingContext.SCRIPT,script,scriptDescriptor);
  ((WritableScope)outerScope).addClassifierDescriptor(scriptDescriptor.getClassDescriptor());
}
