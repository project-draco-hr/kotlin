{
  PsiElement parent=expression.getParent();
  if (parent instanceof JetClassBody) {
    JetClassOrObject classOrObject=(JetClassOrObject)parent.getParent();
    ClassDescriptor classDescriptor=analysisResult.getBindingContext().get(BindingContext.CLASS,classOrObject);
    if (classDescriptor instanceof ClassDescriptorWithResolutionScopes) {
      return ((ClassDescriptorWithResolutionScopes)classDescriptor).getScopeForMemberDeclarationResolution();
    }
    return null;
  }
  if (parent instanceof JetFile) {
    PackageViewDescriptor packageView=analysisResult.getModuleDescriptor().getPackage(((JetFile)parent).getPackageFqName());
    return packageView != null ? packageView.getMemberScope() : null;
  }
  return analysisResult.getBindingContext().get(BindingContext.RESOLUTION_SCOPE,expression);
}
