{
  String defaultPathToJar=getDefaultPathToJarFile(project);
  String defaultPathToJsFile=getDefaultPathToJsFile(project);
  boolean showPathToJarPanel=needToChooseJarPath(project);
  boolean showPathToJsFilePanel=needToChooseJsFilePath(project);
  List<Module> nonConfiguredModules=!ApplicationManager.getApplication().isUnitTestMode() ? ConfigureKotlinInProjectUtils.getNonConfiguredModules(project,this) : Arrays.asList(ModuleManager.getInstance(project).getModules());
  List<Module> modulesToConfigure=nonConfiguredModules;
  String copyLibraryIntoPath=null;
  String jsFilesIntoPath=null;
  if (nonConfiguredModules.size() > 1 || showPathToJarPanel || showPathToJsFilePanel) {
    CreateJavaScriptLibraryDialogWithModules dialog=new CreateJavaScriptLibraryDialogWithModules(project,nonConfiguredModules,defaultPathToJar,defaultPathToJsFile,showPathToJarPanel,showPathToJsFilePanel);
    if (!ApplicationManager.getApplication().isUnitTestMode()) {
      dialog.show();
      if (!dialog.isOK())       return;
    }
    modulesToConfigure=dialog.getModulesToConfigure();
    copyLibraryIntoPath=dialog.getCopyLibraryIntoPath();
    jsFilesIntoPath=dialog.getCopyJsIntoPath();
  }
  for (  Module module : modulesToConfigure) {
    configureModuleWithLibrary(module,defaultPathToJar,copyLibraryIntoPath);
  }
  configureModuleWithJsFile(defaultPathToJsFile,jsFilesIntoPath);
}
