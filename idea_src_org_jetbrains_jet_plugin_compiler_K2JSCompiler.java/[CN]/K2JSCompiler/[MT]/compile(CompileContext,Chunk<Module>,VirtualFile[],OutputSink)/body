{
  if (files.length == 0) {
    return;
  }
  if (moduleChunk.getNodes().size() != 1) {
    context.addMessage(CompilerMessageCategory.ERROR,"K2JSCompiler does not support multiple modules.",null,-1,-1);
    return;
  }
  Module module=moduleChunk.getNodes().iterator().next();
  final CompilerEnvironment environment=CompilerEnvironment.getEnvironmentFor(context,module,false);
  if (!environment.success()) {
    environment.reportErrorsTo(context);
    return;
  }
  CompilerUtils.OutputItemsCollectorImpl collector=new CompilerUtils.OutputItemsCollectorImpl(environment.getOutput().getPath());
  outputCompilerMessagesAndHandleExitCode(context,collector,new Function1<PrintStream,Integer>(){
    @Override public Integer invoke(    PrintStream stream){
      return execInProcess(context,environment,stream);
    }
  }
);
  sink.add(environment.getOutput().getPath(),collector.getOutputs(),collector.getSources().toArray(VirtualFile.EMPTY_ARRAY));
}
