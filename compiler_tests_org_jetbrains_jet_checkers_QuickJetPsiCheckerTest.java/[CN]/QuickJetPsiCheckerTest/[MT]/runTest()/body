{
  String expectedText=loadFile(name + ".jet");
  List<CheckerTestUtil.DiagnosedRange> diagnosedRanges=Lists.newArrayList();
  String clearText=CheckerTestUtil.parseDiagnosedRanges(expectedText,diagnosedRanges);
  createAndCheckPsiFile(name,clearText);
  JetFile jetFile=(JetFile)myFile;
  boolean loadStdlib=!expectedText.contains("-STDLIB");
  boolean importJdk=expectedText.contains("+JDK");
  ImportingStrategy importingStrategy=importJdk ? JavaDefaultImports.JAVA_DEFAULT_IMPORTS : ImportingStrategy.NONE;
  BindingContext bindingContext=AnalyzerFacade.analyzeFileWithCache(AnalyzingUtils.getInstance(importingStrategy,loadStdlib),jetFile,AnalyzerFacade.SINGLE_DECLARATION_PROVIDER);
  CheckerTestUtil.diagnosticsDiff(diagnosedRanges,bindingContext.getDiagnostics(),new CheckerTestUtil.DiagnosticDiffCallbacks(){
    @Override public void missingDiagnostic(    String type,    int expectedStart,    int expectedEnd){
      String message="Missing " + type + DiagnosticUtils.atLocation(myFile,new TextRange(expectedStart,expectedEnd));
      System.err.println(message);
    }
    @Override public void unexpectedDiagnostic(    String type,    int actualStart,    int actualEnd){
      String message="Unexpected " + type + DiagnosticUtils.atLocation(myFile,new TextRange(actualStart,actualEnd));
      System.err.println(message);
    }
  }
);
  String actualText=CheckerTestUtil.addDiagnosticMarkersToText(jetFile,bindingContext).toString();
  assertEquals(expectedText,actualText);
}
