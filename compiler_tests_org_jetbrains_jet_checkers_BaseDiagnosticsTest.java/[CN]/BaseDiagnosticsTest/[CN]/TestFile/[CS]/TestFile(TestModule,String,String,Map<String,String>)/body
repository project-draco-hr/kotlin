{
  this.module=module;
  this.whatDiagnosticsToConsider=parseDiagnosticFilterDirective(directives);
  this.declareCheckType=directives.containsKey(CHECK_TYPE_DIRECTIVE);
  this.declareFlexibleType=directives.containsKey(EXPLICIT_FLEXIBLE_TYPES_DIRECTIVE);
  if (fileName.endsWith(".java")) {
    PsiFileFactory.getInstance(getProject()).createFileFromText(fileName,JavaLanguage.INSTANCE,textWithMarkers);
    this.jetFile=null;
    this.expectedText=this.clearText=textWithMarkers;
  }
 else {
    this.expectedText=textWithMarkers;
    String textWithExtras=addExtras(expectedText);
    this.clearText=CheckerTestUtil.parseDiagnosedRanges(textWithExtras,diagnosedRanges);
    this.jetFile=createCheckAndReturnPsiFile(null,fileName,clearText);
    for (    CheckerTestUtil.DiagnosedRange diagnosedRange : diagnosedRanges) {
      diagnosedRange.setFile(jetFile);
    }
  }
}
