{
  if (type1.isFlexible()) {
    if (type2.isFlexible()) {
      return equalTypes(type1.getLowerBound(),type2.getLowerBound()) && equalTypes(type1.getUpperBound(),type2.getUpperBound());
    }
    return heterogeneousEquivalence(type2,type1);
  }
 else   if (type2.isFlexible()) {
    return heterogeneousEquivalence(type1,type2);
  }
  if (type1.isNullable() != type2.isNullable()) {
    return false;
  }
  if (type1.isNullable()) {
    return constraints.assertEqualTypes(TypeUtils.makeNotNullable(type1),TypeUtils.makeNotNullable(type2),this);
  }
  TypeConstructor constructor1=type1.getConstructor();
  TypeConstructor constructor2=type2.getConstructor();
  if (!constraints.assertEqualTypeConstructors(constructor1,constructor2)) {
    return false;
  }
  List<TypeProjection> type1Arguments=type1.getArguments();
  List<TypeProjection> type2Arguments=type2.getArguments();
  if (type1Arguments.size() != type2Arguments.size()) {
    return false;
  }
  for (int i=0; i < type1Arguments.size(); i++) {
    TypeParameterDescriptor typeParameter1=constructor1.getParameters().get(i);
    TypeProjection typeProjection1=type1Arguments.get(i);
    TypeParameterDescriptor typeParameter2=constructor2.getParameters().get(i);
    TypeProjection typeProjection2=type2Arguments.get(i);
    if (getEffectiveProjectionKind(typeParameter1,typeProjection1) != getEffectiveProjectionKind(typeParameter2,typeProjection2)) {
      return false;
    }
    if (!constraints.assertEqualTypes(typeProjection1.getType(),typeProjection2.getType(),this)) {
      return false;
    }
  }
  return true;
}
