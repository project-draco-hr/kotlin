{
  Type asmType=asmTypeForAnonymousClass(bindingContext,descriptor);
  ClassBuilder cv=state.getFactory().newVisitor(OtherOrigin(declaration,descriptor),asmType,declaration.getContainingFile());
  ClassContext closureContext=context.intoClosure(descriptor,this,typeMapper);
  ClosureCodegen closureCodegen=new ClosureCodegen(state,declaration,descriptor,samType,closureContext,kind,strategy,parentCodegen,cv,asmType);
  closureCodegen.generate();
  if (closureCodegen.getReifiedTypeParametersUsages().wereUsedReifiedParameters()) {
    ReifiedTypeInliner.putNeedClassReificationMarker(v);
    propagateChildReifiedTypeParametersUsages(closureCodegen.getReifiedTypeParametersUsages());
  }
  return closureCodegen.putInstanceOnStack(this);
}
