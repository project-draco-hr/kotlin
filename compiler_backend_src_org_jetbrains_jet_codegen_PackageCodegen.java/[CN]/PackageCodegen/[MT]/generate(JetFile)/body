{
  boolean generateSrcClass=false;
  Type packagePartType=getPackagePartType(getPackageClassFqName(name),file.getVirtualFile());
  PackageContext packagePartContext=CodegenContext.STATIC.intoPackagePart(getPackageFragment(file),packagePartType);
  for (  JetDeclaration declaration : file.getDeclarations()) {
    if (declaration instanceof JetProperty || declaration instanceof JetNamedFunction) {
      generateSrcClass=true;
    }
 else     if (declaration instanceof JetClassOrObject) {
      JetClassOrObject classOrObject=(JetClassOrObject)declaration;
      if (state.getGenerateDeclaredClassFilter().shouldProcess(classOrObject)) {
        generateClassOrObject(classOrObject);
      }
    }
 else     if (declaration instanceof JetScript) {
      ScriptCodegen.createScriptCodegen((JetScript)declaration,state,packagePartContext).generate();
    }
  }
  if (!generateSrcClass)   return null;
  ClassBuilder builder=state.getFactory().forPackagePart(packagePartType,file);
  new PackagePartCodegen(builder,file,packagePartType,packagePartContext,state).generate();
  FieldOwnerContext packageFacade=CodegenContext.STATIC.intoPackageFacade(packagePartType,getPackageFragment(file));
  MemberCodegen memberCodegen=new MemberCodegen(state,null,packageFacade,null);
  for (  JetDeclaration declaration : file.getDeclarations()) {
    if (declaration instanceof JetNamedFunction || declaration instanceof JetProperty) {
      memberCodegen.genFunctionOrProperty(packageFacade,(JetTypeParameterListOwner)declaration,v.getClassBuilder());
    }
  }
  return builder;
}
