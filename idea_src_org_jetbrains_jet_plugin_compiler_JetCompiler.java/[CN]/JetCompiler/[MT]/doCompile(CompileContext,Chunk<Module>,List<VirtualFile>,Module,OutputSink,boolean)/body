{
  if (files.isEmpty())   return;
  MessageCollector messageCollector=new MessageCollectorAdapter(compileContext);
  CompilerEnvironment environment=CompilerUtils.getEnvironmentFor(compileContext,module,tests);
  if (!environment.success()) {
    environment.reportErrorsTo(messageCollector);
    return;
  }
  final File outputDir=environment.getOutput();
  File scriptFile=tryToWriteScriptFile(compileContext,moduleChunk,files,module,tests,compileContext.getModuleOutputDirectory(module),outputDir);
  if (scriptFile == null)   return;
  OutputItemsCollectorImpl collector=new OutputItemsCollectorImpl(outputDir){
    @Override public void add(    Collection<File> sourceFiles,    File outputFile){
      super.add(sourceFiles,outputFile);
      compileContext.getProgressIndicator().setText("Emitting: " + outputFile);
    }
  }
;
  runCompiler(messageCollector,environment,scriptFile,collector);
  CompilerUtils.reportOutputs(outputSink,outputDir,collector);
}
