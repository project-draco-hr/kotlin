{
  URLClassLoader loader=getOrCreateClassloader(kotlinHome,context);
  try {
    String compilerClassName="org.jetbrains.jet.cli.KotlinCompiler";
    Class<?> kompiler=Class.forName(compilerClassName,true,loader);
    Method exec=kompiler.getDeclaredMethod("exec",PrintStream.class,String[].class);
    String[] arguments={"-module",scriptFile.getAbsolutePath(),"-output",path(outputDir)};
    context.addMessage(INFORMATION,"Using kotlinHome=" + kotlinHome,"",-1,-1);
    context.addMessage(INFORMATION,"Invoking in-process compiler " + compilerClassName + " with arguments "+ Arrays.asList(arguments),"",-1,-1);
    Object rc=exec.invoke(null,out,arguments);
    if (rc instanceof Integer) {
      return ((Integer)rc).intValue();
    }
 else {
      throw new RuntimeException("Unexpected return: " + rc);
    }
  }
 catch (  Throwable e) {
    LOG.error(e);
    return -1;
  }
}
