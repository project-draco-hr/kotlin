{
  final String signatureString=SIGNATURE_SOURCE_RENDERER.render(patternDescriptor);
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  final JetPsiFactory psiFactory=PsiPackage.JetPsiFactory(project);
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          JetNamedFunction patternFunction=psiFactory.createFunction(signatureString);
          JetTypeReference newTypeRef=function.setTypeReference(patternFunction.getTypeReference());
          if (newTypeRef != null) {
            ShortenReferences.DEFAULT.process(newTypeRef);
          }
          JetParameterList newParameterList=(JetParameterList)function.getValueParameterList().replace(patternFunction.getValueParameterList());
          ShortenReferences.DEFAULT.process(newParameterList);
        }
      }
);
    }
  }
,JetBundle.message("change.function.signature.action"),null);
}
